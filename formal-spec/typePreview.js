document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("type-preview-container");if(!e)return void console.error("Type preview container not found");let t=null,n=null;const o=new Map;function i(i){const c=i.target.closest('a[data-hoverable="true"]');c&&(clearTimeout(n),clearTimeout(t),t=setTimeout((()=>{const t=c.getAttribute("href");t&&async function(t,n){const[i,c]=n.split("#");if(!c)return;const r=parseInt(c.replace("L",""),10);if(isNaN(r))return;const a=`${i||window.location.pathname}#${r}`;let s;if(o.has(a))s=o.get(a);else if(i&&i!==window.location.pathname.split("/").pop())try{const e=i.replace(".html","");s=await async function(e,t,n=""){try{const o=await fetch(e);if(!o.ok)throw new Error(`Failed to fetch ${e}: ${o.status}`);const i=await o.text(),c=new DOMParser,r=c.parseFromString(i,"text/html").getElementById(`LC${t}`);if(!r)return null;const a=r.closest(".code-content");if(!a)return null;const s=Array.from(a.querySelectorAll(".code-line")),d=s.indexOf(r);if(-1===d)return null;const m=Math.max(0,d-2),u=Math.min(s.length-1,d+2);return l(s.slice(m,u+1),t,m,n)}catch(o){return console.error("Error fetching file:",o),null}}(i,r,e),s&&o.set(a,s)}catch(d){return void console.error("Error fetching code preview:",d)}else{const e=document.getElementById(`LC${r}`);if(!e)return;const t=e.closest(".code-content");if(!t)return;const n=Array.from(t.querySelectorAll(".code-line")),i=n.indexOf(e);if(-1===i)return;const c=Math.max(0,i-2),d=Math.min(n.length-1,i+2);s=l(n.slice(c,d+1),r,c,document.title||window.location.pathname.split("/").pop().replace(".html","")),o.set(a,s)}s&&(e.innerHTML="",e.appendChild(s),function(t){const n=t.getBoundingClientRect(),o=window.pageYOffset||document.documentElement.scrollTop,i=window.pageXOffset||document.documentElement.scrollLeft;let c=n.bottom+o+10,l=n.left+i;e.style.top=`${c}px`,e.style.left=`${l}px`,setTimeout((()=>{const t=e.getBoundingClientRect(),i=window.innerWidth,r=window.innerHeight;t.right>i&&(l=Math.max(0,i-t.width-20),e.style.left=`${l}px`),t.bottom>r&&(c=n.top+o-t.height-10,e.style.top=`${c}px`)}),0)}(t),e.style.display="block")}(c,t)}),300))}function c(){clearTimeout(t),n=setTimeout((()=>{r()}),300)}function l(e,t,n,o=""){const i=document.createElement("div");i.className="code-preview-container";const c=document.createElement("div");c.className="preview-heading";const l=document.createElement("span");l.className="module-name",l.textContent=o?`Definition in ${o}`:"Definition";const r=document.createElement("a");r.className="link-to-definition",r.textContent=`Line ${t}`,o&&o!==(document.title||"")?r.href=`${o}.html#L${t}`:r.href=`#L${t}`,c.appendChild(l),c.appendChild(r),i.appendChild(c);const a=document.createElement("div");a.className="preview-line-numbers";const s=document.createElement("div");s.className="preview-code-content",e.forEach(((e,o)=>{const i=n+o+1,c=document.createElement("span");c.className="preview-line-number",c.textContent=i,i===t&&c.classList.add("highlight"),a.appendChild(c);const l=document.createElement("div");l.className="preview-code-line",i===t&&l.classList.add("highlight");const r=document.createElement("div");r.style.whiteSpace="pre",r.innerHTML=e.innerHTML,l.appendChild(r),s.appendChild(l)}));const d=document.createElement("div");return d.className="preview-code",d.appendChild(a),d.appendChild(s),i.appendChild(d),i}function r(){e.style.display="none"}!function(){const t=document.querySelectorAll('a[data-hoverable="true"]');console.log("Found hoverable links:",t.length),t.forEach((e=>{e.addEventListener("mouseenter",i),e.addEventListener("mouseleave",c)})),e.addEventListener("mouseenter",(()=>{clearTimeout(n)})),e.addEventListener("mouseleave",(()=>{r()}))}()}));
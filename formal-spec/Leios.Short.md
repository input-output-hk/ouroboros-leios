## Short-Pipeline Leios

<!--
<pre class="Agda"><a id="39" class="Symbol">{-#</a> <a id="43" class="Keyword">OPTIONS</a> <a id="51" class="Pragma">--safe</a> <a id="58" class="Symbol">#-}</a>
<a id="62" class="Keyword">open</a> <a id="67" class="Keyword">import</a> <a id="74" href="Leios.Prelude.html" class="Module">Leios.Prelude</a> <a id="88" class="Keyword">hiding</a> <a id="95" class="Symbol">(</a><a id="96" href="Function.Base.html#704" class="Function">id</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Leios.FFD.html" class="Module">Leios.FFD</a>
<a id="122" class="Keyword">open</a> <a id="127" class="Keyword">import</a> <a id="134" href="Leios.SpecStructure.html" class="Module">Leios.SpecStructure</a>
<a id="154" class="Keyword">open</a> <a id="159" class="Keyword">import</a> <a id="166" href="Data.Fin.Patterns.html" class="Module">Data.Fin.Patterns</a>
<a id="184" class="Keyword">open</a> <a id="189" class="Keyword">import</a> <a id="196" href="Class.ToBool.html" class="Module">Class.ToBool</a>

<a id="210" class="Keyword">open</a> <a id="215" class="Keyword">import</a> <a id="222" href="Tactic.Defaults.html" class="Module">Tactic.Defaults</a>
<a id="238" class="Keyword">open</a> <a id="243" class="Keyword">import</a> <a id="250" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="271" class="Keyword">module</a> <a id="278" href="Leios.Short.html" class="Module">Leios.Short</a> <a id="290" class="Symbol">(</a><a id="291" href="Leios.Short.html#291" class="Bound">⋯</a> <a id="293" class="Symbol">:</a> <a id="295" href="Leios.SpecStructure.html#286" class="Record">SpecStructure</a> <a id="309" class="Number">1</a><a id="310" class="Symbol">)</a>
  <a id="314" class="Symbol">(</a><a id="315" class="Keyword">let</a> <a id="319" class="Keyword">open</a> <a id="324" href="Leios.SpecStructure.html#286" class="Module">SpecStructure</a> <a id="338" href="Leios.Short.html#291" class="Bound">⋯</a> <a id="340" class="Keyword">renaming</a> <a id="349" class="Symbol">(</a><a id="350" href="Leios.Voting.html#203" class="Function">isVoteCertified</a> <a id="366" class="Symbol">to</a> <a id="369" class="Function">isVoteCertified&#39;</a><a id="385" class="Symbol">))</a> <a id="388" class="Keyword">where</a>
</pre>-->

This document is a specification of Short-Pipeline Leios, usually
abbreviated as Short Leios. On a high level, the pipeline looks like this:

1. If elected, propose IB
2. Wait
3. Wait
4. If elected, propose EB
5. If elected, vote
   If elected, propose RB

### Upkeep

A node that never produces a block even though it could is not
supposed to be an honest node, and we prevent that by tracking whether
a node has checked if it can make a block in a particular slot.
`LeiosState` contains a set of `SlotUpkeep` and we ensure that this
set contains all elements before we can advance to the next slot,
resetting this field to the empty set.

<pre class="Agda"><a id="1052" class="Keyword">data</a> <a id="SlotUpkeep"></a><a id="1057" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a> <a id="1068" class="Symbol">:</a> <a id="1070" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1075" class="Keyword">where</a>
  <a id="SlotUpkeep.Base"></a><a id="1083" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a> <a id="SlotUpkeep.IB-Role"></a><a id="1088" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a> <a id="SlotUpkeep.EB-Role"></a><a id="1096" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a> <a id="SlotUpkeep.VT-Role"></a><a id="1104" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a> <a id="1112" class="Symbol">:</a> <a id="1114" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a>
</pre><!--
<pre class="Agda"><a id="1142" class="Keyword">unquoteDecl</a> <a id="DecEq-SlotUpkeep"></a><a id="1154" href="Leios.Short.html#1154" class="Function">DecEq-SlotUpkeep</a> <a id="1171" class="Symbol">=</a> <a id="1173" href="Tactic.Derive.DecEq.html#3512" class="Function">derive-DecEq</a> <a id="1186" class="Symbol">((</a><a id="1188" class="Keyword">quote</a> <a id="1194" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a> <a id="1205" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1207" href="Leios.Short.html#1154" class="Function">DecEq-SlotUpkeep</a><a id="1223" class="Symbol">)</a> <a id="1225" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1227" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1229" class="Symbol">)</a>

<a id="1232" class="Keyword">open</a> <a id="1237" class="Keyword">import</a> <a id="1244" href="Leios.Protocol.html" class="Module">Leios.Protocol</a> <a id="1259" class="Symbol">(</a><a id="1260" href="Leios.Short.html#291" class="Bound">⋯</a><a id="1261" class="Symbol">)</a> <a id="1263" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a> <a id="1274" class="Keyword">public</a>
<a id="1281" class="Keyword">open</a> <a id="1286" href="Leios.Base.html#576" class="Module">BaseAbstract</a> <a id="1299" href="Leios.SpecStructure.html#835" class="Field">B&#39;</a> <a id="1302" class="Keyword">using</a> <a id="1308" class="Symbol">(</a><a id="1309" href="Leios.Base.html#611" class="Field">Cert</a><a id="1313" class="Symbol">;</a> <a id="1315" href="Leios.Base.html#677" class="Field">V-chkCerts</a><a id="1325" class="Symbol">;</a> <a id="1327" href="Leios.Base.html#631" class="Field">VTy</a><a id="1330" class="Symbol">;</a> <a id="1332" href="Leios.Base.html#650" class="Field">initSlot</a><a id="1340" class="Symbol">)</a>
<a id="1342" class="Keyword">open</a> <a id="1347" href="Leios.SpecStructure.html#1203" class="Module">FFD</a> <a id="1351" class="Keyword">hiding</a> <a id="1358" class="Symbol">(</a><a id="1359" href="Leios.FFD.html#562" class="Function Operator">_-⟦_/_⟧⇀_</a><a id="1368" class="Symbol">)</a>
<a id="1370" class="Keyword">open</a> <a id="1375" href="Leios.Blocks.html#4489" class="Module">GenFFD</a>
</pre><pre class="Agda"><a id="isVoteCertified"></a><a id="1394" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="1410" class="Symbol">:</a> <a id="1412" href="Leios.Protocol.html#1338" class="Record">LeiosState</a> <a id="1423" class="Symbol">→</a> <a id="1425" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a> <a id="1439" class="Symbol">→</a> <a id="1441" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1446" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="1462" href="Leios.Short.html#1462" class="Bound">s</a> <a id="1464" href="Leios.Short.html#1464" class="Bound">eb</a> <a id="1467" class="Symbol">=</a> <a id="1469" href="Leios.Short.html#369" class="Function">isVoteCertified&#39;</a> <a id="1486" class="Symbol">(</a><a id="1487" href="Leios.Protocol.html#1798" class="Field">LeiosState.votingState</a> <a id="1510" href="Leios.Short.html#1462" class="Bound">s</a><a id="1511" class="Symbol">)</a> <a id="1513" class="Symbol">(</a><a id="1514" href="Data.Fin.Patterns.html#399" class="InductiveConstructor">0F</a> <a id="1517" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1519" href="Leios.Short.html#1464" class="Bound">eb</a><a id="1521" class="Symbol">)</a>
</pre><pre class="Agda"><a id="1535" class="Keyword">private</a> <a id="1543" class="Keyword">variable</a> <a id="1552" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="1554" href="Leios.Short.html#1554" class="Generalizable">s&#39;</a>   <a id="1559" class="Symbol">:</a> <a id="1561" href="Leios.Protocol.html#1338" class="Record">LeiosState</a>
                 <a id="1589" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>  <a id="1596" class="Symbol">:</a> <a id="1598" href="Leios.FFD.html#508" class="Function">FFD.State</a>
                 <a id="1625" href="Leios.Short.html#1625" class="Generalizable">π</a>      <a id="1632" class="Symbol">:</a> <a id="1634" href="Leios.Abstract.html#578" class="Function">VrfPf</a>
                 <a id="1657" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>    <a id="1664" class="Symbol">:</a> <a id="1666" href="Leios.Base.html#1034" class="Function">B.State</a>
                 <a id="1691" href="Leios.Short.html#1691" class="Generalizable">ks</a> <a id="1694" href="Leios.Short.html#1694" class="Generalizable">ks&#39;</a> <a id="1698" class="Symbol">:</a> <a id="1700" href="Leios.KeyRegistration.html#453" class="Function">K.State</a>
                 <a id="1725" href="Leios.Short.html#1725" class="Generalizable">msgs</a>   <a id="1732" class="Symbol">:</a> <a id="1734" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1739" class="Symbol">(</a><a id="1740" href="Leios.FFD.html#117" class="Field">FFDAbstract.Header</a> <a id="1759" href="Leios.Blocks.html#5537" class="Function">ffdAbstract</a> <a id="1771" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="1773" href="Leios.FFD.html#124" class="Field">FFDAbstract.Body</a> <a id="1790" href="Leios.Blocks.html#5537" class="Function">ffdAbstract</a><a id="1801" class="Symbol">)</a>
                 <a id="1820" href="Leios.Short.html#1820" class="Generalizable">eb</a>     <a id="1827" class="Symbol">:</a> <a id="1829" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a>
                 <a id="1860" href="Leios.Short.html#1860" class="Generalizable">rbs</a>    <a id="1867" class="Symbol">:</a> <a id="1869" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1874" href="Leios.Base.html#503" class="Function">RankingBlock</a>
                 <a id="1904" href="Leios.Short.html#1904" class="Generalizable">txs</a>    <a id="1911" class="Symbol">:</a> <a id="1913" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1918" href="Leios.Abstract.html#457" class="Function">Tx</a>
                 <a id="1938" href="Leios.Short.html#1938" class="Generalizable">V</a>      <a id="1945" class="Symbol">:</a> <a id="1947" href="Leios.Base.html#631" class="Function">VTy</a>
                 <a id="1968" href="Leios.Short.html#1968" class="Generalizable">SD</a>     <a id="1975" class="Symbol">:</a> <a id="1977" href="Leios.Base.html#453" class="Function">StakeDistr</a>
                 <a id="2005" href="Leios.Short.html#2005" class="Generalizable">pks</a>    <a id="2012" class="Symbol">:</a> <a id="2014" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2019" href="Leios.VRF.html#480" class="Function">PubKey</a>
</pre>-->

### Block/Vote production rules

We now define the rules for block production given by the relation `_↝_`. These are split in two:

1. Positive rules, when we do need to create a block.
2. Negative rules, when we cannot create a block.

The purpose of the negative rules is to properly adjust the upkeep if
we cannot make a block.

Note that `_↝_`, starting with an empty upkeep can always make exactly
three steps corresponding to the three types of Leios specific blocks.

<pre class="Agda"><a id="2518" class="Keyword">data</a> <a id="_↝_"></a><a id="2523" href="Leios.Short.html#2523" class="Datatype Operator">_↝_</a> <a id="2527" class="Symbol">:</a> <a id="2529" href="Leios.Protocol.html#1338" class="Record">LeiosState</a> <a id="2540" class="Symbol">→</a> <a id="2542" href="Leios.Protocol.html#1338" class="Record">LeiosState</a> <a id="2553" class="Symbol">→</a> <a id="2555" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2560" class="Keyword">where</a>
</pre>#### Positive rules
<pre class="Agda">  <a id="_↝_.IB-Role"></a><a id="2600" href="Leios.Short.html#2600" class="InductiveConstructor">IB-Role</a> <a id="2608" class="Symbol">:</a> <a id="2610" class="Keyword">let</a> <a id="2614" class="Keyword">open</a> <a id="2619" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="2630" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="2632" class="Keyword">renaming</a> <a id="2641" class="Symbol">(</a><a id="2642" href="Leios.Protocol.html#1429" class="Field">FFDState</a> <a id="2651" class="Symbol">to</a> <a id="2654" class="Field">ffds</a><a id="2658" class="Symbol">)</a>
                <a id="2676" href="Leios.Short.html#2676" class="Bound">b</a> <a id="2678" class="Symbol">=</a> <a id="2680" href="Leios.Blocks.html#4692" class="InductiveConstructor">ibBody</a> <a id="2687" class="Symbol">(</a><a id="2688" class="Keyword">record</a> <a id="2695" class="Symbol">{</a> <a id="2697" href="Leios.Blocks.html#1326" class="Field">txs</a> <a id="2701" class="Symbol">=</a> <a id="2703" href="Leios.Protocol.html#1491" class="Function">ToPropose</a> <a id="2713" class="Symbol">})</a>
                <a id="2732" href="Leios.Short.html#2732" class="Bound">h</a> <a id="2734" class="Symbol">=</a> <a id="2736" href="Leios.Blocks.html#4561" class="InductiveConstructor">ibHeader</a> <a id="2745" class="Symbol">(</a><a id="2746" href="Leios.Blocks.html#2141" class="Function">mkIBHeader</a> <a id="2757" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="2762" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="2765" href="Leios.Short.html#1625" class="Generalizable">π</a> <a id="2767" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="2773" href="Leios.Protocol.html#1491" class="Function">ToPropose</a><a id="2782" class="Symbol">)</a>
          <a id="2794" class="Keyword">in</a>
          <a id="2807" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="2809" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="2821" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
          <a id="2839" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="2841" href="Leios.VRF.html#814" class="Function">canProduceIB</a> <a id="2854" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="2859" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="2865" class="Symbol">(</a><a id="2866" href="Leios.Protocol.html#3374" class="Function">stake</a> <a id="2872" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="2873" class="Symbol">)</a> <a id="2875" href="Leios.Short.html#1625" class="Generalizable">π</a>
          <a id="2887" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="2889" href="Leios.Short.html#2654" class="Function">ffds</a> <a id="2894" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="2901" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="2906" href="Leios.Short.html#2732" class="Bound">h</a> <a id="2908" class="Symbol">(</a><a id="2909" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2914" href="Leios.Short.html#2676" class="Bound">b</a><a id="2915" class="Symbol">)</a> <a id="2917" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="2919" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="2927" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="2930" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
          <a id="2946" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="3030" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3032" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="3034" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="3044" class="Keyword">record</a> <a id="3051" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3053" class="Symbol">{</a> <a id="3055" href="Leios.Protocol.html#1429" class="Field">FFDState</a> <a id="3064" class="Symbol">=</a> <a id="3066" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a> <a id="3072" class="Symbol">}</a> <a id="3074" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.EB-Role"></a><a id="3096" href="Leios.Short.html#3096" class="InductiveConstructor">EB-Role</a> <a id="3104" class="Symbol">:</a> <a id="3106" class="Keyword">let</a> <a id="3110" class="Keyword">open</a> <a id="3115" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="3126" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3128" class="Keyword">renaming</a> <a id="3137" class="Symbol">(</a><a id="3138" href="Leios.Protocol.html#1429" class="Field">FFDState</a> <a id="3147" class="Symbol">to</a> <a id="3150" class="Field">ffds</a><a id="3154" class="Symbol">)</a>
                <a id="3172" href="Leios.Short.html#3172" class="Bound">LI</a> <a id="3175" class="Symbol">=</a> <a id="3177" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="3181" href="Leios.Blocks.html#2547" class="Function">getIBRef</a> <a id="3190" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3192" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="3199" class="Symbol">(</a><a id="3200" href="Leios.Blocks.html#770" class="Function Operator">_∈ᴮ</a> <a id="3204" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="3210" href="Leios.Abstract.html#961" class="Function">L</a> <a id="3212" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="3217" class="Number">3</a><a id="3218" class="Symbol">)</a> <a id="3220" href="Leios.Protocol.html#1521" class="Function">IBs</a>
                <a id="3240" href="Leios.Short.html#3240" class="Bound">h</a> <a id="3242" class="Symbol">=</a> <a id="3244" href="Leios.Blocks.html#3578" class="Function">mkEB</a> <a id="3249" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="3254" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="3257" href="Leios.Short.html#1625" class="Generalizable">π</a> <a id="3259" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="3265" href="Leios.Short.html#3172" class="Bound">LI</a> <a id="3268" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
          <a id="3281" class="Keyword">in</a>
          <a id="3294" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="3296" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="3308" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
          <a id="3326" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3328" href="Leios.VRF.html#1418" class="Function">canProduceEB</a> <a id="3341" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="3346" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="3352" class="Symbol">(</a><a id="3353" href="Leios.Protocol.html#3374" class="Function">stake</a> <a id="3359" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="3360" class="Symbol">)</a> <a id="3362" href="Leios.Short.html#1625" class="Generalizable">π</a>
          <a id="3374" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3376" href="Leios.Short.html#3150" class="Function">ffds</a> <a id="3381" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="3388" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="3393" class="Symbol">(</a><a id="3394" href="Leios.Blocks.html#4594" class="InductiveConstructor">ebHeader</a> <a id="3403" href="Leios.Short.html#3240" class="Bound">h</a><a id="3404" class="Symbol">)</a> <a id="3406" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="3414" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="3416" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="3424" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="3427" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
          <a id="3443" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="3527" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3529" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="3531" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="3541" class="Keyword">record</a> <a id="3548" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3550" class="Symbol">{</a> <a id="3552" href="Leios.Protocol.html#1429" class="Field">FFDState</a> <a id="3561" class="Symbol">=</a> <a id="3563" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a> <a id="3569" class="Symbol">}</a> <a id="3571" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.VT-Role"></a><a id="3593" href="Leios.Short.html#3593" class="InductiveConstructor">VT-Role</a> <a id="3601" class="Symbol">:</a> <a id="3603" class="Keyword">let</a> <a id="3607" class="Keyword">open</a> <a id="3612" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="3623" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3625" class="Keyword">renaming</a> <a id="3634" class="Symbol">(</a><a id="3635" href="Leios.Protocol.html#1429" class="Field">FFDState</a> <a id="3644" class="Symbol">to</a> <a id="3647" class="Field">ffds</a><a id="3651" class="Symbol">)</a>
                <a id="3669" href="Leios.Short.html#3669" class="Bound">EBs&#39;</a> <a id="3674" class="Symbol">=</a> <a id="3676" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="3683" class="Symbol">(</a><a id="3684" href="Leios.Protocol.html#6889" class="Function">allIBRefsKnown</a> <a id="3699" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="3700" class="Symbol">)</a> <a id="3702" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3704" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="3711" class="Symbol">(</a><a id="3712" href="Leios.Blocks.html#770" class="Function Operator">_∈ᴮ</a> <a id="3716" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="3722" href="Leios.Abstract.html#961" class="Function">L</a> <a id="3724" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="3729" class="Number">1</a><a id="3730" class="Symbol">)</a> <a id="3732" href="Leios.Protocol.html#1559" class="Function">EBs</a>
                <a id="3752" href="Leios.Short.html#3752" class="Bound">votes</a> <a id="3758" class="Symbol">=</a> <a id="3760" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="3764" class="Symbol">(</a><a id="3765" href="Leios.Abstract.html#837" class="Function">vote</a> <a id="3770" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="3776" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3778" href="Class.Hashable.html#167" class="Field">hash</a><a id="3782" class="Symbol">)</a> <a id="3784" href="Leios.Short.html#3669" class="Bound">EBs&#39;</a>
          <a id="3799" class="Keyword">in</a>
          <a id="3812" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="3814" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="3826" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
          <a id="3844" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3846" href="Leios.VRF.html#2022" class="Function">canProduceV</a> <a id="3858" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="3863" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="3869" class="Symbol">(</a><a id="3870" href="Leios.Protocol.html#3374" class="Function">stake</a> <a id="3876" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="3877" class="Symbol">)</a>
          <a id="3889" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3891" href="Leios.Short.html#3647" class="Function">ffds</a> <a id="3896" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="3903" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="3908" class="Symbol">(</a><a id="3909" href="Leios.Blocks.html#4632" class="InductiveConstructor">vtHeader</a> <a id="3918" href="Leios.Short.html#3752" class="Bound">votes</a><a id="3923" class="Symbol">)</a> <a id="3925" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="3933" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="3935" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="3943" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="3946" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
          <a id="3962" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="4046" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4048" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4050" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="4060" class="Keyword">record</a> <a id="4067" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4069" class="Symbol">{</a> <a id="4071" href="Leios.Protocol.html#1429" class="Field">FFDState</a> <a id="4080" class="Symbol">=</a> <a id="4082" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a> <a id="4088" class="Symbol">}</a> <a id="4090" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
</pre>#### Negative rules
<pre class="Agda">  <a id="_↝_.No-IB-Role"></a><a id="4132" href="Leios.Short.html#4132" class="InductiveConstructor">No-IB-Role</a> <a id="4143" class="Symbol">:</a> <a id="4145" class="Keyword">let</a> <a id="4149" class="Keyword">open</a> <a id="4154" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="4165" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4167" class="Keyword">in</a>
             <a id="4183" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4185" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="4197" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
             <a id="4218" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4220" class="Symbol">(∀</a> <a id="4223" href="Leios.Short.html#4223" class="Bound">π</a> <a id="4225" class="Symbol">→</a> <a id="4227" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="4229" href="Leios.VRF.html#814" class="Function">canProduceIB</a> <a id="4242" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="4247" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="4253" class="Symbol">(</a><a id="4254" href="Leios.Protocol.html#3374" class="Function">stake</a> <a id="4260" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="4261" class="Symbol">)</a> <a id="4263" href="Leios.Short.html#4223" class="Bound">π</a><a id="4264" class="Symbol">)</a>
             <a id="4279" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="4338" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4340" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4342" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="4352" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4354" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-EB-Role"></a><a id="4376" href="Leios.Short.html#4376" class="InductiveConstructor">No-EB-Role</a> <a id="4387" class="Symbol">:</a> <a id="4389" class="Keyword">let</a> <a id="4393" class="Keyword">open</a> <a id="4398" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="4409" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4411" class="Keyword">in</a>
             <a id="4427" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4429" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="4441" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
             <a id="4462" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4464" class="Symbol">(∀</a> <a id="4467" href="Leios.Short.html#4467" class="Bound">π</a> <a id="4469" class="Symbol">→</a> <a id="4471" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="4473" href="Leios.VRF.html#1418" class="Function">canProduceEB</a> <a id="4486" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="4491" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="4497" class="Symbol">(</a><a id="4498" href="Leios.Protocol.html#3374" class="Function">stake</a> <a id="4504" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="4505" class="Symbol">)</a> <a id="4507" href="Leios.Short.html#4467" class="Bound">π</a><a id="4508" class="Symbol">)</a>
             <a id="4523" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="4582" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4584" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4586" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="4596" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4598" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-VT-Role"></a><a id="4620" href="Leios.Short.html#4620" class="InductiveConstructor">No-VT-Role</a> <a id="4631" class="Symbol">:</a> <a id="4633" class="Keyword">let</a> <a id="4637" class="Keyword">open</a> <a id="4642" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="4653" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4655" class="Keyword">in</a>
             <a id="4671" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4673" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="4685" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
             <a id="4706" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4708" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="4710" href="Leios.VRF.html#2022" class="Function">canProduceV</a> <a id="4722" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="4727" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="4733" class="Symbol">(</a><a id="4734" href="Leios.Protocol.html#3374" class="Function">stake</a> <a id="4740" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="4741" class="Symbol">)</a>
             <a id="4756" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="4815" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4817" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4819" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="4829" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4831" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
</pre>### Uniform short-pipeline
<pre class="Agda"><a id="stage"></a><a id="4878" href="Leios.Short.html#4878" class="Function">stage</a> <a id="4884" class="Symbol">:</a> <a id="4886" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="4888" class="Symbol">→</a> <a id="4890" class="Symbol">⦃</a> <a id="4892" href="Leios.Short.html#4892" class="Bound">_</a> <a id="4894" class="Symbol">:</a> <a id="4896" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="4904" href="Leios.Abstract.html#961" class="Function">L</a> <a id="4906" class="Symbol">⦄</a> <a id="4908" class="Symbol">→</a> <a id="4910" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="4912" href="Leios.Short.html#4878" class="Function">stage</a> <a id="4918" href="Leios.Short.html#4918" class="Bound">s</a> <a id="4920" class="Symbol">=</a> <a id="4922" href="Leios.Short.html#4918" class="Bound">s</a> <a id="4924" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="4926" href="Leios.Abstract.html#961" class="Function">L</a>

<a id="beginningOfStage"></a><a id="4929" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="4946" class="Symbol">:</a> <a id="4948" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="4950" class="Symbol">→</a> <a id="4952" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="4957" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="4974" href="Leios.Short.html#4974" class="Bound">s</a> <a id="4976" class="Symbol">=</a> <a id="4978" href="Leios.Short.html#4878" class="Function">stage</a> <a id="4984" href="Leios.Short.html#4974" class="Bound">s</a> <a id="4986" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="4988" href="Leios.Abstract.html#961" class="Function">L</a> <a id="4990" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4992" href="Leios.Short.html#4974" class="Bound">s</a>

<a id="allDone"></a><a id="4995" href="Leios.Short.html#4995" class="Function">allDone</a> <a id="5003" class="Symbol">:</a> <a id="5005" href="Leios.Protocol.html#1338" class="Record">LeiosState</a> <a id="5016" class="Symbol">→</a> <a id="5018" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5023" href="Leios.Short.html#4995" class="Function">allDone</a> <a id="5031" class="Keyword">record</a> <a id="5038" class="Symbol">{</a> <a id="5040" href="Leios.Protocol.html#1639" class="Field">slot</a> <a id="5045" class="Symbol">=</a> <a id="5047" href="Leios.Short.html#5047" class="Bound">slot</a> <a id="5052" class="Symbol">;</a> <a id="5054" href="Leios.Protocol.html#1733" class="Field">Upkeep</a> <a id="5061" class="Symbol">=</a> <a id="5063" href="Leios.Short.html#5063" class="Bound">Upkeep</a> <a id="5070" class="Symbol">}</a> <a id="5072" class="Symbol">=</a>
      <a id="5080" class="Symbol">(</a><a id="5081" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="5098" href="Leios.Short.html#5047" class="Bound">slot</a> <a id="5103" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5105" href="Leios.Short.html#5063" class="Bound">Upkeep</a> <a id="5112" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="5115" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5124" class="Symbol">(</a><a id="5125" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a> <a id="5133" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5135" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a> <a id="5143" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5145" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a> <a id="5153" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5155" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a> <a id="5160" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5162" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5164" class="Symbol">))</a>
  <a id="5169" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5171" class="Symbol">(</a><a id="5172" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="5174" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="5191" href="Leios.Short.html#5047" class="Bound">slot</a> <a id="5196" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5198" href="Leios.Short.html#5063" class="Bound">Upkeep</a> <a id="5205" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="5208" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5217" class="Symbol">(</a><a id="5218" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a> <a id="5226" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5228" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a> <a id="5236" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5238" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a> <a id="5243" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5245" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5247" class="Symbol">))</a>
  <a id="5252" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5254" class="Symbol">(</a><a id="5255" href="Leios.Short.html#5047" class="Bound">slot</a> <a id="5260" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5262" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a> <a id="5267" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5269" href="Leios.Short.html#5063" class="Bound">Upkeep</a> <a id="5276" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="5279" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5288" class="Symbol">(</a><a id="5289" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a> <a id="5294" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5296" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5298" class="Symbol">))</a>

<a id="5302" class="Keyword">data</a> <a id="_-⟦_/_⟧⇀_"></a><a id="5307" href="Leios.Short.html#5307" class="Datatype Operator">_-⟦_/_⟧⇀_</a> <a id="5317" class="Symbol">:</a> <a id="5319" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5325" href="Leios.Protocol.html#1338" class="Record">LeiosState</a> <a id="5336" class="Symbol">→</a> <a id="5338" href="Leios.Protocol.html#1087" class="Datatype">LeiosInput</a> <a id="5349" class="Symbol">→</a> <a id="5351" href="Leios.Protocol.html#1245" class="Datatype">LeiosOutput</a> <a id="5363" class="Symbol">→</a> <a id="5365" href="Leios.Protocol.html#1338" class="Record">LeiosState</a> <a id="5376" class="Symbol">→</a> <a id="5378" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5383" class="Keyword">where</a>
</pre>#### Initialization
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Init"></a><a id="5423" href="Leios.Short.html#5423" class="InductiveConstructor">Init</a> <a id="5428" class="Symbol">:</a>
       <a id="5437" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5439" href="Leios.Short.html#1691" class="Generalizable">ks</a> <a id="5442" href="Leios.KeyRegistration.html#476" class="Function Operator">K.-⟦</a> <a id="5447" href="Leios.KeyRegistration.html#302" class="InductiveConstructor">K.INIT</a> <a id="5454" href="Leios.SpecStructure.html#766" class="Field">pk-IB</a> <a id="5460" href="Leios.SpecStructure.html#772" class="Field">pk-EB</a> <a id="5466" href="Leios.SpecStructure.html#778" class="Field">pk-VT</a> <a id="5472" href="Leios.KeyRegistration.html#476" class="Function Operator">/</a> <a id="5474" href="Leios.KeyRegistration.html#374" class="InductiveConstructor">K.PUBKEYS</a> <a id="5484" href="Leios.Short.html#2005" class="Generalizable">pks</a> <a id="5488" href="Leios.KeyRegistration.html#476" class="Function Operator">⟧⇀</a> <a id="5491" href="Leios.Short.html#1694" class="Generalizable">ks&#39;</a>
       <a id="5502" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5504" href="Leios.SpecStructure.html#904" class="Field">initBaseState</a> <a id="5518" href="Leios.Base.html#1057" class="Function Operator">B.-⟦</a> <a id="5523" href="Leios.Base.html#763" class="InductiveConstructor">B.INIT</a> <a id="5530" class="Symbol">(</a><a id="5531" href="Leios.Base.html#677" class="Function">V-chkCerts</a> <a id="5542" href="Leios.Short.html#2005" class="Generalizable">pks</a><a id="5545" class="Symbol">)</a> <a id="5547" href="Leios.Base.html#1057" class="Function Operator">/</a> <a id="5549" href="Leios.Base.html#897" class="InductiveConstructor">B.STAKE</a> <a id="5557" href="Leios.Short.html#1968" class="Generalizable">SD</a> <a id="5560" href="Leios.Base.html#1057" class="Function Operator">⟧⇀</a> <a id="5563" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
       <a id="5574" href="Prelude.InferenceRules.html#11981" class="Function Operator">────────────────────────────────────────────────────────────────</a>
       <a id="5646" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5654" href="Leios.Short.html#5307" class="Datatype Operator">-⟦</a> <a id="5657" href="Leios.Protocol.html#1113" class="InductiveConstructor">INIT</a> <a id="5662" href="Leios.Short.html#1938" class="Generalizable">V</a> <a id="5664" href="Leios.Short.html#5307" class="Datatype Operator">/</a> <a id="5666" href="Leios.Protocol.html#1307" class="InductiveConstructor">EMPTY</a> <a id="5672" href="Leios.Short.html#5307" class="Datatype Operator">⟧⇀</a> <a id="5675" href="Leios.Protocol.html#2757" class="Function">initLeiosState</a> <a id="5690" href="Leios.Short.html#1938" class="Generalizable">V</a> <a id="5692" href="Leios.Short.html#1968" class="Generalizable">SD</a> <a id="5695" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a> <a id="5699" href="Leios.Short.html#2005" class="Generalizable">pks</a>
</pre>#### Network and Ledger
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Slot"></a><a id="5741" href="Leios.Short.html#5741" class="InductiveConstructor">Slot</a> <a id="5746" class="Symbol">:</a> <a id="5748" class="Keyword">let</a> <a id="5752" class="Keyword">open</a> <a id="5757" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="5768" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="5770" class="Keyword">renaming</a> <a id="5779" class="Symbol">(</a><a id="5780" href="Leios.Protocol.html#1429" class="Field">FFDState</a> <a id="5789" class="Symbol">to</a> <a id="5792" class="Field">ffds</a><a id="5796" class="Symbol">;</a> <a id="5798" href="Leios.Protocol.html#1768" class="Field">BaseState</a> <a id="5808" class="Symbol">to</a> <a id="5811" class="Field">bs</a><a id="5813" class="Symbol">)</a> <a id="5815" class="Keyword">in</a>
       <a id="5825" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5827" href="Leios.Short.html#4995" class="Function">allDone</a> <a id="5835" href="Leios.Short.html#1552" class="Generalizable">s</a>
       <a id="5844" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5846" href="Leios.Short.html#5811" class="Function">bs</a> <a id="5849" href="Leios.Base.html#1057" class="Function Operator">B.-⟦</a> <a id="5854" href="Leios.Base.html#848" class="InductiveConstructor">B.FTCH-LDG</a> <a id="5865" href="Leios.Base.html#1057" class="Function Operator">/</a> <a id="5867" href="Leios.Base.html#948" class="InductiveConstructor">B.BASE-LDG</a> <a id="5878" href="Leios.Short.html#1860" class="Generalizable">rbs</a> <a id="5882" href="Leios.Base.html#1057" class="Function Operator">⟧⇀</a> <a id="5885" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
       <a id="5896" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5898" href="Leios.Short.html#5792" class="Function">ffds</a> <a id="5903" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="5910" href="Leios.FFD.html#351" class="InductiveConstructor">Fetch</a> <a id="5916" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="5918" href="Leios.FFD.html#419" class="InductiveConstructor">FetchRes</a> <a id="5927" href="Leios.Short.html#1725" class="Generalizable">msgs</a> <a id="5932" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="5935" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
       <a id="5948" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
       <a id="6027" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6032" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6034" href="Leios.Short.html#5307" class="Datatype Operator">-⟦</a> <a id="6037" href="Leios.Protocol.html#1193" class="InductiveConstructor">SLOT</a> <a id="6042" href="Leios.Short.html#5307" class="Datatype Operator">/</a> <a id="6044" href="Leios.Protocol.html#1307" class="InductiveConstructor">EMPTY</a> <a id="6050" href="Leios.Short.html#5307" class="Datatype Operator">⟧⇀</a> <a id="6053" class="Keyword">record</a> <a id="6060" href="Leios.Short.html#1552" class="Generalizable">s</a>
           <a id="6073" class="Symbol">{</a> <a id="6075" href="Leios.Protocol.html#1429" class="Field">FFDState</a>  <a id="6085" class="Symbol">=</a> <a id="6087" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
           <a id="6104" class="Symbol">;</a> <a id="6106" href="Leios.Protocol.html#1768" class="Field">BaseState</a> <a id="6116" class="Symbol">=</a> <a id="6118" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
           <a id="6133" class="Symbol">;</a> <a id="6135" href="Leios.Protocol.html#1461" class="Field">Ledger</a>    <a id="6145" class="Symbol">=</a> <a id="6147" href="Leios.Protocol.html#2275" class="Function">constructLedger</a> <a id="6163" href="Leios.Short.html#1860" class="Generalizable">rbs</a>
           <a id="6178" class="Symbol">;</a> <a id="6180" href="Leios.Protocol.html#1639" class="Field">slot</a>      <a id="6190" class="Symbol">=</a> <a id="6192" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6196" href="Leios.Protocol.html#1639" class="Function">slot</a>
           <a id="6212" class="Symbol">;</a> <a id="6214" href="Leios.Protocol.html#1733" class="Field">Upkeep</a>    <a id="6224" class="Symbol">=</a> <a id="6226" href="Class.HasEmptySet.html#287" class="Field">∅</a>
           <a id="6239" class="Symbol">}</a> <a id="6241" href="Leios.Protocol.html#8294" class="Function Operator">↑</a> <a id="6243" href="Data.List.Base.html#10687" class="Function">L.filter</a> <a id="6252" class="Symbol">(</a><a id="6253" href="Leios.Protocol.html#6632" class="Function">isValid?</a> <a id="6262" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="6263" class="Symbol">)</a> <a id="6265" href="Leios.Short.html#1725" class="Generalizable">msgs</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Ftch"></a><a id="6284" href="Leios.Short.html#6284" class="InductiveConstructor">Ftch</a> <a id="6289" class="Symbol">:</a>
       <a id="6298" href="Prelude.InferenceRules.html#42426" class="Function Operator">────────────────────────────────────────────────────────</a>
       <a id="6362" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6367" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6369" href="Leios.Short.html#5307" class="Datatype Operator">-⟦</a> <a id="6372" href="Leios.Protocol.html#1217" class="InductiveConstructor">FTCH-LDG</a> <a id="6381" href="Leios.Short.html#5307" class="Datatype Operator">/</a> <a id="6383" href="Leios.Protocol.html#1272" class="InductiveConstructor">FTCH-LDG</a> <a id="6392" class="Symbol">(</a><a id="6393" href="Leios.Protocol.html#1461" class="Field">LeiosState.Ledger</a> <a id="6411" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="6412" class="Symbol">)</a> <a id="6414" href="Leios.Short.html#5307" class="Datatype Operator">⟧⇀</a> <a id="6417" href="Leios.Short.html#1552" class="Generalizable">s</a>
</pre>#### Base chain

Note: Submitted data to the base chain is only taken into account
      if the party submitting is the block producer on the base chain
      for the given slot
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₁"></a><a id="6611" href="Leios.Short.html#6611" class="InductiveConstructor">Base₁</a>   <a id="6619" class="Symbol">:</a>
          <a id="6631" href="Prelude.InferenceRules.html#41139" class="Function Operator">───────────────────────────────────────────────────────────────────</a>
          <a id="6709" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6714" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6716" href="Leios.Short.html#5307" class="Datatype Operator">-⟦</a> <a id="6719" href="Leios.Protocol.html#1143" class="InductiveConstructor">SUBMIT</a> <a id="6726" class="Symbol">(</a><a id="6727" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6732" href="Leios.Short.html#1904" class="Generalizable">txs</a><a id="6735" class="Symbol">)</a> <a id="6737" href="Leios.Short.html#5307" class="Datatype Operator">/</a> <a id="6739" href="Leios.Protocol.html#1307" class="InductiveConstructor">EMPTY</a> <a id="6745" href="Leios.Short.html#5307" class="Datatype Operator">⟧⇀</a> <a id="6748" class="Keyword">record</a> <a id="6755" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6757" class="Symbol">{</a> <a id="6759" href="Leios.Protocol.html#1491" class="Field">ToPropose</a> <a id="6769" class="Symbol">=</a> <a id="6771" href="Leios.Short.html#1904" class="Generalizable">txs</a> <a id="6775" class="Symbol">}</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₂a"></a><a id="6791" href="Leios.Short.html#6791" class="InductiveConstructor">Base₂a</a>  <a id="6799" class="Symbol">:</a> <a id="6801" class="Keyword">let</a> <a id="6805" class="Keyword">open</a> <a id="6810" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="6821" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6823" class="Keyword">renaming</a> <a id="6832" class="Symbol">(</a><a id="6833" href="Leios.Protocol.html#1768" class="Field">BaseState</a> <a id="6843" class="Symbol">to</a> <a id="6846" class="Field">bs</a><a id="6848" class="Symbol">)</a> <a id="6850" class="Keyword">in</a>
          <a id="6863" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="6865" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="6877" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>
          <a id="6892" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="6894" href="Leios.Short.html#1820" class="Generalizable">eb</a> <a id="6897" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="6899" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="6906" class="Symbol">(λ</a> <a id="6909" href="Leios.Short.html#6909" class="Bound">eb</a> <a id="6912" class="Symbol">→</a> <a id="6914" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="6930" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6932" href="Leios.Short.html#6909" class="Bound">eb</a> <a id="6935" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6937" href="Leios.Short.html#6909" class="Bound">eb</a> <a id="6940" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="6943" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="6949" href="Leios.Abstract.html#961" class="Function">L</a> <a id="6951" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="6956" class="Number">2</a><a id="6957" class="Symbol">)</a> <a id="6959" href="Leios.Protocol.html#1559" class="Function">EBs</a>
          <a id="6973" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="6975" href="Leios.Short.html#6846" class="Function">bs</a> <a id="6978" href="Leios.Base.html#1057" class="Function Operator">B.-⟦</a> <a id="6983" href="Leios.Base.html#814" class="InductiveConstructor">B.SUBMIT</a> <a id="6992" class="Symbol">(</a><a id="6993" href="Data.These.Base.html#595" class="InductiveConstructor">this</a> <a id="6998" href="Leios.Short.html#1820" class="Generalizable">eb</a><a id="7000" class="Symbol">)</a> <a id="7002" href="Leios.Base.html#1057" class="Function Operator">/</a> <a id="7004" href="Leios.Base.html#929" class="InductiveConstructor">B.EMPTY</a> <a id="7012" href="Leios.Base.html#1057" class="Function Operator">⟧⇀</a> <a id="7015" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
          <a id="7029" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="7111" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7116" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7118" href="Leios.Short.html#5307" class="Datatype Operator">-⟦</a> <a id="7121" href="Leios.Protocol.html#1193" class="InductiveConstructor">SLOT</a> <a id="7126" href="Leios.Short.html#5307" class="Datatype Operator">/</a> <a id="7128" href="Leios.Protocol.html#1307" class="InductiveConstructor">EMPTY</a> <a id="7134" href="Leios.Short.html#5307" class="Datatype Operator">⟧⇀</a> <a id="7137" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="7147" class="Keyword">record</a> <a id="7154" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7156" class="Symbol">{</a> <a id="7158" href="Leios.Protocol.html#1768" class="Field">BaseState</a> <a id="7168" class="Symbol">=</a> <a id="7170" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a> <a id="7174" class="Symbol">}</a> <a id="7176" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>

  <a id="_-⟦_/_⟧⇀_.Base₂b"></a><a id="7184" href="Leios.Short.html#7184" class="InductiveConstructor">Base₂b</a>  <a id="7192" class="Symbol">:</a> <a id="7194" class="Keyword">let</a> <a id="7198" class="Keyword">open</a> <a id="7203" href="Leios.Protocol.html#1338" class="Module">LeiosState</a> <a id="7214" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7216" class="Keyword">renaming</a> <a id="7225" class="Symbol">(</a><a id="7226" href="Leios.Protocol.html#1768" class="Field">BaseState</a> <a id="7236" class="Symbol">to</a> <a id="7239" class="Field">bs</a><a id="7241" class="Symbol">)</a> <a id="7243" class="Keyword">in</a>
          <a id="7256" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="7258" href="Leios.Protocol.html#2402" class="Function">needsUpkeep</a> <a id="7270" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>
          <a id="7285" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7287" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7290" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7292" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="7299" class="Symbol">(λ</a> <a id="7302" href="Leios.Short.html#7302" class="Bound">eb</a> <a id="7305" class="Symbol">→</a> <a id="7307" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="7323" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7325" href="Leios.Short.html#7302" class="Bound">eb</a> <a id="7328" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7330" href="Leios.Short.html#7302" class="Bound">eb</a> <a id="7333" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="7336" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="7342" href="Leios.Abstract.html#961" class="Function">L</a> <a id="7344" href="Leios.Protocol.html#1639" class="Function">slot</a> <a id="7349" class="Number">2</a><a id="7350" class="Symbol">)</a> <a id="7352" href="Leios.Protocol.html#1559" class="Function">EBs</a>
          <a id="7366" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7368" href="Leios.Short.html#7239" class="Function">bs</a> <a id="7371" href="Leios.Base.html#1057" class="Function Operator">B.-⟦</a> <a id="7376" href="Leios.Base.html#814" class="InductiveConstructor">B.SUBMIT</a> <a id="7385" class="Symbol">(</a><a id="7386" href="Data.These.Base.html#623" class="InductiveConstructor">that</a> <a id="7391" href="Leios.Protocol.html#1491" class="Function">ToPropose</a><a id="7400" class="Symbol">)</a> <a id="7402" href="Leios.Base.html#1057" class="Function Operator">/</a> <a id="7404" href="Leios.Base.html#929" class="InductiveConstructor">B.EMPTY</a> <a id="7412" href="Leios.Base.html#1057" class="Function Operator">⟧⇀</a> <a id="7415" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
          <a id="7429" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="7511" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7516" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7518" href="Leios.Short.html#5307" class="Datatype Operator">-⟦</a> <a id="7521" href="Leios.Protocol.html#1193" class="InductiveConstructor">SLOT</a> <a id="7526" href="Leios.Short.html#5307" class="Datatype Operator">/</a> <a id="7528" href="Leios.Protocol.html#1307" class="InductiveConstructor">EMPTY</a> <a id="7534" href="Leios.Short.html#5307" class="Datatype Operator">⟧⇀</a> <a id="7537" href="Leios.Protocol.html#2587" class="Function">addUpkeep</a> <a id="7547" class="Keyword">record</a> <a id="7554" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7556" class="Symbol">{</a> <a id="7558" href="Leios.Protocol.html#1768" class="Field">BaseState</a> <a id="7568" class="Symbol">=</a> <a id="7570" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a> <a id="7574" class="Symbol">}</a> <a id="7576" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>
</pre>#### Protocol rules
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Roles"></a><a id="7615" href="Leios.Short.html#7615" class="InductiveConstructor">Roles</a> <a id="7621" class="Symbol">:</a>
        <a id="7631" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="7633" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7635" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="7637" href="Leios.Short.html#1554" class="Generalizable">s&#39;</a>
        <a id="7648" href="Prelude.InferenceRules.html#13801" class="Function Operator">─────────────────────────────</a>
        <a id="7686" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7691" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7693" href="Leios.Short.html#5307" class="Datatype Operator">-⟦</a> <a id="7696" href="Leios.Protocol.html#1193" class="InductiveConstructor">SLOT</a> <a id="7701" href="Leios.Short.html#5307" class="Datatype Operator">/</a> <a id="7703" href="Leios.Protocol.html#1307" class="InductiveConstructor">EMPTY</a> <a id="7709" href="Leios.Short.html#5307" class="Datatype Operator">⟧⇀</a> <a id="7712" href="Leios.Short.html#1554" class="Generalizable">s&#39;</a>
</pre>
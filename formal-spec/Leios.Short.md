## Short-Pipeline Leios

<!--
<pre class="Agda"><a id="39" class="Symbol">{-#</a> <a id="43" class="Keyword">OPTIONS</a> <a id="51" class="Pragma">--safe</a> <a id="58" class="Symbol">#-}</a>
<a id="62" class="Keyword">open</a> <a id="67" class="Keyword">import</a> <a id="74" href="Leios.Prelude.html" class="Module">Leios.Prelude</a> <a id="88" class="Keyword">hiding</a> <a id="95" class="Symbol">(</a><a id="96" href="Function.Base.html#704" class="Function">id</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Leios.FFD.html" class="Module">Leios.FFD</a>
<a id="122" class="Keyword">open</a> <a id="127" class="Keyword">import</a> <a id="134" href="Leios.SpecStructure.html" class="Module">Leios.SpecStructure</a>

<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Tactic.Defaults.html" class="Module">Tactic.Defaults</a>
<a id="183" class="Keyword">open</a> <a id="188" class="Keyword">import</a> <a id="195" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="216" class="Keyword">module</a> <a id="223" href="Leios.Short.html" class="Module">Leios.Short</a> <a id="235" class="Symbol">(</a><a id="236" href="Leios.Short.html#236" class="Bound">⋯</a> <a id="238" class="Symbol">:</a> <a id="240" href="Leios.SpecStructure.html#286" class="Record">SpecStructure</a> <a id="254" class="Number">1</a><a id="255" class="Symbol">)</a>
  <a id="259" class="Symbol">(</a><a id="260" class="Keyword">let</a> <a id="264" class="Keyword">open</a> <a id="269" href="Leios.SpecStructure.html#286" class="Module">SpecStructure</a> <a id="283" href="Leios.Short.html#236" class="Bound">⋯</a> <a id="285" class="Keyword">renaming</a> <a id="294" class="Symbol">(</a><a id="295" href="Leios.Voting.html#203" class="Function">isVoteCertified</a> <a id="311" class="Symbol">to</a> <a id="314" class="Function">isVoteCertified&#39;</a><a id="330" class="Symbol">))</a> <a id="333" class="Keyword">where</a>
</pre>-->

This document is a specification of Short-Pipeline Leios, usually
abbreviated as Short Leios. On a high level, the pipeline looks like this:

1. If elected, propose IB
2. Wait
3. Wait
4. If elected, propose EB
5. If elected, vote
   If elected, propose RB

### Upkeep

A node that never produces a block even though it could is not
supposed to be an honest node, and we prevent that by tracking whether
a node has checked if it can make a block in a particular slot.
`LeiosState` contains a set of `SlotUpkeep` and we ensure that this
set contains all elements before we can advance to the next slot,
resetting this field to the empty set.

<pre class="Agda"><a id="997" class="Keyword">data</a> <a id="SlotUpkeep"></a><a id="1002" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a> <a id="1013" class="Symbol">:</a> <a id="1015" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1020" class="Keyword">where</a>
  <a id="SlotUpkeep.Base"></a><a id="1028" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="SlotUpkeep.IB-Role"></a><a id="1033" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a> <a id="SlotUpkeep.EB-Role"></a><a id="1041" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a> <a id="1049" class="Symbol">:</a> <a id="1051" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a>

<a id="1063" class="Keyword">unquoteDecl</a> <a id="DecEq-SlotUpkeep"></a><a id="1075" href="Leios.Short.html#1075" class="Function">DecEq-SlotUpkeep</a> <a id="1092" class="Symbol">=</a> <a id="1094" href="Tactic.Derive.DecEq.html#3512" class="Function">derive-DecEq</a> <a id="1107" class="Symbol">((</a><a id="1109" class="Keyword">quote</a> <a id="1115" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a> <a id="1126" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1128" href="Leios.Short.html#1075" class="Function">DecEq-SlotUpkeep</a><a id="1144" class="Symbol">)</a> <a id="1146" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1148" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1150" class="Symbol">)</a>
</pre><!--
<pre class="Agda"><a id="1169" class="Keyword">data</a> <a id="StageUpkeep"></a><a id="1174" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a> <a id="1186" class="Symbol">:</a> <a id="1188" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1193" class="Keyword">where</a>
  <a id="StageUpkeep.VT-Role"></a><a id="1201" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a> <a id="1209" class="Symbol">:</a> <a id="1211" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a>

<a id="1224" class="Keyword">unquoteDecl</a> <a id="DecEq-StageUpkeep"></a><a id="1236" href="Leios.Short.html#1236" class="Function">DecEq-StageUpkeep</a> <a id="1254" class="Symbol">=</a> <a id="1256" href="Tactic.Derive.DecEq.html#3512" class="Function">derive-DecEq</a> <a id="1269" class="Symbol">((</a><a id="1271" class="Keyword">quote</a> <a id="1277" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a> <a id="1289" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1291" href="Leios.Short.html#1236" class="Function">DecEq-StageUpkeep</a><a id="1308" class="Symbol">)</a> <a id="1310" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1312" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1314" class="Symbol">)</a>
</pre><pre class="Agda"><a id="1328" class="Keyword">open</a> <a id="1333" class="Keyword">import</a> <a id="1340" href="Leios.Protocol.html" class="Module">Leios.Protocol</a> <a id="1355" class="Symbol">(</a><a id="1356" href="Leios.Short.html#236" class="Bound">⋯</a><a id="1357" class="Symbol">)</a> <a id="1359" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a> <a id="1370" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a> <a id="1382" class="Keyword">public</a>

<a id="1390" class="Keyword">open</a> <a id="1395" href="Leios.Base.html#576" class="Module">BaseAbstract</a> <a id="1408" href="Leios.SpecStructure.html#835" class="Field">B&#39;</a> <a id="1411" class="Keyword">using</a> <a id="1417" class="Symbol">(</a><a id="1418" href="Leios.Base.html#611" class="Field">Cert</a><a id="1422" class="Symbol">;</a> <a id="1424" href="Leios.Base.html#677" class="Field">V-chkCerts</a><a id="1434" class="Symbol">;</a> <a id="1436" href="Leios.Base.html#631" class="Field">VTy</a><a id="1439" class="Symbol">;</a> <a id="1441" href="Leios.Base.html#650" class="Field">initSlot</a><a id="1449" class="Symbol">)</a>
<a id="1451" class="Keyword">open</a> <a id="1456" href="Leios.SpecStructure.html#1203" class="Module">FFD</a> <a id="1460" class="Keyword">hiding</a> <a id="1467" class="Symbol">(</a><a id="1468" href="Leios.FFD.html#562" class="Function Operator">_-⟦_/_⟧⇀_</a><a id="1477" class="Symbol">)</a>
<a id="1479" class="Keyword">open</a> <a id="1484" href="Leios.Blocks.html#4489" class="Module">GenFFD</a>
</pre><pre class="Agda"><a id="isVoteCertified"></a><a id="1503" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="1519" class="Symbol">:</a> <a id="1521" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="1532" class="Symbol">→</a> <a id="1534" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a> <a id="1548" class="Symbol">→</a> <a id="1550" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1555" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="1571" href="Leios.Short.html#1571" class="Bound">s</a> <a id="1573" href="Leios.Short.html#1573" class="Bound">eb</a> <a id="1576" class="Symbol">=</a> <a id="1578" href="Leios.Short.html#314" class="Function">isVoteCertified&#39;</a> <a id="1595" class="Symbol">(</a><a id="1596" href="Leios.Protocol.html#1869" class="Field">LeiosState.votingState</a> <a id="1619" href="Leios.Short.html#1571" class="Bound">s</a><a id="1620" class="Symbol">)</a> <a id="1622" class="Symbol">(</a><a id="1623" href="Data.Fin.Patterns.html#399" class="InductiveConstructor">0F</a> <a id="1626" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1628" href="Leios.Short.html#1573" class="Bound">eb</a><a id="1630" class="Symbol">)</a>
</pre><pre class="Agda"><a id="1644" class="Keyword">private</a> <a id="1652" class="Keyword">variable</a> <a id="1661" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="1663" href="Leios.Short.html#1663" class="Generalizable">s&#39;</a>   <a id="1668" class="Symbol">:</a> <a id="1670" href="Leios.Protocol.html#1359" class="Record">LeiosState</a>
                 <a id="1698" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>  <a id="1705" class="Symbol">:</a> <a id="1707" href="Leios.FFD.html#508" class="Function">FFD.State</a>
                 <a id="1734" href="Leios.Short.html#1734" class="Generalizable">π</a>      <a id="1741" class="Symbol">:</a> <a id="1743" href="Leios.Abstract.html#578" class="Function">VrfPf</a>
                 <a id="1766" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>    <a id="1773" class="Symbol">:</a> <a id="1775" href="Leios.Base.html#3253" class="Function">B.State</a>
                 <a id="1800" href="Leios.Short.html#1800" class="Generalizable">ks</a> <a id="1803" href="Leios.Short.html#1803" class="Generalizable">ks&#39;</a> <a id="1807" class="Symbol">:</a> <a id="1809" href="Leios.KeyRegistration.html#453" class="Function">K.State</a>
                 <a id="1834" href="Leios.Short.html#1834" class="Generalizable">msgs</a>   <a id="1841" class="Symbol">:</a> <a id="1843" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1848" class="Symbol">(</a><a id="1849" href="Leios.FFD.html#117" class="Field">FFDAbstract.Header</a> <a id="1868" href="Leios.Blocks.html#5537" class="Function">ffdAbstract</a> <a id="1880" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="1882" href="Leios.FFD.html#124" class="Field">FFDAbstract.Body</a> <a id="1899" href="Leios.Blocks.html#5537" class="Function">ffdAbstract</a><a id="1910" class="Symbol">)</a>
                 <a id="1929" href="Leios.Short.html#1929" class="Generalizable">eb</a>     <a id="1936" class="Symbol">:</a> <a id="1938" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a>
                 <a id="1969" href="Leios.Short.html#1969" class="Generalizable">ebs</a>    <a id="1976" class="Symbol">:</a> <a id="1978" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1983" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a>
                 <a id="2014" href="Leios.Short.html#2014" class="Generalizable">rbs</a>    <a id="2021" class="Symbol">:</a> <a id="2023" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2028" href="Leios.Base.html#503" class="Function">RankingBlock</a>
                 <a id="2058" href="Leios.Short.html#2058" class="Generalizable">txs</a>    <a id="2065" class="Symbol">:</a> <a id="2067" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2072" href="Leios.Abstract.html#457" class="Function">Tx</a>
                 <a id="2092" href="Leios.Short.html#2092" class="Generalizable">V</a>      <a id="2099" class="Symbol">:</a> <a id="2101" href="Leios.Base.html#631" class="Function">VTy</a>
                 <a id="2122" href="Leios.Short.html#2122" class="Generalizable">SD</a>     <a id="2129" class="Symbol">:</a> <a id="2131" href="Leios.Base.html#453" class="Function">StakeDistr</a>
                 <a id="2159" href="Leios.Short.html#2159" class="Generalizable">pks</a>    <a id="2166" class="Symbol">:</a> <a id="2168" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2173" href="Leios.VRF.html#911" class="Function">PubKey</a>
</pre>-->
### Block/Vote production

IBs from the last 3 pipelines are directly included in the EB, when the late IB inclusion
flag is set
<pre class="Agda"><a id="IBSelection"></a><a id="2325" href="Leios.Short.html#2325" class="Function">IBSelection</a> <a id="2337" class="Symbol">:</a> <a id="2339" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="2350" class="Symbol">→</a> <a id="2352" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a> <a id="2357" class="Symbol">→</a> <a id="2359" href="Leios.Blocks.html#1348" class="Record">InputBlock</a> <a id="2370" class="Symbol">→</a> <a id="2372" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="2377" href="Leios.Short.html#2325" class="Function">IBSelection</a> <a id="2389" href="Leios.Short.html#2389" class="Bound">s</a> <a id="2391" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="2397" class="Symbol">=</a> <a id="2399" href="Leios.Blocks.html#770" class="Function Operator">_∈ᴮ</a> <a id="2403" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="2409" href="Leios.Abstract.html#961" class="Function">L</a> <a id="2411" class="Symbol">(</a><a id="2412" href="Leios.Protocol.html#1668" class="Field">LeiosState.slot</a> <a id="2428" href="Leios.Short.html#2389" class="Bound">s</a><a id="2429" class="Symbol">)</a> <a id="2431" class="Number">3</a>
<a id="2433" href="Leios.Short.html#2325" class="Function">IBSelection</a> <a id="2445" href="Leios.Short.html#2445" class="Bound">s</a> <a id="2447" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a>  <a id="2453" class="Symbol">=</a> <a id="2455" href="Leios.Blocks.html#770" class="Function Operator">_∈ᴮ</a> <a id="2459" href="Leios.Prelude.html#1475" class="Function">slices</a> <a id="2466" href="Leios.Abstract.html#961" class="Function">L</a> <a id="2468" class="Symbol">(</a><a id="2469" href="Leios.Protocol.html#1668" class="Field">LeiosState.slot</a> <a id="2485" href="Leios.Short.html#2445" class="Bound">s</a><a id="2486" class="Symbol">)</a> <a id="2488" class="Number">3</a> <a id="2490" class="Number">6</a>

<a id="IBSelection?"></a><a id="2493" href="Leios.Short.html#2493" class="Function">IBSelection?</a> <a id="2506" class="Symbol">:</a> <a id="2508" class="Symbol">(</a><a id="2509" href="Leios.Short.html#2509" class="Bound">s</a> <a id="2511" class="Symbol">:</a> <a id="2513" href="Leios.Protocol.html#1359" class="Record">LeiosState</a><a id="2523" class="Symbol">)</a> <a id="2525" class="Symbol">→</a> <a id="2527" class="Symbol">(</a><a id="2528" href="Leios.Short.html#2528" class="Bound">b</a> <a id="2530" class="Symbol">:</a> <a id="2532" href="Agda.Builtin.Bool.html#173" class="Datatype">Bool</a><a id="2536" class="Symbol">)</a> <a id="2538" class="Symbol">→</a> <a id="2540" class="Symbol">(</a><a id="2541" href="Leios.Short.html#2541" class="Bound">ib</a> <a id="2544" class="Symbol">:</a> <a id="2546" href="Leios.Blocks.html#1348" class="Record">InputBlock</a><a id="2556" class="Symbol">)</a> <a id="2558" class="Symbol">→</a> <a id="2560" href="Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="2564" class="Symbol">(</a><a id="2565" href="Leios.Short.html#2325" class="Function">IBSelection</a> <a id="2577" href="Leios.Short.html#2509" class="Bound">s</a> <a id="2579" href="Leios.Short.html#2528" class="Bound">b</a> <a id="2581" href="Leios.Short.html#2541" class="Bound">ib</a><a id="2583" class="Symbol">)</a>
<a id="2585" href="Leios.Short.html#2493" class="Function">IBSelection?</a> <a id="2598" href="Leios.Short.html#2598" class="Bound">s</a> <a id="2600" href="Agda.Builtin.Bool.html#192" class="InductiveConstructor">false</a> <a id="2606" href="Leios.Short.html#2606" class="Bound">ib</a> <a id="2609" class="Symbol">=</a> <a id="2611" href="Leios.Blocks.html#640" class="Field">slotNumber</a> <a id="2622" href="Leios.Short.html#2606" class="Bound">ib</a> <a id="2625" href="Axiom.Set.html#10771" class="Function Operator">∈?</a> <a id="2628" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="2634" href="Leios.Abstract.html#961" class="Function">L</a> <a id="2636" class="Symbol">(</a><a id="2637" href="Leios.Protocol.html#1668" class="Field">LeiosState.slot</a> <a id="2653" href="Leios.Short.html#2598" class="Bound">s</a><a id="2654" class="Symbol">)</a> <a id="2656" class="Number">3</a>
<a id="2658" href="Leios.Short.html#2493" class="Function">IBSelection?</a> <a id="2671" href="Leios.Short.html#2671" class="Bound">s</a> <a id="2673" href="Agda.Builtin.Bool.html#198" class="InductiveConstructor">true</a> <a id="2678" href="Leios.Short.html#2678" class="Bound">ib</a>  <a id="2682" class="Symbol">=</a> <a id="2684" href="Leios.Blocks.html#640" class="Field">slotNumber</a> <a id="2695" href="Leios.Short.html#2678" class="Bound">ib</a> <a id="2698" href="Axiom.Set.html#10771" class="Function Operator">∈?</a> <a id="2701" href="Leios.Prelude.html#1475" class="Function">slices</a> <a id="2708" href="Leios.Abstract.html#961" class="Function">L</a> <a id="2710" class="Symbol">(</a><a id="2711" href="Leios.Protocol.html#1668" class="Field">LeiosState.slot</a> <a id="2727" href="Leios.Short.html#2671" class="Bound">s</a><a id="2728" class="Symbol">)</a> <a id="2730" class="Number">3</a> <a id="2732" class="Number">6</a>
</pre>We now define the rules for block production given by the relation `_↝_`. These are split in two:

1. Positive rules, when we do need to create a block.
2. Negative rules, when we cannot create a block.

The purpose of the negative rules is to properly adjust the upkeep if
we cannot make a block.

Note that `_↝_`, starting with an empty upkeep can always make exactly
three steps corresponding to the three types of Leios specific blocks.

<pre class="Agda"><a id="3188" class="Keyword">data</a> <a id="_↝_"></a><a id="3193" href="Leios.Short.html#3193" class="Datatype Operator">_↝_</a> <a id="3197" class="Symbol">:</a> <a id="3199" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="3210" class="Symbol">→</a> <a id="3212" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="3223" class="Symbol">→</a> <a id="3225" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3230" class="Keyword">where</a>
</pre>#### Positive rules
<pre class="Agda">  <a id="_↝_.IB-Role"></a><a id="3270" href="Leios.Short.html#3270" class="InductiveConstructor">IB-Role</a> <a id="3278" class="Symbol">:</a> <a id="3280" class="Keyword">let</a> <a id="3284" class="Keyword">open</a> <a id="3289" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="3300" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3302" class="Keyword">renaming</a> <a id="3311" class="Symbol">(</a><a id="3312" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="3321" class="Symbol">to</a> <a id="3324" class="Field">ffds</a><a id="3328" class="Symbol">)</a>
                <a id="3346" href="Leios.Short.html#3346" class="Bound">b</a> <a id="3348" class="Symbol">=</a> <a id="3350" href="Leios.Blocks.html#4692" class="InductiveConstructor">ibBody</a> <a id="3357" class="Symbol">(</a><a id="3358" class="Keyword">record</a> <a id="3365" class="Symbol">{</a> <a id="3367" href="Leios.Blocks.html#1326" class="Field">txs</a> <a id="3371" class="Symbol">=</a> <a id="3373" href="Leios.Protocol.html#1516" class="Function">ToPropose</a> <a id="3383" class="Symbol">})</a>
                <a id="3402" href="Leios.Short.html#3402" class="Bound">h</a> <a id="3404" class="Symbol">=</a> <a id="3406" href="Leios.Blocks.html#4561" class="InductiveConstructor">ibHeader</a> <a id="3415" class="Symbol">(</a><a id="3416" href="Leios.Blocks.html#2141" class="Function">mkIBHeader</a> <a id="3427" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="3432" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="3435" href="Leios.Short.html#1734" class="Generalizable">π</a> <a id="3437" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="3443" href="Leios.Protocol.html#1516" class="Function">ToPropose</a><a id="3452" class="Symbol">)</a>
          <a id="3464" class="Keyword">in</a>
          <a id="3477" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="3479" href="Leios.VRF.html#1245" class="Function">canProduceIB</a> <a id="3492" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="3497" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="3503" class="Symbol">(</a><a id="3504" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="3510" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="3511" class="Symbol">)</a> <a id="3513" href="Leios.Short.html#1734" class="Generalizable">π</a>
          <a id="3525" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3527" href="Leios.Short.html#3324" class="Function">ffds</a> <a id="3532" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="3539" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="3544" href="Leios.Short.html#3402" class="Bound">h</a> <a id="3546" class="Symbol">(</a><a id="3547" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3552" href="Leios.Short.html#3346" class="Bound">b</a><a id="3553" class="Symbol">)</a> <a id="3555" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="3557" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="3565" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="3568" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
          <a id="3584" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="3668" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3670" href="Leios.Short.html#3193" class="Datatype Operator">↝</a> <a id="3672" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="3682" class="Keyword">record</a> <a id="3689" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3691" class="Symbol">{</a> <a id="3693" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="3702" class="Symbol">=</a> <a id="3704" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a> <a id="3710" class="Symbol">}</a> <a id="3712" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>
</pre>When η = 0 there is no indirect ledger inclusion; in case η > 0 earlier EBs might
be referenced (Full-Short Leios).
<pre class="Agda">  <a id="_↝_.EB-Role"></a><a id="3850" href="Leios.Short.html#3850" class="InductiveConstructor">EB-Role</a> <a id="3858" class="Symbol">:</a> <a id="3860" class="Keyword">let</a> <a id="3864" class="Keyword">open</a> <a id="3869" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="3880" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3882" class="Keyword">renaming</a> <a id="3891" class="Symbol">(</a><a id="3892" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="3901" class="Symbol">to</a> <a id="3904" class="Field">ffds</a><a id="3908" class="Symbol">)</a>
                <a id="3926" href="Leios.Short.html#3926" class="Bound">ibs</a> <a id="3930" class="Symbol">=</a> <a id="3932" href="Data.List.Base.html#10687" class="Function">L.filter</a> <a id="3941" class="Symbol">(</a><a id="3942" href="Leios.Short.html#2493" class="Function">IBSelection?</a> <a id="3955" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3957" href="Leios.Abstract.html#1023" class="Function">Late-IB-Inclusion</a><a id="3974" class="Symbol">)</a> <a id="3976" href="Leios.Protocol.html#1547" class="Function">IBs</a>
                <a id="3996" href="Leios.Short.html#3996" class="Bound">LI</a>  <a id="4000" class="Symbol">=</a> <a id="4002" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="4006" href="Leios.Blocks.html#2547" class="Function">getIBRef</a> <a id="4015" href="Leios.Short.html#3926" class="Bound">ibs</a>
                <a id="4035" href="Leios.Short.html#4035" class="Bound">LE</a>  <a id="4039" class="Symbol">=</a> <a id="4041" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="4045" href="Leios.Blocks.html#4034" class="Function">getEBRef</a> <a id="4054" href="Leios.Short.html#1969" class="Generalizable">ebs</a>
                <a id="4074" href="Leios.Short.html#4074" class="Bound">h</a>   <a id="4078" class="Symbol">=</a> <a id="4080" href="Leios.Blocks.html#3578" class="Function">mkEB</a> <a id="4085" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="4090" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="4093" href="Leios.Short.html#1734" class="Generalizable">π</a> <a id="4095" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="4101" href="Leios.Short.html#3996" class="Bound">LI</a> <a id="4104" href="Leios.Short.html#4035" class="Bound">LE</a>
                <a id="4123" href="Leios.Short.html#4123" class="Bound">P</a>   <a id="4127" class="Symbol">=</a> <a id="4129" class="Symbol">λ</a> <a id="4131" href="Leios.Short.html#4131" class="Bound">x</a> <a id="4133" class="Symbol">→</a> <a id="4135" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="4151" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4153" href="Leios.Short.html#4131" class="Bound">x</a>
                         <a id="4180" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4182" href="Leios.Short.html#4131" class="Bound">x</a> <a id="4184" href="abstract-set-theory.Prelude.html#563" class="Function Operator">∈ˡ</a> <a id="4187" href="Leios.Protocol.html#1586" class="Function">EBs</a>
                         <a id="4216" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4218" href="Leios.Short.html#4131" class="Bound">x</a> <a id="4220" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="4223" href="Leios.Prelude.html#1475" class="Function">slices</a> <a id="4230" href="Leios.Abstract.html#961" class="Function">L</a> <a id="4232" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="4237" class="Number">2</a> <a id="4239" class="Symbol">(</a><a id="4240" class="Number">3</a> <a id="4242" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="4244" href="Leios.Abstract.html#1009" class="Function">η</a> <a id="4246" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="4248" href="Leios.Abstract.html#961" class="Function">L</a><a id="4249" class="Symbol">)</a>
                <a id="4267" href="Leios.Short.html#4267" class="Bound">slots</a> <a id="4273" class="Symbol">=</a> <a id="4275" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="4279" href="Leios.Blocks.html#640" class="Field">slotNumber</a>
          <a id="4300" class="Keyword">in</a>
          <a id="4313" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4315" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="4327" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
          <a id="4345" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4347" href="Leios.VRF.html#1849" class="Function">canProduceEB</a> <a id="4360" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="4365" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="4371" class="Symbol">(</a><a id="4372" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="4378" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="4379" class="Symbol">)</a> <a id="4381" href="Leios.Short.html#1734" class="Generalizable">π</a>
          <a id="4393" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4395" href="Data.List.Relation.Unary.All.html#1639" class="Datatype">All.All</a> <a id="4403" href="Leios.Short.html#4123" class="Bound">P</a> <a id="4405" href="Leios.Short.html#1969" class="Generalizable">ebs</a>
          <a id="4419" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4421" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="4428" class="Symbol">(</a><a id="4429" href="Leios.Short.html#4267" class="Bound">slots</a> <a id="4435" href="Leios.Short.html#1969" class="Generalizable">ebs</a><a id="4438" class="Symbol">)</a> <a id="4440" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4442" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="4451" class="Symbol">(</a><a id="4452" href="Leios.Short.html#4267" class="Bound">slots</a> <a id="4458" href="Leios.Short.html#1969" class="Generalizable">ebs</a><a id="4461" class="Symbol">)</a> <a id="4463" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="4466" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="4475" class="Symbol">(</a><a id="4476" href="Leios.Short.html#4267" class="Bound">slots</a> <a id="4482" class="Symbol">(</a><a id="4483" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="4490" href="Leios.Short.html#4123" class="Bound">P</a> <a id="4492" href="Leios.Protocol.html#1586" class="Function">EBs</a><a id="4495" class="Symbol">))</a>
          <a id="4508" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4510" href="Leios.Short.html#3904" class="Function">ffds</a> <a id="4515" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="4522" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="4527" class="Symbol">(</a><a id="4528" href="Leios.Blocks.html#4594" class="InductiveConstructor">ebHeader</a> <a id="4537" href="Leios.Short.html#4074" class="Bound">h</a><a id="4538" class="Symbol">)</a> <a id="4540" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="4548" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="4550" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="4558" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="4561" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
          <a id="4577" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="4661" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4663" href="Leios.Short.html#3193" class="Datatype Operator">↝</a> <a id="4665" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="4675" class="Keyword">record</a> <a id="4682" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4684" class="Symbol">{</a> <a id="4686" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="4695" class="Symbol">=</a> <a id="4697" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a> <a id="4703" class="Symbol">}</a> <a id="4705" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.VT-Role"></a><a id="4727" href="Leios.Short.html#4727" class="InductiveConstructor">VT-Role</a> <a id="4735" class="Symbol">:</a> <a id="4737" class="Keyword">let</a> <a id="4741" class="Keyword">open</a> <a id="4746" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="4757" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4759" class="Keyword">renaming</a> <a id="4768" class="Symbol">(</a><a id="4769" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="4778" class="Symbol">to</a> <a id="4781" class="Field">ffds</a><a id="4785" class="Symbol">)</a>
                <a id="4803" href="Leios.Short.html#4803" class="Bound">EBs&#39;</a> <a id="4808" class="Symbol">=</a> <a id="4810" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="4817" class="Symbol">(</a><a id="4818" href="Leios.Protocol.html#7383" class="Function">allIBRefsKnown</a> <a id="4833" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="4834" class="Symbol">)</a> <a id="4836" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4838" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="4845" class="Symbol">(</a><a id="4846" href="Leios.Blocks.html#770" class="Function Operator">_∈ᴮ</a> <a id="4850" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="4856" href="Leios.Abstract.html#961" class="Function">L</a> <a id="4858" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="4863" class="Number">1</a><a id="4864" class="Symbol">)</a> <a id="4866" href="Leios.Protocol.html#1586" class="Function">EBs</a>
                <a id="4886" href="Leios.Short.html#4886" class="Bound">votes</a> <a id="4892" class="Symbol">=</a> <a id="4894" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="4898" class="Symbol">(</a><a id="4899" href="Leios.Abstract.html#837" class="Function">vote</a> <a id="4904" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="4910" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4912" href="Class.Hashable.html#167" class="Field">hash</a><a id="4916" class="Symbol">)</a> <a id="4918" href="Leios.Short.html#4803" class="Bound">EBs&#39;</a>
          <a id="4933" class="Keyword">in</a>
          <a id="4946" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4948" href="Leios.Protocol.html#2535" class="Function">needsUpkeep-Stage</a> <a id="4966" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
          <a id="4984" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4986" href="Leios.VRF.html#2453" class="Function">canProduceV</a> <a id="4998" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="5003" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="5009" class="Symbol">(</a><a id="5010" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="5016" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="5017" class="Symbol">)</a>
          <a id="5029" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5031" href="Leios.Short.html#4781" class="Function">ffds</a> <a id="5036" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="5043" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="5048" class="Symbol">(</a><a id="5049" href="Leios.Blocks.html#4632" class="InductiveConstructor">vtHeader</a> <a id="5058" href="Leios.Short.html#4886" class="Bound">votes</a><a id="5063" class="Symbol">)</a> <a id="5065" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5073" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="5075" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="5083" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="5086" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
          <a id="5102" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="5186" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5188" href="Leios.Short.html#3193" class="Datatype Operator">↝</a> <a id="5190" href="Leios.Protocol.html#3062" class="Function">addUpkeep-Stage</a> <a id="5206" class="Keyword">record</a> <a id="5213" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5215" class="Symbol">{</a> <a id="5217" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="5226" class="Symbol">=</a> <a id="5228" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a> <a id="5234" class="Symbol">}</a> <a id="5236" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
</pre>#### Negative rules
<pre class="Agda">  <a id="_↝_.No-IB-Role"></a><a id="5278" href="Leios.Short.html#5278" class="InductiveConstructor">No-IB-Role</a> <a id="5289" class="Symbol">:</a> <a id="5291" class="Keyword">let</a> <a id="5295" class="Keyword">open</a> <a id="5300" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="5311" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5313" class="Keyword">in</a>
             <a id="5329" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5331" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="5343" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>
             <a id="5364" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5366" class="Symbol">(∀</a> <a id="5369" href="Leios.Short.html#5369" class="Bound">π</a> <a id="5371" class="Symbol">→</a> <a id="5373" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="5375" href="Leios.VRF.html#1245" class="Function">canProduceIB</a> <a id="5388" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="5393" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="5399" class="Symbol">(</a><a id="5400" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="5406" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="5407" class="Symbol">)</a> <a id="5409" href="Leios.Short.html#5369" class="Bound">π</a><a id="5410" class="Symbol">)</a>
             <a id="5425" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="5484" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5486" href="Leios.Short.html#3193" class="Datatype Operator">↝</a> <a id="5488" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="5498" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5500" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-EB-Role"></a><a id="5522" href="Leios.Short.html#5522" class="InductiveConstructor">No-EB-Role</a> <a id="5533" class="Symbol">:</a> <a id="5535" class="Keyword">let</a> <a id="5539" class="Keyword">open</a> <a id="5544" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="5555" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5557" class="Keyword">in</a>
             <a id="5573" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5575" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="5587" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
             <a id="5608" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5610" class="Symbol">(∀</a> <a id="5613" href="Leios.Short.html#5613" class="Bound">π</a> <a id="5615" class="Symbol">→</a> <a id="5617" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="5619" href="Leios.VRF.html#1849" class="Function">canProduceEB</a> <a id="5632" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="5637" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="5643" class="Symbol">(</a><a id="5644" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="5650" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="5651" class="Symbol">)</a> <a id="5653" href="Leios.Short.html#5613" class="Bound">π</a><a id="5654" class="Symbol">)</a>
             <a id="5669" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="5728" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5730" href="Leios.Short.html#3193" class="Datatype Operator">↝</a> <a id="5732" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="5742" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5744" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-VT-Role"></a><a id="5766" href="Leios.Short.html#5766" class="InductiveConstructor">No-VT-Role</a> <a id="5777" class="Symbol">:</a> <a id="5779" class="Keyword">let</a> <a id="5783" class="Keyword">open</a> <a id="5788" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="5799" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5801" class="Keyword">in</a>
             <a id="5817" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5819" href="Leios.Protocol.html#2535" class="Function">needsUpkeep-Stage</a> <a id="5837" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
             <a id="5858" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5860" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="5862" href="Leios.VRF.html#2453" class="Function">canProduceV</a> <a id="5874" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="5879" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="5885" class="Symbol">(</a><a id="5886" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="5892" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="5893" class="Symbol">)</a>
             <a id="5908" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="5967" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5969" href="Leios.Short.html#3193" class="Datatype Operator">↝</a> <a id="5971" href="Leios.Protocol.html#3062" class="Function">addUpkeep-Stage</a> <a id="5987" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5989" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
</pre>### Uniform short-pipeline
<pre class="Agda"><a id="stage"></a><a id="6036" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6042" class="Symbol">:</a> <a id="6044" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="6046" class="Symbol">→</a> <a id="6048" class="Symbol">⦃</a> <a id="6050" href="Leios.Short.html#6050" class="Bound">_</a> <a id="6052" class="Symbol">:</a> <a id="6054" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="6062" href="Leios.Abstract.html#961" class="Function">L</a> <a id="6064" class="Symbol">⦄</a> <a id="6066" class="Symbol">→</a> <a id="6068" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="6070" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6076" href="Leios.Short.html#6076" class="Bound">s</a> <a id="6078" class="Symbol">=</a> <a id="6080" href="Leios.Short.html#6076" class="Bound">s</a> <a id="6082" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="6084" href="Leios.Abstract.html#961" class="Function">L</a>

<a id="beginningOfStage"></a><a id="6087" href="Leios.Short.html#6087" class="Function">beginningOfStage</a> <a id="6104" class="Symbol">:</a> <a id="6106" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="6108" class="Symbol">→</a> <a id="6110" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="6115" href="Leios.Short.html#6087" class="Function">beginningOfStage</a> <a id="6132" href="Leios.Short.html#6132" class="Bound">s</a> <a id="6134" class="Symbol">=</a> <a id="6136" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6142" href="Leios.Short.html#6132" class="Bound">s</a> <a id="6144" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="6146" href="Leios.Abstract.html#961" class="Function">L</a> <a id="6148" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6150" href="Leios.Short.html#6132" class="Bound">s</a>

<a id="endOfStage"></a><a id="6153" href="Leios.Short.html#6153" class="Function">endOfStage</a> <a id="6164" class="Symbol">:</a> <a id="6166" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="6168" class="Symbol">→</a> <a id="6170" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="6175" href="Leios.Short.html#6153" class="Function">endOfStage</a> <a id="6186" href="Leios.Short.html#6186" class="Bound">s</a> <a id="6188" class="Symbol">=</a> <a id="6190" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6194" class="Symbol">(</a><a id="6195" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6201" href="Leios.Short.html#6186" class="Bound">s</a><a id="6202" class="Symbol">)</a> <a id="6204" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6206" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6212" class="Symbol">(</a><a id="6213" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6217" href="Leios.Short.html#6186" class="Bound">s</a><a id="6218" class="Symbol">)</a>
</pre>Predicate needed for slot transition. Special care needs to be taken when starting from
genesis.
<pre class="Agda"><a id="allDone"></a><a id="6329" href="Leios.Short.html#6329" class="Function">allDone</a> <a id="6337" class="Symbol">:</a> <a id="6339" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="6350" class="Symbol">→</a> <a id="6352" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="6357" href="Leios.Short.html#6329" class="Function">allDone</a> <a id="6365" class="Keyword">record</a> <a id="6372" class="Symbol">{</a> <a id="6374" href="Leios.Protocol.html#1668" class="Field">slot</a> <a id="6379" class="Symbol">=</a> <a id="6381" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6383" class="Symbol">;</a> <a id="6385" href="Leios.Protocol.html#1765" class="Field">Upkeep</a> <a id="6392" class="Symbol">=</a> <a id="6394" href="Leios.Short.html#6394" class="Bound">u</a> <a id="6396" class="Symbol">;</a> <a id="6398" href="Leios.Protocol.html#1801" class="Field">Upkeep-Stage</a> <a id="6411" class="Symbol">=</a> <a id="6413" href="Leios.Short.html#6413" class="Bound">v</a> <a id="6415" class="Symbol">}</a> <a id="6417" class="Symbol">=</a>
  <a id="6421" class="Comment">-- bootstrapping</a>
    <a id="6442" class="Symbol">(</a><a id="6443" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6449" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6451" href="Class.HasOrder.Core.html#555" class="Field Operator">&lt;</a> <a id="6453" class="Number">3</a> <a id="6455" href="Data.Product.Base.html#1618" class="Function Operator">×</a>                        <a id="6480" href="Leios.Short.html#6394" class="Bound">u</a> <a id="6482" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6485" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6494" class="Symbol">(</a><a id="6495" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>           <a id="6513" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6515" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6520" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6522" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6524" class="Symbol">))</a>
  <a id="6529" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6531" class="Symbol">(</a><a id="6532" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6538" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6540" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6542" class="Number">3</a> <a id="6544" href="Data.Product.Base.html#1618" class="Function Operator">×</a>   <a id="6548" href="Leios.Short.html#6087" class="Function">beginningOfStage</a> <a id="6565" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6567" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6569" href="Leios.Short.html#6394" class="Bound">u</a> <a id="6571" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6574" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6583" class="Symbol">(</a><a id="6584" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a> <a id="6592" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6594" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a> <a id="6602" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6604" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6609" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6611" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6613" class="Symbol">))</a>
  <a id="6618" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6620" class="Symbol">(</a><a id="6621" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6627" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6629" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6631" class="Number">3</a> <a id="6633" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6635" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="6637" href="Leios.Short.html#6087" class="Function">beginningOfStage</a> <a id="6654" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6656" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6658" href="Leios.Short.html#6394" class="Bound">u</a> <a id="6660" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6663" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6672" class="Symbol">(</a><a id="6673" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>           <a id="6691" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6693" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6698" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6700" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6702" class="Symbol">))</a>
  <a id="6707" class="Comment">-- done</a>
  <a id="6717" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6719" class="Symbol">(</a><a id="6720" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6726" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6728" href="Class.HasOrder.Core.html#748" class="Function Operator">&gt;</a> <a id="6730" class="Number">3</a> <a id="6732" href="Data.Product.Base.html#1618" class="Function Operator">×</a>   <a id="6736" href="Leios.Short.html#6087" class="Function">beginningOfStage</a> <a id="6753" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6755" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6757" href="Leios.Short.html#6394" class="Bound">u</a> <a id="6759" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6762" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6771" class="Symbol">(</a><a id="6772" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a> <a id="6780" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6782" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a> <a id="6790" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6792" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6797" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6799" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6801" class="Symbol">))</a>
  <a id="6806" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6808" class="Symbol">(</a><a id="6809" href="Leios.Short.html#6036" class="Function">stage</a> <a id="6815" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6817" href="Class.HasOrder.Core.html#748" class="Function Operator">&gt;</a> <a id="6819" class="Number">3</a> <a id="6821" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6823" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="6825" href="Leios.Short.html#6087" class="Function">beginningOfStage</a> <a id="6842" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6844" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6846" href="Leios.Short.html#6394" class="Bound">u</a> <a id="6848" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6851" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6860" class="Symbol">(</a><a id="6861" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>           <a id="6879" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6881" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6886" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6888" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6890" class="Symbol">)</a> <a id="6892" href="Data.Product.Base.html#1618" class="Function Operator">×</a>
       <a id="6901" class="Symbol">(((</a>  <a id="6906" href="Leios.Short.html#6153" class="Function">endOfStage</a> <a id="6917" href="Leios.Short.html#6381" class="Bound">s</a> <a id="6919" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6921" href="Leios.Short.html#6413" class="Bound">v</a> <a id="6923" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6926" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6935" class="Symbol">(</a><a id="6936" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a> <a id="6944" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6946" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6948" class="Symbol">))</a>
       <a id="6958" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6960" class="Symbol">(</a><a id="6961" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="6963" href="Leios.Short.html#6153" class="Function">endOfStage</a> <a id="6974" href="Leios.Short.html#6381" class="Bound">s</a><a id="6975" class="Symbol">))))</a>
</pre>### (Full-)Short Leios transitions
The relation describing the transition given input and state
<pre class="Agda"><a id="7088" class="Keyword">data</a> <a id="_-⟦_/_⟧⇀_"></a><a id="7093" href="Leios.Short.html#7093" class="Datatype Operator">_-⟦_/_⟧⇀_</a> <a id="7103" class="Symbol">:</a> <a id="7105" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="7111" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="7122" class="Symbol">→</a> <a id="7124" href="Leios.Protocol.html#1108" class="Datatype">LeiosInput</a> <a id="7135" class="Symbol">→</a> <a id="7137" href="Leios.Protocol.html#1266" class="Datatype">LeiosOutput</a> <a id="7149" class="Symbol">→</a> <a id="7151" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="7162" class="Symbol">→</a> <a id="7164" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="7169" class="Keyword">where</a>
</pre>#### Initialization
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Init"></a><a id="7209" href="Leios.Short.html#7209" class="InductiveConstructor">Init</a> <a id="7214" class="Symbol">:</a>
       <a id="7223" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="7225" href="Leios.Short.html#1800" class="Generalizable">ks</a> <a id="7228" href="Leios.KeyRegistration.html#476" class="Function Operator">K.-⟦</a> <a id="7233" href="Leios.KeyRegistration.html#302" class="InductiveConstructor">K.INIT</a> <a id="7240" href="Leios.SpecStructure.html#766" class="Field">pk-IB</a> <a id="7246" href="Leios.SpecStructure.html#772" class="Field">pk-EB</a> <a id="7252" href="Leios.SpecStructure.html#778" class="Field">pk-VT</a> <a id="7258" href="Leios.KeyRegistration.html#476" class="Function Operator">/</a> <a id="7260" href="Leios.KeyRegistration.html#374" class="InductiveConstructor">K.PUBKEYS</a> <a id="7270" href="Leios.Short.html#2159" class="Generalizable">pks</a> <a id="7274" href="Leios.KeyRegistration.html#476" class="Function Operator">⟧⇀</a> <a id="7277" href="Leios.Short.html#1803" class="Generalizable">ks&#39;</a>
       <a id="7288" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7290" href="Leios.SpecStructure.html#904" class="Field">initBaseState</a> <a id="7304" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="7309" href="Leios.Base.html#1390" class="InductiveConstructor">B.INIT</a> <a id="7316" class="Symbol">(</a><a id="7317" href="Leios.Base.html#677" class="Function">V-chkCerts</a> <a id="7328" href="Leios.Short.html#2159" class="Generalizable">pks</a><a id="7331" class="Symbol">)</a> <a id="7333" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="7335" href="Leios.Base.html#2591" class="InductiveConstructor">B.STAKE</a> <a id="7343" href="Leios.Short.html#2122" class="Generalizable">SD</a> <a id="7346" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="7349" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
       <a id="7360" href="Prelude.InferenceRules.html#11981" class="Function Operator">────────────────────────────────────────────────────────────────</a>
       <a id="7432" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="7440" href="Leios.Short.html#7093" class="Datatype Operator">-⟦</a> <a id="7443" href="Leios.Protocol.html#1134" class="InductiveConstructor">INIT</a> <a id="7448" href="Leios.Short.html#2092" class="Generalizable">V</a> <a id="7450" href="Leios.Short.html#7093" class="Datatype Operator">/</a> <a id="7452" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="7458" href="Leios.Short.html#7093" class="Datatype Operator">⟧⇀</a> <a id="7461" href="Leios.Protocol.html#3215" class="Function">initLeiosState</a> <a id="7476" href="Leios.Short.html#2092" class="Generalizable">V</a> <a id="7478" href="Leios.Short.html#2122" class="Generalizable">SD</a> <a id="7481" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a> <a id="7485" href="Leios.Short.html#2159" class="Generalizable">pks</a>
</pre>#### Network and Ledger
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Slot"></a><a id="7527" href="Leios.Short.html#7527" class="InductiveConstructor">Slot</a> <a id="7532" class="Symbol">:</a> <a id="7534" class="Keyword">let</a> <a id="7538" class="Keyword">open</a> <a id="7543" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="7554" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="7556" class="Keyword">renaming</a> <a id="7565" class="Symbol">(</a><a id="7566" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="7575" class="Symbol">to</a> <a id="7578" class="Field">ffds</a><a id="7582" class="Symbol">;</a> <a id="7584" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="7594" class="Symbol">to</a> <a id="7597" class="Field">bs</a><a id="7599" class="Symbol">)</a> <a id="7601" class="Keyword">in</a>
       <a id="7611" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="7613" href="Leios.Short.html#6329" class="Function">allDone</a> <a id="7621" href="Leios.Short.html#1661" class="Generalizable">s</a>
       <a id="7630" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7632" href="Leios.Short.html#7597" class="Function">bs</a> <a id="7635" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="7640" href="Leios.Base.html#1991" class="InductiveConstructor">B.FTCH-LDG</a> <a id="7651" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="7653" href="Leios.Base.html#3167" class="InductiveConstructor">B.BASE-LDG</a> <a id="7664" href="Leios.Short.html#2014" class="Generalizable">rbs</a> <a id="7668" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="7671" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
       <a id="7682" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7684" href="Leios.Short.html#7578" class="Function">ffds</a> <a id="7689" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="7696" href="Leios.FFD.html#351" class="InductiveConstructor">Fetch</a> <a id="7702" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="7704" href="Leios.FFD.html#419" class="InductiveConstructor">FetchRes</a> <a id="7713" href="Leios.Short.html#1834" class="Generalizable">msgs</a> <a id="7718" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="7721" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
       <a id="7734" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
       <a id="7813" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7818" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="7820" href="Leios.Short.html#7093" class="Datatype Operator">-⟦</a> <a id="7823" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="7828" href="Leios.Short.html#7093" class="Datatype Operator">/</a> <a id="7830" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="7836" href="Leios.Short.html#7093" class="Datatype Operator">⟧⇀</a> <a id="7839" class="Keyword">record</a> <a id="7846" href="Leios.Short.html#1661" class="Generalizable">s</a>
           <a id="7859" class="Symbol">{</a> <a id="7861" href="Leios.Protocol.html#1452" class="Field">FFDState</a>     <a id="7874" class="Symbol">=</a> <a id="7876" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
           <a id="7893" class="Symbol">;</a> <a id="7895" href="Leios.Protocol.html#1838" class="Field">BaseState</a>    <a id="7908" class="Symbol">=</a> <a id="7910" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
           <a id="7925" class="Symbol">;</a> <a id="7927" href="Leios.Protocol.html#1485" class="Field">Ledger</a>       <a id="7940" class="Symbol">=</a> <a id="7942" href="Leios.Protocol.html#2348" class="Function">constructLedger</a> <a id="7958" href="Leios.Short.html#2014" class="Generalizable">rbs</a>
           <a id="7973" class="Symbol">;</a> <a id="7975" href="Leios.Protocol.html#1668" class="Field">slot</a>         <a id="7988" class="Symbol">=</a> <a id="7990" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="7994" href="Leios.Protocol.html#1668" class="Function">slot</a>
           <a id="8010" class="Symbol">;</a> <a id="8012" href="Leios.Protocol.html#1765" class="Field">Upkeep</a>       <a id="8025" class="Symbol">=</a> <a id="8027" href="Class.HasEmptySet.html#287" class="Field">∅</a>
           <a id="8040" class="Symbol">;</a> <a id="8042" href="Leios.Protocol.html#1801" class="Field">Upkeep-Stage</a> <a id="8055" class="Symbol">=</a> <a id="8057" href="Class.Decidable.Core.html#593" class="Function Operator">ifᵈ</a> <a id="8061" class="Symbol">(</a><a id="8062" href="Leios.Short.html#6153" class="Function">endOfStage</a> <a id="8073" href="Leios.Protocol.html#1668" class="Function">slot</a><a id="8077" class="Symbol">)</a> <a id="8079" href="Class.Decidable.Core.html#593" class="Function Operator">then</a> <a id="8084" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="8086" href="Class.Decidable.Core.html#593" class="Function Operator">else</a> <a id="8091" href="Leios.Protocol.html#1801" class="Function">Upkeep-Stage</a>
           <a id="8115" class="Symbol">}</a> <a id="8117" href="Leios.Protocol.html#8878" class="Function Operator">↑</a> <a id="8119" href="Data.List.Base.html#10687" class="Function">L.filter</a> <a id="8128" class="Symbol">(</a><a id="8129" href="Leios.Protocol.html#7126" class="Function">isValid?</a> <a id="8138" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="8139" class="Symbol">)</a> <a id="8141" href="Leios.Short.html#1834" class="Generalizable">msgs</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Ftch"></a><a id="8160" href="Leios.Short.html#8160" class="InductiveConstructor">Ftch</a> <a id="8165" class="Symbol">:</a>
       <a id="8174" href="Prelude.InferenceRules.html#42426" class="Function Operator">────────────────────────────────────────────────────────</a>
       <a id="8238" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8243" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8245" href="Leios.Short.html#7093" class="Datatype Operator">-⟦</a> <a id="8248" href="Leios.Protocol.html#1238" class="InductiveConstructor">FTCH-LDG</a> <a id="8257" href="Leios.Short.html#7093" class="Datatype Operator">/</a> <a id="8259" href="Leios.Protocol.html#1293" class="InductiveConstructor">FTCH-LDG</a> <a id="8268" class="Symbol">(</a><a id="8269" href="Leios.Protocol.html#1485" class="Field">LeiosState.Ledger</a> <a id="8287" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="8288" class="Symbol">)</a> <a id="8290" href="Leios.Short.html#7093" class="Datatype Operator">⟧⇀</a> <a id="8293" href="Leios.Short.html#1661" class="Generalizable">s</a>
</pre>#### Base chain

Note: Submitted data to the base chain is only taken into account
      if the party submitting is the block producer on the base chain
      for the given slot
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₁"></a><a id="8487" href="Leios.Short.html#8487" class="InductiveConstructor">Base₁</a>   <a id="8495" class="Symbol">:</a>
          <a id="8507" href="Prelude.InferenceRules.html#41139" class="Function Operator">───────────────────────────────────────────────────────────────────</a>
          <a id="8585" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8590" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8592" href="Leios.Short.html#7093" class="Datatype Operator">-⟦</a> <a id="8595" href="Leios.Protocol.html#1164" class="InductiveConstructor">SUBMIT</a> <a id="8602" class="Symbol">(</a><a id="8603" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8608" href="Leios.Short.html#2058" class="Generalizable">txs</a><a id="8611" class="Symbol">)</a> <a id="8613" href="Leios.Short.html#7093" class="Datatype Operator">/</a> <a id="8615" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="8621" href="Leios.Short.html#7093" class="Datatype Operator">⟧⇀</a> <a id="8624" class="Keyword">record</a> <a id="8631" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8633" class="Symbol">{</a> <a id="8635" href="Leios.Protocol.html#1516" class="Field">ToPropose</a> <a id="8645" class="Symbol">=</a> <a id="8647" href="Leios.Short.html#2058" class="Generalizable">txs</a> <a id="8651" class="Symbol">}</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₂a"></a><a id="8667" href="Leios.Short.html#8667" class="InductiveConstructor">Base₂a</a>  <a id="8675" class="Symbol">:</a> <a id="8677" class="Keyword">let</a> <a id="8681" class="Keyword">open</a> <a id="8686" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="8697" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8699" class="Keyword">renaming</a> <a id="8708" class="Symbol">(</a><a id="8709" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="8719" class="Symbol">to</a> <a id="8722" class="Field">bs</a><a id="8724" class="Symbol">)</a> <a id="8726" class="Keyword">in</a>
          <a id="8739" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="8741" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="8753" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>
          <a id="8768" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="8770" href="Leios.Short.html#1929" class="Generalizable">eb</a> <a id="8773" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="8775" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="8782" class="Symbol">(λ</a> <a id="8785" href="Leios.Short.html#8785" class="Bound">x</a> <a id="8787" class="Symbol">→</a> <a id="8789" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="8805" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8807" href="Leios.Short.html#8785" class="Bound">x</a> <a id="8809" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8811" href="Leios.Short.html#8785" class="Bound">x</a> <a id="8813" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="8816" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="8822" href="Leios.Abstract.html#961" class="Function">L</a> <a id="8824" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="8829" class="Number">2</a><a id="8830" class="Symbol">)</a> <a id="8832" href="Leios.Protocol.html#1586" class="Function">EBs</a>
          <a id="8846" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="8848" href="Leios.Short.html#8722" class="Function">bs</a> <a id="8851" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="8856" href="Leios.Base.html#1769" class="InductiveConstructor">B.SUBMIT</a> <a id="8865" class="Symbol">(</a><a id="8866" href="Data.These.Base.html#595" class="InductiveConstructor">this</a> <a id="8871" href="Leios.Short.html#1929" class="Generalizable">eb</a><a id="8873" class="Symbol">)</a> <a id="8875" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="8877" href="Leios.Base.html#2840" class="InductiveConstructor">B.EMPTY</a> <a id="8885" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="8888" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
          <a id="8902" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="8984" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8989" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8991" href="Leios.Short.html#7093" class="Datatype Operator">-⟦</a> <a id="8994" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="8999" href="Leios.Short.html#7093" class="Datatype Operator">/</a> <a id="9001" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="9007" href="Leios.Short.html#7093" class="Datatype Operator">⟧⇀</a> <a id="9010" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="9020" class="Keyword">record</a> <a id="9027" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9029" class="Symbol">{</a> <a id="9031" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="9041" class="Symbol">=</a> <a id="9043" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a> <a id="9047" class="Symbol">}</a> <a id="9049" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>

  <a id="_-⟦_/_⟧⇀_.Base₂b"></a><a id="9057" href="Leios.Short.html#9057" class="InductiveConstructor">Base₂b</a>  <a id="9065" class="Symbol">:</a> <a id="9067" class="Keyword">let</a> <a id="9071" class="Keyword">open</a> <a id="9076" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="9087" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9089" class="Keyword">renaming</a> <a id="9098" class="Symbol">(</a><a id="9099" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="9109" class="Symbol">to</a> <a id="9112" class="Field">bs</a><a id="9114" class="Symbol">)</a> <a id="9116" class="Keyword">in</a>
          <a id="9129" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="9131" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="9143" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>
          <a id="9158" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="9160" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="9163" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="9165" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="9172" class="Symbol">(λ</a> <a id="9175" href="Leios.Short.html#9175" class="Bound">x</a> <a id="9177" class="Symbol">→</a> <a id="9179" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="9195" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9197" href="Leios.Short.html#9175" class="Bound">x</a> <a id="9199" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="9201" href="Leios.Short.html#9175" class="Bound">x</a> <a id="9203" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="9206" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="9212" href="Leios.Abstract.html#961" class="Function">L</a> <a id="9214" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="9219" class="Number">2</a><a id="9220" class="Symbol">)</a> <a id="9222" href="Leios.Protocol.html#1586" class="Function">EBs</a>
          <a id="9236" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="9238" href="Leios.Short.html#9112" class="Function">bs</a> <a id="9241" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="9246" href="Leios.Base.html#1769" class="InductiveConstructor">B.SUBMIT</a> <a id="9255" class="Symbol">(</a><a id="9256" href="Data.These.Base.html#623" class="InductiveConstructor">that</a> <a id="9261" href="Leios.Protocol.html#1516" class="Function">ToPropose</a><a id="9270" class="Symbol">)</a> <a id="9272" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="9274" href="Leios.Base.html#2840" class="InductiveConstructor">B.EMPTY</a> <a id="9282" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="9285" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
          <a id="9299" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="9381" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9386" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9388" href="Leios.Short.html#7093" class="Datatype Operator">-⟦</a> <a id="9391" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="9396" href="Leios.Short.html#7093" class="Datatype Operator">/</a> <a id="9398" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="9404" href="Leios.Short.html#7093" class="Datatype Operator">⟧⇀</a> <a id="9407" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="9417" class="Keyword">record</a> <a id="9424" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9426" class="Symbol">{</a> <a id="9428" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="9438" class="Symbol">=</a> <a id="9440" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a> <a id="9444" class="Symbol">}</a> <a id="9446" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>
</pre>#### Protocol rules
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Roles"></a><a id="9485" href="Leios.Short.html#9485" class="InductiveConstructor">Roles</a> <a id="9491" class="Symbol">:</a>
        <a id="9501" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="9503" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9505" href="Leios.Short.html#3193" class="Datatype Operator">↝</a> <a id="9507" href="Leios.Short.html#1663" class="Generalizable">s&#39;</a>
        <a id="9518" href="Prelude.InferenceRules.html#13801" class="Function Operator">─────────────────────────────</a>
        <a id="9556" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9561" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9563" href="Leios.Short.html#7093" class="Datatype Operator">-⟦</a> <a id="9566" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="9571" href="Leios.Short.html#7093" class="Datatype Operator">/</a> <a id="9573" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="9579" href="Leios.Short.html#7093" class="Datatype Operator">⟧⇀</a> <a id="9582" href="Leios.Short.html#1663" class="Generalizable">s&#39;</a>
</pre>
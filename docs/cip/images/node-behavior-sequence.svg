<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="1020">
  <defs>
    <!-- Pattern for background -->
    <pattern id="bgPattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
      <rect width="40" height="40" fill="#f8f8f8"/>
      <line x1="0" y1="40" x2="40" y2="0" stroke="#f0f0f0" stroke-width="0.5"/>
    </pattern>
    
    <!-- Arrow markers -->
    <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#595959"/>
    </marker>
    
    <!-- Transaction arrow marker -->
    <marker id="txarrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#2196f3"/>
    </marker>
    
    <!-- RB arrow marker -->
    <marker id="rbarrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#ff9800"/>
    </marker>
    
    <!-- EB arrow marker -->
    <marker id="ebarrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#274e13"/>
    </marker>
    
    <!-- Vote arrow marker -->
    <marker id="votearrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#f9a825"/>
    </marker>
    
    <!-- Hover effects -->
    <style>
      .step-link, .section-link, .param-link {
        cursor: pointer;
      }
      .step-link:hover rect {
        stroke-width: 3;
        filter: brightness(1.1);
      }
      .step-link:hover text {
        font-weight: bold;
      }
      .step-link:hover line {
        stroke-width: 3;
        filter: brightness(1.1);
      }
      .section-link:hover rect {
        filter: brightness(1.1);
      }
      .section-link:hover text {
        font-weight: bold;
      }
      .param-link:hover rect {
        fill-opacity: 0.25 !important;
      }
      .param-link:hover line {
        stroke-width: 2;
        filter: brightness(1.1);
      }
      .param-link:hover text {
        font-weight: bold;
      }
    </style>
  </defs>
  
  <!-- Background -->
  <rect width="1400" height="1020" fill="#ffffff"/>
  
  <!-- Timeline background -->
  <rect x="50" y="50" width="1300" height="920" fill="url(#bgPattern)" stroke="#ddd" stroke-width="0.5"/>
  
  <!-- Actor columns -->
  <g id="actors">
    <!-- Upstream node -->
    <rect x="125" y="80" width="200" height="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2" rx="8"/>
    <text x="225" y="105" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#1976d2">Upstream</text>
    <text x="225" y="125" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#1976d2">previous block (RB) producer</text>
    
    <!-- Block Producer (current node) -->
    <rect x="575" y="80" width="200" height="60" fill="#fff3e0" stroke="#f57c00" stroke-width="2" rx="8"/>
    <text x="675" y="105" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#f57c00">Block Producer</text>
    <text x="675" y="125" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#f57c00">current node</text>
    
    <!-- Downstream node -->
    <rect x="1025" y="80" width="200" height="60" fill="#e8f5e8" stroke="#388e3c" stroke-width="2" rx="8"/>
    <text x="1125" y="105" font-family="Arial, sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="#388e3c">Downstream</text>
    <text x="1125" y="125" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#388e3c">subsequent node(s)</text>
    
    <!-- Lifelines -->
    <line x1="225" y1="140" x2="225" y2="970" stroke="#1976d2" stroke-width="2" stroke-dasharray="5,5"/>
    <line x1="675" y1="140" x2="675" y2="970" stroke="#f57c00" stroke-width="2" stroke-dasharray="5,5"/>
    <line x1="1125" y1="140" x2="1125" y2="970" stroke="#388e3c" stroke-width="2" stroke-dasharray="5,5"/>
  </g>
  
  <!-- L_recover window (unified component) -->
  <g id="l-recover-window">
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#l-recover" class="param-link">
      <!-- L_recover window background area -->
      <rect x="50" y="885" width="1300" height="85" fill="#7cb342" fill-opacity="0.1" stroke="none"/>
      
      <!-- L_recover window dashed borders -->
      <line x1="50" y1="885" x2="1350" y2="885" stroke="#7cb342" stroke-width="1.5" stroke-dasharray="3,3"/>
      <line x1="50" y1="970" x2="1350" y2="970" stroke="#7cb342" stroke-width="1.5" stroke-dasharray="3,3"/>
      
      <!-- L_recover window vertical bar -->
      <line x1="55" y1="885" x2="55" y2="960" stroke="#7cb342" stroke-width="4" opacity="0.8"/>
      
      <!-- Arrow at end of window -->
      <polygon points="50,960 55,970 60,960" fill="#7cb342" opacity="0.8"/>
      
      <!-- Label for L_recover -->
      <text x="70" y="925" font-family="Times New Roman, serif" font-size="16" font-style="italic" text-anchor="start" fill="#5a8030">L<tspan font-family="Arial, sans-serif" font-size="12" font-style="normal" baseline-shift="sub">recover</tspan></text>
    </a>
  </g>
  
  <!-- Section headers with links -->
  <g id="section-headers">
    <!-- Transaction Propagation Section - spans all three actors -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#transaction-diffusion" class="section-link">
      <rect x="200" y="170" width="950" height="30" fill="url(#bgPattern)" stroke="#2196f3" stroke-width="1" rx="4"/>
      <rect x="200" y="170" width="950" height="30" fill="#e3f2fd" fill-opacity="0.7" stroke="#2196f3" stroke-width="1" rx="4"/>
      <text x="675" y="190" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2196f3">Transaction Propagation</text>
    </a>
    
    <!-- Block Production Section - spans all three actors -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#rb-block-production-and-diffusion" class="section-link">
      <rect x="200" y="300" width="950" height="30" fill="url(#bgPattern)" stroke="#ff9800" stroke-width="1" rx="4"/>
      <rect x="200" y="300" width="950" height="30" fill="#fff3e0" fill-opacity="0.7" stroke="#ff9800" stroke-width="1" rx="4"/>
      <text x="675" y="320" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#ff9800">Block Production</text>
    </a>
    
    <!-- EB Diffusion Section - spans all three actors -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#eb-diffusion" class="section-link">
      <rect x="200" y="490" width="950" height="30" fill="url(#bgPattern)" stroke="#274e13" stroke-width="1" rx="4"/>
      <rect x="200" y="490" width="950" height="30" fill="#e8f5e8" fill-opacity="0.7" stroke="#274e13" stroke-width="1" rx="4"/>
      <text x="675" y="510" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#274e13">EB Diffusion</text>
    </a>
    
    <!-- Voting & Certification Section - spans all three actors -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#voting--certification" class="section-link">
      <rect x="200" y="640" width="950" height="30" fill="url(#bgPattern)" stroke="#f9a825" stroke-width="1" rx="4"/>
      <rect x="200" y="640" width="950" height="30" fill="#fff8e1" fill-opacity="0.7" stroke="#f9a825" stroke-width="1" rx="4"/>
      <text x="675" y="660" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#f9a825">Voting &amp; Certification</text>
    </a>
  </g>
  
  <!-- Transaction propagation steps -->
  <g id="transaction-steps">
    <!-- Step: Diffuse Transaction (D->BP) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#transaction-propagation" class="step-link">
      <line x1="1125" y1="220" x2="675" y2="220" stroke="#2196f3" stroke-width="2" marker-end="url(#txarrowhead)"/>
      <text x="900" y="215" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#2196f3">Diffuse Transaction</text>
    </a>
    
    <!-- Step: Add to Mempool (BP) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#mempool-design" class="step-link">
      <rect x="615" y="230" width="120" height="20" fill="#e3f2fd" stroke="#2196f3" stroke-width="1" rx="4"/>
      <text x="675" y="245" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#2196f3">Add to Mempool</text>
    </a>
    
    <!-- Step: Diffuse Transaction (BP->U) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#transaction-propagation" class="step-link">
      <line x1="675" y1="260" x2="225" y2="260" stroke="#2196f3" stroke-width="2" marker-end="url(#txarrowhead)"/>
      <text x="450" y="255" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#2196f3">Diffuse Transaction</text>
    </a>
    
    <!-- Step: Add to Mempool (U) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#mempool-design" class="step-link">
      <rect x="165" y="270" width="120" height="20" fill="#e3f2fd" stroke="#2196f3" stroke-width="1" rx="4"/>
      <text x="225" y="285" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#2196f3">Add to Mempool</text>
    </a>
  </g>
  
  <!-- Block production steps -->
  <g id="block-steps">
    <!-- Step 1: Create RB & announce EB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#rb-block-production-and-diffusion" class="step-link">
      <rect x="150" y="340" width="150" height="35" fill="#fff3e0" stroke="#ff9800" stroke-width="1" rx="4"/>
      <text x="225" y="355" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#ff9800">1. Create RB</text>
      <text x="225" y="370" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#ff9800">&amp; announce EB</text>
    </a>
    
    <!-- Step 2a: Sync chain + relay headers (U->BP) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#rb-header-diffusion" class="step-link">
      <line x1="225" y1="390" x2="675" y2="390" stroke="#ff9800" stroke-width="2" marker-end="url(#rbarrowhead)"/>
      <text x="450" y="385" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#ff9800">2a. Sync chain + relay headers</text>
    </a>
    
    <!-- Step 2b: Sync chain + relay headers (BP->D) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#rb-header-diffusion" class="step-link">
      <line x1="675" y1="410" x2="1125" y2="410" stroke="#ff9800" stroke-width="2" marker-end="url(#rbarrowhead)"/>
      <text x="900" y="405" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#ff9800">2b. Sync chain + relay headers</text>
    </a>
    
    <!-- Step 3: Fetch RB Body -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#rb-body-diffusion" class="step-link">
      <line x1="225" y1="430" x2="675" y2="430" stroke="#ff9800" stroke-width="2" marker-end="url(#rbarrowhead)"/>
      <text x="450" y="425" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#ff9800">3. Fetch RB Body</text>
    </a>
    
    <!-- Step 4: Validate and adopt RB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#rb-validation-adoption" class="step-link">
      <rect x="580" y="445" width="190" height="20" fill="#fff3e0" stroke="#ff9800" stroke-width="1" rx="4"/>
      <text x="675" y="460" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#ff9800">4. Validate and adopt RB</text>
    </a>
    
    <!-- Step 5: Serve RB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#rb-validation-adoption" class="step-link">
      <line x1="675" y1="480" x2="1125" y2="480" stroke="#ff9800" stroke-width="2" marker-end="url(#rbarrowhead)"/>
      <text x="900" y="475" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#ff9800">5. Serve RB</text>
    </a>
  </g>
  
  <!-- EB diffusion steps -->
  <g id="eb-steps">
    <!-- Step 6: Fetch EB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#eb-diffusion" class="step-link">
      <line x1="225" y1="540" x2="675" y2="540" stroke="#274e13" stroke-width="2" marker-end="url(#ebarrowhead)"/>
      <text x="450" y="535" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#274e13">6. Fetch EB</text>
    </a>
    
    <!-- Step 6a: Fetch missing transactions -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#transaction-retrieval" class="step-link">
      <line x1="225" y1="560" x2="675" y2="560" stroke="#274e13" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#ebarrowhead)"/>
      <text x="450" y="555" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#274e13">6a. Fetch missing transactions</text>
    </a>
    
    <!-- Step 6b: Validate EB body (fast) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#eb-diffusion" class="step-link">
      <rect x="580" y="575" width="190" height="20" fill="#e8f5e8" stroke="#274e13" stroke-width="1" rx="4"/>
      <text x="675" y="590" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#274e13">6b. Validate EB body (fast)</text>
    </a>
    
    <!-- Step 7: Serve EB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#eb-diffusion" class="step-link">
      <line x1="675" y1="610" x2="1125" y2="610" stroke="#274e13" stroke-width="2" marker-end="url(#ebarrowhead)"/>
      <text x="900" y="605" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#274e13">7. Serve EB</text>
    </a>
    
    <!-- Step 7a: Fetch missing transactions -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#transaction-retrieval" class="step-link">
      <line x1="675" y1="630" x2="1125" y2="630" stroke="#274e13" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#ebarrowhead)"/>
      <text x="900" y="625" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#274e13">7a. Fetch missing transactions</text>
    </a>
    
    <!-- Step 8: Validate endorsed transactions (slow) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#eb-transaction-validation" class="step-link">
      <rect x="580" y="685" width="190" height="30" fill="#e8f5e8" stroke="#274e13" stroke-width="1" rx="4"/>
      <text x="675" y="698" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#274e13">8. Validate endorsed</text>
      <text x="675" y="711" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#274e13">transactions (slow)</text>
    </a>
  </g>
  
  <!-- Voting steps -->
  <g id="voting-steps">
    <!-- Step 10: Vote on EB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#VotingEB" class="step-link">
      <rect x="580" y="725" width="190" height="35" fill="#fff8e1" stroke="#f9a825" stroke-width="1" rx="4"/>
      <text x="675" y="740" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#f9a825">10. Vote on EB</text>
      <text x="675" y="755" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#f9a825">(if eligible)</text>
    </a>
    
    <!-- Step 11: Relay votes -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#VoteDiffusion" class="step-link">
      <line x1="225" y1="775" x2="675" y2="775" stroke="#f9a825" stroke-width="2" marker-end="url(#votearrowhead)"/>
      <text x="450" y="770" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#f9a825">11. Relay votes</text>
    </a>
    
    <!-- Step 11a: Relay votes (+ own vote) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#VoteDiffusion" class="step-link">
      <line x1="675" y1="795" x2="1125" y2="795" stroke="#f9a825" stroke-width="2" marker-end="url(#votearrowhead)"/>
      <text x="900" y="790" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#f9a825">11a. Relay votes (+ own vote)</text>
    </a>
  </g>
  
  <!-- Final steps -->
  <g id="final-steps">
    <!-- Step 12: Aggregate certificate -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#CertificateAggregation" class="step-link">
      <rect x="580" y="815" width="190" height="40" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="1" rx="4"/>
      <text x="675" y="832" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#7b1fa2">12. Aggregate certificate</text>
      <text x="675" y="847" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#7b1fa2">from votes</text>
    </a>
    
    <!-- Step 13: Create next RB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#certificate-inclusion" class="step-link">
      <rect x="580" y="860" width="190" height="55" fill="#e8f5e8" stroke="#2e7d32" stroke-width="1" rx="4"/>
      <text x="675" y="877" font-family="Arial, sans-serif" font-size="13" text-anchor="middle" fill="#2e7d32">13. Create next RB</text>
      <text x="675" y="892" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#2e7d32">certifying EB &amp;</text>
      <text x="675" y="907" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#2e7d32">announcing next EB</text>
    </a>
  </g>
  
  <!-- Time axis label -->
  <text x="75" y="450" font-family="Arial, sans-serif" font-size="24" text-anchor="middle" fill="#999" transform="rotate(-90 75 450)">Time in slots</text>
</svg>
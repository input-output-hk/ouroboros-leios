<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="580" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Pattern for timeline background -->
    <pattern id="timelinePattern" x="0" y="0" width="40" height="40" patternUnits="userSpaceOnUse">
      <rect width="40" height="40" fill="#f8f8f8"/>
      <line x1="0" y1="40" x2="40" y2="0" stroke="#e8e8e8" stroke-width="0.5"/>
    </pattern>
    
    <!-- Arrow markers -->
    <marker id="arrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#595959"/>
    </marker>
    
    <!-- Arrow marker for votes/certificates -->
    <marker id="votearrowhead" markerWidth="6" markerHeight="4" refX="5" refY="2" orient="auto">
      <polygon points="0 0, 6 2, 0 4" fill="#f9a825"/>
    </marker>
    
    <!-- Hover effects -->
    <style>
      .block-link, .vote-link, .param-link {
        cursor: pointer;
      }
      .block-link:hover rect {
        stroke-width: 3;
        filter: brightness(1.1);
      }
      .block-link:hover polygon {
        stroke-width: 3;
        filter: brightness(1.1);
      }
      .block-link:hover text {
        font-weight: bold;
      }
      .vote-link:hover rect {
        transform: scale(2.0);
        filter: brightness(1.5) saturate(1.3);
        stroke: #ff6b35;
        stroke-width: 1;
      }
      .param-link:hover line,
      .param-link:hover path {
        stroke-width: 3;
        filter: brightness(1.1);
      }
      .param-link:hover text {
        font-weight: bold;
      }
    </style>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="580" fill="#ffffff"/>
  
  <!-- Timeline background -->
  <g id="timeline">
    <rect x="50" y="40" width="1100" height="40" fill="url(#timelinePattern)" stroke="#ddd" stroke-width="0.5"/>
    <text x="600" y="65" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#999">Time in slots</text>
  </g>
  
  <!-- L_recover window indicator (thin line) -->
  <g id="window-indicator">
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#l-recover" class="param-link">
      <!-- Start of window at RB' certificate -->
      <line x1="820" y1="20" x2="820" y2="100" stroke="#7cb342" stroke-width="1.5" stroke-dasharray="3,3" opacity="0.8"/>
      
      <!-- L_recover window line -->
      <line x1="820" y1="30" x2="1100" y2="30" stroke="#7cb342" stroke-width="4" opacity="0.8"/>
      <text x="960" y="20" font-family="Times New Roman, serif" font-size="20" font-style="italic" text-anchor="middle" fill="#5a8030">L<tspan font-family="Arial, sans-serif" font-size="10" font-style="normal" baseline-shift="sub">recover-RB'</tspan></text>
      
      <!-- End of window -->
      <line x1="1100" y1="20" x2="1100" y2="100" stroke="#7cb342" stroke-width="1.5" stroke-dasharray="3,3" opacity="0.8"/>
    </a>
  </g>
  
  <!-- Main protocol flow content -->
  <g id="protocol-flow">
    <!-- Continuation dots -->
    <text x="260" y="181" font-family="Arial, sans-serif" font-size="28" fill="#666" text-anchor="middle">...</text>

    <!-- RB with EB announcement -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#ranking-blocks-rbs" class="block-link">
      <rect x="330" y="120" width="100" height="120" fill="#fce5cd" stroke="#783f04" stroke-width="2" rx="8"/>
      <text x="380" y="165" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#783f04">RB</text>
      <text x="380" y="195" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#783f04">[Txs]</text>
    </a>
    
    <!-- Arrow from RB to EB with "announces" label -->
    <path d="M 380 240 L 380 276" stroke="#783f04" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#arrowhead)"/>
    <text x="385" y="260" font-family="Arial, sans-serif" font-size="14" text-anchor="start" fill="#783f04">announces</text>
    
    <!-- EB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#endorser-blocks-ebs" class="block-link">
      <rect x="305" y="280" width="150" height="100" fill="#d9ead3" stroke="#274e13" stroke-width="2" rx="8"/>
      <text x="380" y="320" font-family="Arial, sans-serif" font-size="22" font-weight="bold" text-anchor="middle" fill="#274e13">EB</text>
      <text x="380" y="350" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#274e13">[TxRefs]</text>
    </a>
    
    <!-- Arrow from predecessor -->
    <path d="M 330 180 L 290 180" stroke="#783f04" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#arrowhead)"/>
    
    <!-- Solid arrow connecting the two RBs -->
    <path d="M 770 180 L 430 180" stroke="#783f04" stroke-width="2" marker-end="url(#arrowhead)"/>
    
    <!-- Voting phase indicators (only within L_vote period) -->
    <g id="votes">
      <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#votes-and-certificates" class="vote-link">
        <rect x="492" y="395" width="8" height="8" fill="#f9a825" transform="rotate(45 496 399)"/>
      </a>
      <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#votes-and-certificates" class="vote-link">
        <rect x="526" y="390" width="8" height="8" fill="#f9a825" transform="rotate(45 530 394)"/>
      </a>
      <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#votes-and-certificates" class="vote-link">
        <rect x="560" y="400" width="8" height="8" fill="#f9a825" transform="rotate(45 564 404)"/>
      </a>
      <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#votes-and-certificates" class="vote-link">
        <rect x="594" y="385" width="8" height="8" fill="#f9a825" transform="rotate(45 598 389)"/>
      </a>
    </g>
    
    <!-- 3 Delta_hdr period indicator -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#delta-hdr" class="param-link">
      <line x1="380" y1="405" x2="480" y2="405" stroke="#9c27b0" stroke-width="1" stroke-dasharray="4,4"/>
      <path d="M 380 405 L 380 410 Q 380 415 385 415 L 425 415 L 430 422 L 435 415 L 475 415 Q 480 415 480 410 L 480 405" 
            stroke="#9c27b0" stroke-width="2" fill="none"/>
      <text x="430" y="440" font-size="22" text-anchor="middle" fill="#9c27b0">
        <tspan font-family="serif" font-size="26">3Δ</tspan><tspan font-family="Arial, sans-serif" font-size="18" baseline-shift="sub">hdr</tspan>
      </text>
    </a>
    
    <!-- L_vote period indicator (shifted right and down) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#l-vote" class="param-link">
      <line x1="480" y1="420" x2="620" y2="420" stroke="#f9a825" stroke-width="1" stroke-dasharray="4,4"/>
      <path d="M 480 420 L 480 425 Q 480 430 485 430 L 540 430 L 550 437 L 560 430 L 615 430 Q 620 430 620 425 L 620 420" 
            stroke="#f9a825" stroke-width="2" fill="none"/>
      <text x="550" y="455" font-size="22" text-anchor="middle" fill="#f9a825">
        <tspan font-family="serif" font-style="italic" font-size="26">L</tspan><tspan font-family="Arial, sans-serif" font-size="18" baseline-shift="sub">vote</tspan>
      </text>
    </a>
    
    <!-- RB' with certificate (starts/extends window) -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#ranking-blocks-rbs" class="block-link">
      <rect x="770" y="120" width="100" height="120" fill="#fce5cd" stroke="#ff6b6b" stroke-width="2" stroke-dasharray="6,3" rx="8"/>
      <text x="820" y="165" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#783f04">RB'</text>
      <text x="820" y="195" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="#783f04">[Txs]</text>
    </a>
    
    <!-- Certificate symbol -->
    <g transform="translate(820, 240)">
      <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#votes-and-certificates" class="block-link">
        <polygon points="0,-30 30,-15 30,15 0,30 -30,15 -30,-15" fill="#fff2cc" stroke="#f9a825" stroke-width="2"/>
        <text x="0" y="5" font-size="14" font-weight="bold" text-anchor="middle" fill="#7f6000">
          <tspan font-family="serif" font-style="italic" font-size="18">C</tspan><tspan font-family="Arial, sans-serif" font-size="12" font-style="normal" baseline-shift="sub">EB</tspan>
        </text>
      </a>
    </g>
    
    <!-- Arrow from certificate back to EB -->
    <path d="M 820 270 Q 720 330 455 330" stroke="#f9a825" stroke-width="2" stroke-dasharray="2,2" fill="none" marker-end="url(#votearrowhead)"/>
    
    <!-- Arrow to next block -->
    <path d="M 920 180 L 870 180" stroke="#783f04" stroke-width="2" stroke-dasharray="4,3" marker-end="url(#arrowhead)"/>
    
    <!-- Continuation dots -->
    <text x="950" y="181" font-family="Arial, sans-serif" font-size="28" fill="#666" text-anchor="middle">...</text>
  </g>
  
  <!-- Legend (centered horizontally, single line) -->
  <g id="legend" transform="translate(100, 500)">
    <text x="500" y="-15" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333" text-anchor="middle">Legend</text>
    
    <!-- RB solid and dashed side by side -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#ranking-blocks-rbs" class="block-link">
      <rect x="70" y="0" width="18" height="24" fill="#fce5cd" stroke="#783f04" stroke-width="1.5" rx="2"/>
    </a>
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#ranking-blocks-rbs" class="block-link">
      <rect x="92" y="0" width="18" height="24" fill="#fce5cd" stroke="#ff6b6b" stroke-width="1.5" stroke-dasharray="4,2" rx="2"/>
    </a>
    <text x="122" y="16" font-family="Arial, sans-serif" font-size="14" fill="#333">Ranking Block (RB)</text>
    
    <!-- EB -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#endorser-blocks-ebs" class="block-link">
      <rect x="260" y="3" width="24" height="18" fill="#d9ead3" stroke="#274e13" stroke-width="1.5" rx="2"/>
    </a>
    <text x="290" y="16" font-family="Arial, sans-serif" font-size="14" fill="#333">Endorser Block (EB)</text>
    
    <!-- Certificate -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#votes-and-certificates" class="block-link">
      <polygon points="440,0 450,6 450,18 440,24 430,18 430,6" fill="#fff2cc" stroke="#f9a825" stroke-width="1"/>
    </a>
    <text x="458" y="16" font-family="Arial, sans-serif" font-size="14" fill="#333">Certificate</text>
    
    <!-- Vote -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#votes-and-certificates" class="vote-link">
      <rect x="535" y="5" width="10" height="10" fill="#f9a825" transform="rotate(45 540 10)"/>
    </a>
    <text x="555" y="16" font-family="Arial, sans-serif" font-size="14" fill="#333">Vote</text>
    
    <!-- 3 Delta_hdr period -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#delta-hdr" class="param-link">
      <line x1="600" y1="7" x2="600" y2="19" stroke="#9c27b0" stroke-width="1" stroke-dasharray="2,2" opacity="0.8"/>
      <line x1="600" y1="12" x2="630" y2="12" stroke="#9c27b0" stroke-width="3" opacity="0.8"/>
      <line x1="630" y1="7" x2="630" y2="19" stroke="#9c27b0" stroke-width="1" stroke-dasharray="2,2" opacity="0.8"/>
      <text x="635" y="16" font-family="Arial, sans-serif" font-size="14" fill="#333"><tspan font-family="Times New Roman, serif" font-size="16">3Δ</tspan><tspan font-size="10" baseline-shift="sub">hdr</tspan> period</text>
    </a>
    
    <!-- L_recover window with dashed verticals -->
    <a href="https://github.com/input-output-hk/ouroboros-leios/blob/cip/review/docs/cip/README.md#l-recover" class="param-link">
      <line x1="740" y1="7" x2="740" y2="19" stroke="#7cb342" stroke-width="1" stroke-dasharray="2,2" opacity="0.8"/>
      <line x1="740" y1="12" x2="770" y2="12" stroke="#7cb342" stroke-width="3" opacity="0.8"/>
      <line x1="770" y1="7" x2="770" y2="19" stroke="#7cb342" stroke-width="1" stroke-dasharray="2,2" opacity="0.8"/>
      <text x="775" y="16" font-family="Arial, sans-serif" font-size="14" fill="#333"><tspan font-family="Times New Roman, serif" font-style="italic" font-size="16">L</tspan><tspan font-size="10" baseline-shift="sub">recover</tspan> window</text>
    </a>
  </g>
</svg>
# Demo Scripts for Leios Crypto Benchmarks

## Setup

From the `demo/` directory, go one level up to the `crypto-benchmarks.rs` directory and build the CLI binary:

```bash
cd ..
cargo build --release
```

**Register the CLI path (while still in `crypto-benchmarks.rs/`)** so all demo scripts can find it:

```bash
./demo/scripts/00_set_cli.sh -p "$(pwd)/target/release/leios_crypto_benchmarks"
```

Now return to the `demo/` directory to proceed:

```bash
cd demo
```

Verify the `.env_cli` file and sanity‑check the CLI:

```bash
cat scripts/.env_cli
source scripts/.env_cli
echo "$CLI"
$CLI --help
```

Ensure the CLI binary is accessible and working before proceeding.

## Python Environment Setup

Create and activate a Python virtual environment, then install the required dependencies:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install flask cbor2
```

(Flask is required to serve the demo UI, and cbor2 is used for parsing CBOR files.)

## Run a Single End-to-End Demo

From the `demo/` directory, run the combined script to generate a complete demo for a specified number of voters and pools. Ensure `.env_cli` exists in this directory:

(If you haven’t yet, run the **Setup** steps above to build the CLI and create `scripts/.env_cli`.)

```bash
scripts/70_run_one.sh -d run100 -p 500 -n 100 -f 0.75
```

This script will:

1. Initialize inputs
2. Build the registry
3. Cast votes
4. Generate the aggregated certificate
5. Verify the certificate
6. Export data for the UI

All output files will be placed under `demo/run100/`.

## Launch the Demo UI

After generating a demo run, start the UI server from the `demo/` directory:

```bash
python3 ui/server.py
```

Open your browser at [http://127.0.0.1:5050/ui](http://127.0.0.1:5050/ui) to explore the results.

## Run Step by Step (Manual Mode)

For advanced users who want to control each phase individually, the following scripts can be run sequentially from the `demo/` directory. Use the `-d` option to specify the output directory (e.g., `run100`).

1. **Initialize inputs for N voters:**

```bash
scripts/10_init_inputs.sh -d run100 --pools 500 --stake 100000 --alpha 9 --beta 1
```

2. **Build the registry:**

```bash
scripts/20_make_registry.sh -d run100 -n 100
```

3. **Cast votes with a fraction of voters participating:**

```bash
scripts/30_cast_votes.sh -d run100 -f 0.75
```

4. **Generate the aggregated certificate:**

```bash
scripts/40_make_certificate.sh -d run100
```

5. **Verify the generated certificate:**

```bash
scripts/50_verify_certificate.sh -d run100
```

## Notes

- All scripts must be run from within the `demo/` directory.
- Directories passed via `-d` will be created automatically under `demo/`.
- Compression ratio is defined as:

  ```
  votes_bytes / certificate_bytes
  ```

  which illustrates the storage and bandwidth savings achieved by BLS aggregation.
- The CLI path is stored in `scripts/.env_cli` (generated by `00_set_cli.sh`). Source it with `source scripts/.env_cli` to make `$CLI` available in your shell.

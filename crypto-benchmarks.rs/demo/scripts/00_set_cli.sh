#!/usr/bin/env bash
set -euo pipefail
# Usage: demo/scripts/00_set_cli.sh [-p /abs/path/to/leios_crypto_benchmarks]
# Writes demo/scripts/.env_cli with an absolute CLI path so other scripts can source it.

DIR_SCRIPT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ENV_FILE="$DIR_SCRIPT/.env_cli"
CLI_PATH=""

while getopts ":p:" opt; do
  case "$opt" in
    p) CLI_PATH="$OPTARG" ;;
    *) echo "Usage: $0 [-p /abs/path/to/leios_crypto_benchmarks]"; exit 2 ;;
  esac
done

if [[ -z "${CLI_PATH}" ]]; then
  read -r -p "Absolute path to leios_crypto_benchmarks binary: " CLI_PATH
fi

if [[ ! -x "${CLI_PATH}" ]]; then
  echo "Error: '${CLI_PATH}' is not an executable file." >&2
  exit 1
fi

mkdir -p "$DIR_SCRIPT"
cat > "$ENV_FILE" <<EOF
# Auto-generated by 00_set_cli.sh
export CLI="${CLI_PATH}"
EOF

echo "Saved CLI path to $ENV_FILE"
echo "Example: source \"$ENV_FILE\" && \$CLI --help"
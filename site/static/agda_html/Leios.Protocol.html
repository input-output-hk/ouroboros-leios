<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Leios.Protocol</title><link rel="stylesheet" href="Agda.css">
             <link rel="stylesheet" href="agda.css">
             <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet"></head><body>
             <div class="agda-header">
               <div class="agda-header-left">
                 <a href="/formal-spec/">Back</a>
                 <button class="search-button" onclick="toggleSearch()">
                   <svg viewBox="0 0 24 24" width="24" height="24">
                     <path fill="currentColor" d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                   </svg>
                   Search...
                 </button>
               </div>
               <div class="agda-header-right">
                 <a href="https://github.com/input-output-hk/ouroboros-leios-formal-spec" class="github-link" target="_blank" rel="noopener noreferrer" title="View on GitHub">
                   <svg viewBox="0 0 24 24" width="24" height="24">
                     <path fill="currentColor" d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                   </svg>
                 </a>
                 <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                   <span class="light-icon">
                     <svg viewBox="0 0 24 24" width="24" height="24">
                       <path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path>
                     </svg>
                   </span>
                   <span class="dark-icon">
                     <svg viewBox="0 0 24 24" width="24" height="24">
                       <path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path>
                     </svg>
                   </span>
                 </button>
               </div>
             </div>
             <div class="search-overlay">
               <div class="search-modal">
                 <div class="search-container">
                   <input type="text" class="search-input" placeholder="Search modules..." />
                   <div class="search-results"></div>
                 </div>
               </div>
             </div>
             <div class="agda-container">
               <nav class="agda-sidebar">
                 <h3>Modules</h3>
                 
                     <h4>Leios</h4>
                     <ul>
                       <li><a href="/agda_html/Leios.Abstract.html" >Abstract</a></li>
<li><a href="/agda_html/Leios.Base.html" >Base</a></li>
<li><a href="/agda_html/Leios.Blocks.html" >Blocks</a></li>
<li><a href="/agda_html/Leios.Config.html" >Config</a></li>
<li><a href="/agda_html/Leios.Defaults.html" >Defaults</a></li>
<li><a href="/agda_html/Leios.FFD.html" >FFD</a></li>
<li><a href="/agda_html/Leios.Foreign.BaseTypes.html" >Foreign.BaseTypes</a></li>
<li><a href="/agda_html/Leios.Foreign.HsTypes.html" >Foreign.HsTypes</a></li>
<li><a href="/agda_html/Leios.Foreign.Types.html" >Foreign.Types</a></li>
<li><a href="/agda_html/Leios.Foreign.Util.html" >Foreign.Util</a></li>
<li><a href="/agda_html/Leios.KeyRegistration.html" >KeyRegistration</a></li>
<li><a href="/agda_html/Leios.Network.html" >Network</a></li>
<li><a href="/agda_html/Leios.Prelude.html" >Prelude</a></li>
<li><a href="/agda_html/Leios.Protocol.html" class="active">Protocol</a></li>
<li><a href="/agda_html/Leios.Short.html" >Short</a></li>
<li><a href="/agda_html/Leios.Short.Decidable.html" >Short.Decidable</a></li>
<li><a href="/agda_html/Leios.Short.Trace.Verifier.html" >Short.Trace.Verifier</a></li>
<li><a href="/agda_html/Leios.Short.Trace.Verifier.Test.html" >Short.Trace.Verifier.Test</a></li>
<li><a href="/agda_html/Leios.Simplified.html" >Simplified</a></li>
<li><a href="/agda_html/Leios.Simplified.Deterministic.html" >Simplified.Deterministic</a></li>
<li><a href="/agda_html/Leios.SpecStructure.html" >SpecStructure</a></li>
<li><a href="/agda_html/Leios.Traces.html" >Traces</a></li>
<li><a href="/agda_html/Leios.Voting.html" >Voting</a></li>
<li><a href="/agda_html/Leios.VRF.html" >VRF</a></li>
                     </ul>
                   
               </nav>
               <main class="agda-content">
             <script src="agda.js"></script><pre class="Agda"><div class="line"><a id="1" class="Symbol">{-#</a> <a id="5" class="Keyword">OPTIONS</a> <a id="13" class="Pragma">--safe</a> <a id="20" class="Symbol">#-}</a></div>
<div class="line"></div>
<div class="line"><a id="25" class="Keyword">open</a> <a id="30" class="Keyword">import</a> <a id="37" href="/agda_html/Leios.Prelude.html" class="Module">Leios.Prelude</a> <a id="51" class="Keyword">hiding</a> <a id="58" class="Symbol">(</a><a id="59" href="/agda_html/Function.Base.html#704" class="Function">id</a><a id="61" class="Symbol">)</a></div>
<div class="line"><a id="63" class="Keyword">open</a> <a id="68" class="Keyword">import</a> <a id="75" href="/agda_html/Leios.FFD.html" class="Module">Leios.FFD</a></div>
<div class="line"><a id="85" class="Keyword">open</a> <a id="90" class="Keyword">import</a> <a id="97" href="/agda_html/Leios.SpecStructure.html" class="Module">Leios.SpecStructure</a></div>
<div class="line"></div>
<div class="line"><a id="118" class="Keyword">module</a> <a id="125" href="/agda_html/Leios.Protocol.html" class="Module">Leios.Protocol</a> <a id="140" class="Symbol">{</a><a id="141" href="/agda_html/Leios.Protocol.html#141" class="Bound">n</a><a id="142" class="Symbol">}</a> <a id="144" class="Symbol">(</a><a id="145" href="/agda_html/Leios.Protocol.html#145" class="Bound">⋯</a> <a id="147" class="Symbol">:</a> <a id="149" href="/agda_html/Leios.SpecStructure.html#286" class="Record">SpecStructure</a> <a id="163" href="/agda_html/Leios.Protocol.html#141" class="Bound">n</a><a id="164" class="Symbol">)</a> <a id="166" class="Symbol">(</a><a id="167" class="Keyword">let</a> <a id="171" class="Keyword">open</a> <a id="176" href="/agda_html/Leios.SpecStructure.html#286" class="Module">SpecStructure</a> <a id="190" href="/agda_html/Leios.Protocol.html#145" class="Bound">⋯</a><a id="191" class="Symbol">)</a> <a id="193" class="Symbol">(</a><a id="194" href="/agda_html/Leios.Protocol.html#194" class="Bound">SlotUpkeep</a> <a id="205" class="Symbol">:</a> <a id="207" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a><a id="211" class="Symbol">)</a> <a id="213" class="Keyword">where</a></div>
<div class="line"></div>
<div class="line"><a id="220" class="Keyword">open</a> <a id="225" href="/agda_html/Leios.Base.html#389" class="Module">BaseAbstract</a> <a id="238" href="/agda_html/Leios.SpecStructure.html#835" class="Field">B&#39;</a> <a id="241" class="Keyword">using</a> <a id="247" class="Symbol">(</a><a id="248" href="/agda_html/Leios.Base.html#424" class="Field">Cert</a><a id="252" class="Symbol">;</a> <a id="254" href="/agda_html/Leios.Base.html#490" class="Field">V-chkCerts</a><a id="264" class="Symbol">;</a> <a id="266" href="/agda_html/Leios.Base.html#444" class="Field">VTy</a><a id="269" class="Symbol">;</a> <a id="271" href="/agda_html/Leios.Base.html#463" class="Field">initSlot</a><a id="279" class="Symbol">)</a></div>
<div class="line"><a id="281" class="Keyword">open</a> <a id="286" href="/agda_html/Leios.Blocks.html#4246" class="Module">GenFFD</a></div>
<div class="line"></div>
<div class="line"><a id="294" class="Comment">-- High level structure:</a></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><a id="321" class="Comment">--                                      (simple) Leios</a></div>
<div class="line"><a id="376" class="Comment">--                                        /         |</a></div>
<div class="line"><a id="430" class="Comment">-- +-------------------------------------+          |</a></div>
<div class="line"><a id="484" class="Comment">-- | Header Diffusion     Body Diffusion |          |</a></div>
<div class="line"><a id="538" class="Comment">-- +-------------------------------------+       Base Protocol</a></div>
<div class="line"><a id="601" class="Comment">--                                        \      /</a></div>
<div class="line"><a id="652" class="Comment">--                                        Network</a></div>
<div class="line"></div>
<div class="line"><a id="703" class="Keyword">data</a> <a id="LeiosInput"></a><a id="708" href="/agda_html/Leios.Protocol.html#708" class="Datatype">LeiosInput</a> <a id="719" class="Symbol">:</a> <a id="721" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a> <a id="726" class="Keyword">where</a></div>
<div class="line">  <a id="LeiosInput.INIT"></a><a id="734" href="/agda_html/Leios.Protocol.html#734" class="InductiveConstructor">INIT</a>     <a id="743" class="Symbol">:</a> <a id="745" href="/agda_html/Leios.Base.html#444" class="Function">VTy</a> <a id="749" class="Symbol">→</a> <a id="751" href="/agda_html/Leios.Protocol.html#708" class="Datatype">LeiosInput</a></div>
<div class="line">  <a id="LeiosInput.SUBMIT"></a><a id="764" href="/agda_html/Leios.Protocol.html#764" class="InductiveConstructor">SUBMIT</a>   <a id="773" class="Symbol">:</a> <a id="775" href="/agda_html/Leios.Blocks.html#2804" class="Function">EndorserBlock</a> <a id="789" href="/agda_html/Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="791" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="796" href="/agda_html/Leios.Abstract.html#124" class="Function">Tx</a> <a id="799" class="Symbol">→</a> <a id="801" href="/agda_html/Leios.Protocol.html#708" class="Datatype">LeiosInput</a></div>
<div class="line">  <a id="LeiosInput.SLOT"></a><a id="814" href="/agda_html/Leios.Protocol.html#814" class="InductiveConstructor">SLOT</a>     <a id="823" class="Symbol">:</a> <a id="825" href="/agda_html/Leios.Protocol.html#708" class="Datatype">LeiosInput</a></div>
<div class="line">  <a id="LeiosInput.FTCH-LDG"></a><a id="838" href="/agda_html/Leios.Protocol.html#838" class="InductiveConstructor">FTCH-LDG</a> <a id="847" class="Symbol">:</a> <a id="849" href="/agda_html/Leios.Protocol.html#708" class="Datatype">LeiosInput</a></div>
<div class="line"></div>
<div class="line"><a id="861" class="Keyword">data</a> <a id="LeiosOutput"></a><a id="866" href="/agda_html/Leios.Protocol.html#866" class="Datatype">LeiosOutput</a> <a id="878" class="Symbol">:</a> <a id="880" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a> <a id="885" class="Keyword">where</a></div>
<div class="line">  <a id="LeiosOutput.FTCH-LDG"></a><a id="893" href="/agda_html/Leios.Protocol.html#893" class="InductiveConstructor">FTCH-LDG</a> <a id="902" class="Symbol">:</a> <a id="904" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="909" href="/agda_html/Leios.Abstract.html#124" class="Function">Tx</a> <a id="912" class="Symbol">→</a> <a id="914" href="/agda_html/Leios.Protocol.html#866" class="Datatype">LeiosOutput</a></div>
<div class="line">  <a id="LeiosOutput.EMPTY"></a><a id="928" href="/agda_html/Leios.Protocol.html#928" class="InductiveConstructor">EMPTY</a>    <a id="937" class="Symbol">:</a> <a id="939" href="/agda_html/Leios.Protocol.html#866" class="Datatype">LeiosOutput</a></div>
<div class="line"></div>
<div class="line"><a id="952" class="Keyword">record</a> <a id="LeiosState"></a><a id="959" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="970" class="Symbol">:</a> <a id="972" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a> <a id="977" class="Keyword">where</a></div>
<div class="line">  <a id="985" class="Keyword">field</a> <a id="LeiosState.V"></a><a id="991" href="/agda_html/Leios.Protocol.html#991" class="Field">V</a>           <a id="1003" class="Symbol">:</a> <a id="1005" href="/agda_html/Leios.Base.html#444" class="Function">VTy</a></div>
<div class="line">        <a id="LeiosState.SD"></a><a id="1017" href="/agda_html/Leios.Protocol.html#1017" class="Field">SD</a>          <a id="1029" class="Symbol">:</a> <a id="1031" href="/agda_html/Leios.Base.html#266" class="Function">StakeDistr</a></div>
<div class="line">        <a id="LeiosState.FFDState"></a><a id="1050" href="/agda_html/Leios.Protocol.html#1050" class="Field">FFDState</a>    <a id="1062" class="Symbol">:</a> <a id="1064" href="/agda_html/Leios.FFD.html#508" class="Function">FFD.State</a></div>
<div class="line">        <a id="LeiosState.Ledger"></a><a id="1082" href="/agda_html/Leios.Protocol.html#1082" class="Field">Ledger</a>      <a id="1094" class="Symbol">:</a> <a id="1096" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1101" href="/agda_html/Leios.Abstract.html#124" class="Function">Tx</a></div>
<div class="line">        <a id="LeiosState.ToPropose"></a><a id="1112" href="/agda_html/Leios.Protocol.html#1112" class="Field">ToPropose</a>   <a id="1124" class="Symbol">:</a> <a id="1126" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1131" href="/agda_html/Leios.Abstract.html#124" class="Function">Tx</a></div>
<div class="line">        <a id="LeiosState.IBs"></a><a id="1142" href="/agda_html/Leios.Protocol.html#1142" class="Field">IBs</a>         <a id="1154" class="Symbol">:</a> <a id="1156" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1161" href="/agda_html/Leios.Blocks.html#1105" class="Record">InputBlock</a></div>
<div class="line">        <a id="LeiosState.EBs"></a><a id="1180" href="/agda_html/Leios.Protocol.html#1180" class="Field">EBs</a>         <a id="1192" class="Symbol">:</a> <a id="1194" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1199" href="/agda_html/Leios.Blocks.html#2804" class="Function">EndorserBlock</a></div>
<div class="line">        <a id="LeiosState.Vs"></a><a id="1221" href="/agda_html/Leios.Protocol.html#1221" class="Field">Vs</a>          <a id="1233" class="Symbol">:</a> <a id="1235" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1240" class="Symbol">(</a><a id="1241" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1246" href="/agda_html/Leios.Abstract.html#448" class="Function">Vote</a><a id="1250" class="Symbol">)</a></div>
<div class="line">        <a id="LeiosState.slot"></a><a id="1260" href="/agda_html/Leios.Protocol.html#1260" class="Field">slot</a>        <a id="1272" class="Symbol">:</a> <a id="1274" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a></div>
<div class="line">        <a id="LeiosState.IBHeaders"></a><a id="1284" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a>   <a id="1296" class="Symbol">:</a> <a id="1298" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1303" href="/agda_html/Leios.Blocks.html#987" class="Function">IBHeader</a></div>
<div class="line">        <a id="LeiosState.IBBodies"></a><a id="1320" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a>    <a id="1332" class="Symbol">:</a> <a id="1334" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1339" href="/agda_html/Leios.Blocks.html#1055" class="Record">IBBody</a></div>
<div class="line">        <a id="LeiosState.Upkeep"></a><a id="1354" href="/agda_html/Leios.Protocol.html#1354" class="Field">Upkeep</a>      <a id="1366" class="Symbol">:</a> <a id="1368" href="/agda_html/abstract-set-theory.FiniteSetTheory.html#488" class="Function Operator">ℙ</a> <a id="1370" href="/agda_html/Leios.Protocol.html#194" class="Bound">SlotUpkeep</a></div>
<div class="line">        <a id="LeiosState.BaseState"></a><a id="1389" href="/agda_html/Leios.Protocol.html#1389" class="Field">BaseState</a>   <a id="1401" class="Symbol">:</a> <a id="1403" href="/agda_html/Leios.Base.html#847" class="Function">B.State</a></div>
<div class="line">        <a id="LeiosState.votingState"></a><a id="1419" href="/agda_html/Leios.Protocol.html#1419" class="Field">votingState</a> <a id="1431" class="Symbol">:</a> <a id="1433" href="/agda_html/Leios.Voting.html#134" class="Function">VotingState</a></div>
<div class="line">        <a id="LeiosState.PubKeys"></a><a id="1453" href="/agda_html/Leios.Protocol.html#1453" class="Field">PubKeys</a>     <a id="1465" class="Symbol">:</a> <a id="1467" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1472" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a></div>
<div class="line"></div>
<div class="line">  <a id="LeiosState.lookupEB"></a><a id="1482" href="/agda_html/Leios.Protocol.html#1482" class="Function">lookupEB</a> <a id="1491" class="Symbol">:</a> <a id="1493" href="/agda_html/Leios.Blocks.html#618" class="Function">EBRef</a> <a id="1499" class="Symbol">→</a> <a id="1501" href="/agda_html/Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1507" href="/agda_html/Leios.Blocks.html#2804" class="Function">EndorserBlock</a></div>
<div class="line">  <a id="1523" href="/agda_html/Leios.Protocol.html#1482" class="Function">lookupEB</a> <a id="1532" href="/agda_html/Leios.Protocol.html#1532" class="Bound">r</a> <a id="1534" class="Symbol">=</a> <a id="1536" href="/agda_html/Data.List.Base.html#13625" class="Function">find</a> <a id="1541" class="Symbol">(λ</a> <a id="1544" href="/agda_html/Leios.Protocol.html#1544" class="Bound">b</a> <a id="1546" class="Symbol">→</a> <a id="1548" href="/agda_html/Leios.Blocks.html#3791" class="Function">getEBRef</a> <a id="1557" href="/agda_html/Leios.Protocol.html#1544" class="Bound">b</a> <a id="1559" href="/agda_html/Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1561" href="/agda_html/Leios.Protocol.html#1532" class="Bound">r</a><a id="1562" class="Symbol">)</a> <a id="1564" href="/agda_html/Leios.Protocol.html#1180" class="Field">EBs</a></div>
<div class="line"></div>
<div class="line">  <a id="LeiosState.lookupIB"></a><a id="1571" href="/agda_html/Leios.Protocol.html#1571" class="Function">lookupIB</a> <a id="1580" class="Symbol">:</a> <a id="1582" href="/agda_html/Leios.Blocks.html#605" class="Function">IBRef</a> <a id="1588" class="Symbol">→</a> <a id="1590" href="/agda_html/Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="1596" href="/agda_html/Leios.Blocks.html#1105" class="Record">InputBlock</a></div>
<div class="line">  <a id="1609" href="/agda_html/Leios.Protocol.html#1571" class="Function">lookupIB</a> <a id="1618" href="/agda_html/Leios.Protocol.html#1618" class="Bound">r</a> <a id="1620" class="Symbol">=</a> <a id="1622" href="/agda_html/Data.List.Base.html#13625" class="Function">find</a> <a id="1627" class="Symbol">(λ</a> <a id="1630" href="/agda_html/Leios.Protocol.html#1630" class="Bound">b</a> <a id="1632" class="Symbol">→</a> <a id="1634" href="/agda_html/Leios.Blocks.html#2304" class="Function">getIBRef</a> <a id="1643" href="/agda_html/Leios.Protocol.html#1630" class="Bound">b</a> <a id="1645" href="/agda_html/Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="1647" href="/agda_html/Leios.Protocol.html#1618" class="Bound">r</a><a id="1648" class="Symbol">)</a> <a id="1650" href="/agda_html/Leios.Protocol.html#1142" class="Field">IBs</a></div>
<div class="line"></div>
<div class="line">  <a id="LeiosState.lookupTxs"></a><a id="1657" href="/agda_html/Leios.Protocol.html#1657" class="Function">lookupTxs</a> <a id="1667" class="Symbol">:</a> <a id="1669" href="/agda_html/Leios.Blocks.html#2804" class="Function">EndorserBlock</a> <a id="1683" class="Symbol">→</a> <a id="1685" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1690" href="/agda_html/Leios.Abstract.html#124" class="Function">Tx</a></div>
<div class="line">  <a id="1695" href="/agda_html/Leios.Protocol.html#1657" class="Function">lookupTxs</a> <a id="1705" href="/agda_html/Leios.Protocol.html#1705" class="Bound">eb</a> <a id="1708" class="Symbol">=</a> <a id="1710" class="Keyword">do</a></div>
<div class="line">    <a id="1717" href="/agda_html/Leios.Protocol.html#1717" class="Bound">eb′</a> <a id="1721" href="/agda_html/Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="1723" href="/agda_html/Data.List.Base.html#4628" class="Function">mapMaybe</a> <a id="1732" href="/agda_html/Leios.Protocol.html#1482" class="Function">lookupEB</a> <a id="1741" href="/agda_html/Function.Base.html#1974" class="Function Operator">$</a> <a id="1743" href="/agda_html/Leios.Blocks.html#2754" class="Field">ebRefs</a> <a id="1750" href="/agda_html/Leios.Protocol.html#1705" class="Bound">eb</a></div>
<div class="line">    <a id="1757" href="/agda_html/Leios.Protocol.html#1757" class="Bound">ib</a>  <a id="1761" href="/agda_html/Class.Monad.Core.html#290" class="Field Operator">←</a> <a id="1763" href="/agda_html/Data.List.Base.html#4628" class="Function">mapMaybe</a> <a id="1772" href="/agda_html/Leios.Protocol.html#1571" class="Function">lookupIB</a> <a id="1781" href="/agda_html/Function.Base.html#1974" class="Function Operator">$</a> <a id="1783" href="/agda_html/Leios.Blocks.html#2722" class="Field">ibRefs</a> <a id="1790" href="/agda_html/Leios.Protocol.html#1717" class="Bound">eb′</a></div>
<div class="line">    <a id="1798" href="/agda_html/Leios.Blocks.html#1083" class="Field">txs</a> <a id="1802" href="/agda_html/Function.Base.html#1974" class="Function Operator">$</a> <a id="1804" href="/agda_html/Leios.Blocks.html#1163" class="Field">body</a> <a id="1809" href="/agda_html/Leios.Protocol.html#1757" class="Bound">ib</a></div>
<div class="line">    <a id="1816" class="Keyword">where</a> <a id="1822" class="Keyword">open</a> <a id="1827" href="/agda_html/Leios.Blocks.html#2592" class="Module">EndorserBlockOSig</a></div>
<div class="line">          <a id="1855" class="Keyword">open</a> <a id="1860" href="/agda_html/Leios.Blocks.html#1055" class="Module">IBBody</a></div>
<div class="line">          <a id="1877" class="Keyword">open</a> <a id="1882" href="/agda_html/Leios.Blocks.html#1105" class="Module">InputBlock</a></div>
<div class="line"></div>
<div class="line">  <a id="LeiosState.constructLedger"></a><a id="1896" href="/agda_html/Leios.Protocol.html#1896" class="Function">constructLedger</a> <a id="1912" class="Symbol">:</a> <a id="1914" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1919" href="/agda_html/Leios.Base.html#316" class="Function">RankingBlock</a> <a id="1932" class="Symbol">→</a> <a id="1934" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1939" href="/agda_html/Leios.Abstract.html#124" class="Function">Tx</a></div>
<div class="line">  <a id="1944" href="/agda_html/Leios.Protocol.html#1896" class="Function">constructLedger</a> <a id="1960" class="Symbol">=</a> <a id="1962" href="/agda_html/Data.List.Base.html#4350" class="Function">L.concat</a> <a id="1971" href="/agda_html/Function.Base.html#1115" class="Function Operator">∘</a> <a id="1973" href="/agda_html/Data.List.Base.html#1634" class="Function">L.map</a> <a id="1979" class="Symbol">(</a><a id="1980" href="/agda_html/Data.These.html#1085" class="Function">T.mergeThese</a> <a id="1993" href="/agda_html/Data.List.Base.html#1734" class="Function Operator">L._++_</a> <a id="2000" href="/agda_html/Function.Base.html#1115" class="Function Operator">∘</a> <a id="2002" href="/agda_html/Data.These.Base.html#1005" class="Function">T.map₁</a> <a id="2009" href="/agda_html/Leios.Protocol.html#1657" class="Function">lookupTxs</a><a id="2018" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line">  <a id="LeiosState.needsUpkeep"></a><a id="2023" href="/agda_html/Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="2035" class="Symbol">:</a> <a id="2037" href="/agda_html/Leios.Protocol.html#194" class="Bound">SlotUpkeep</a> <a id="2048" class="Symbol">→</a> <a id="2050" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Set</a></div>
<div class="line">  <a id="2056" href="/agda_html/Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="2068" class="Symbol">=</a> <a id="2070" href="/agda_html/Class.IsSet.html#462" class="Function Operator">_∉</a> <a id="2073" href="/agda_html/Leios.Protocol.html#1354" class="Field">Upkeep</a></div>
<div class="line"></div>
<div class="line">  <a id="LeiosState.Dec-needsUpkeep"></a><a id="2083" href="/agda_html/Leios.Protocol.html#2083" class="Function">Dec-needsUpkeep</a> <a id="2099" class="Symbol">:</a> <a id="2101" class="Symbol">∀</a> <a id="2103" class="Symbol">{</a><a id="2104" href="/agda_html/Leios.Protocol.html#2104" class="Bound">u</a> <a id="2106" class="Symbol">:</a> <a id="2108" href="/agda_html/Leios.Protocol.html#194" class="Bound">SlotUpkeep</a><a id="2118" class="Symbol">}</a> <a id="2120" class="Symbol">→</a> <a id="2122" class="Symbol">⦃</a> <a id="2124" href="/agda_html/Class.DecEq.Core.html#117" class="Record">DecEq</a> <a id="2130" href="/agda_html/Leios.Protocol.html#194" class="Bound">SlotUpkeep</a> <a id="2141" class="Symbol">⦄</a> <a id="2143" class="Symbol">→</a> <a id="2145" href="/agda_html/Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="2157" href="/agda_html/Leios.Protocol.html#2104" class="Bound">u</a> <a id="2159" href="/agda_html/Class.Decidable.Core.html#208" class="Record Operator">⁇</a></div>
<div class="line">  <a id="2163" href="/agda_html/Leios.Protocol.html#2083" class="Function">Dec-needsUpkeep</a> <a id="2179" class="Symbol">{</a><a id="2180" href="/agda_html/Leios.Protocol.html#2180" class="Bound">u</a><a id="2181" class="Symbol">}</a> <a id="2183" class="Symbol">.</a><a id="2184" href="/agda_html/Class.Decidable.Core.html#264" class="Field">dec</a> <a id="2188" class="Symbol">=</a> <a id="2190" href="/agda_html/Relation.Nullary.Decidable.Core.html#3011" class="Function">¬?</a> <a id="2193" class="Symbol">(</a><a id="2194" href="/agda_html/Leios.Protocol.html#2180" class="Bound">u</a> <a id="2196" href="/agda_html/Axiom.Set.html#10771" class="Function Operator">∈?</a> <a id="2199" href="/agda_html/Leios.Protocol.html#1354" class="Field">Upkeep</a><a id="2205" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line"><a id="addUpkeep"></a><a id="2208" href="/agda_html/Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="2218" class="Symbol">:</a> <a id="2220" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="2231" class="Symbol">→</a> <a id="2233" href="/agda_html/Leios.Protocol.html#194" class="Bound">SlotUpkeep</a> <a id="2244" class="Symbol">→</a> <a id="2246" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a></div>
<div class="line"><a id="2257" href="/agda_html/Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="2267" href="/agda_html/Leios.Protocol.html#2267" class="Bound">s</a> <a id="2269" href="/agda_html/Leios.Protocol.html#2269" class="Bound">u</a> <a id="2271" class="Symbol">=</a> <a id="2273" class="Keyword">let</a> <a id="2277" class="Keyword">open</a> <a id="2282" href="/agda_html/Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="2293" href="/agda_html/Leios.Protocol.html#2267" class="Bound">s</a> <a id="2295" class="Keyword">in</a> <a id="2298" class="Keyword">record</a> <a id="2305" href="/agda_html/Leios.Protocol.html#2267" class="Bound">s</a> <a id="2307" class="Symbol">{</a> <a id="2309" href="/agda_html/Leios.Protocol.html#1354" class="Field">Upkeep</a> <a id="2316" class="Symbol">=</a> <a id="2318" href="/agda_html/Leios.Protocol.html#1354" class="Function">Upkeep</a> <a id="2325" href="/agda_html/Axiom.Set.html#8952" class="Function Operator">∪</a> <a id="2327" href="/agda_html/Class.HasSingleton.html#288" class="Field Operator">❴</a> <a id="2329" href="/agda_html/Leios.Protocol.html#2269" class="Bound">u</a> <a id="2331" href="/agda_html/Class.HasSingleton.html#288" class="Field Operator">❵</a> <a id="2333" class="Symbol">}</a></div>
<div class="line"><a id="2335" class="Symbol">{-#</a> <a id="2339" class="Keyword">INJECTIVE_FOR_INFERENCE</a> <a id="2363" href="/agda_html/Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="2373" class="Symbol">#-}</a></div>
<div class="line"></div>
<div class="line"><a id="initLeiosState"></a><a id="2378" href="/agda_html/Leios.Protocol.html#2378" class="Function">initLeiosState</a> <a id="2393" class="Symbol">:</a> <a id="2395" href="/agda_html/Leios.Base.html#444" class="Function">VTy</a> <a id="2399" class="Symbol">→</a> <a id="2401" href="/agda_html/Leios.Base.html#266" class="Function">StakeDistr</a> <a id="2412" class="Symbol">→</a> <a id="2414" href="/agda_html/Leios.Base.html#847" class="Function">B.State</a> <a id="2422" class="Symbol">→</a> <a id="2424" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2429" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a> <a id="2436" class="Symbol">→</a> <a id="2438" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a></div>
<div class="line"><a id="2449" href="/agda_html/Leios.Protocol.html#2378" class="Function">initLeiosState</a> <a id="2464" href="/agda_html/Leios.Protocol.html#2464" class="Bound">V</a> <a id="2466" href="/agda_html/Leios.Protocol.html#2466" class="Bound">SD</a> <a id="2469" href="/agda_html/Leios.Protocol.html#2469" class="Bound">bs</a> <a id="2472" href="/agda_html/Leios.Protocol.html#2472" class="Bound">pks</a> <a id="2476" class="Symbol">=</a> <a id="2478" class="Keyword">record</a></div>
<div class="line">  <a id="2487" class="Symbol">{</a> <a id="2489" href="/agda_html/Leios.Protocol.html#991" class="Field">V</a>           <a id="2501" class="Symbol">=</a> <a id="2503" href="/agda_html/Leios.Protocol.html#2464" class="Bound">V</a></div>
<div class="line">  <a id="2507" class="Symbol">;</a> <a id="2509" href="/agda_html/Leios.Protocol.html#1017" class="Field">SD</a>          <a id="2521" class="Symbol">=</a> <a id="2523" href="/agda_html/Leios.Protocol.html#2466" class="Bound">SD</a></div>
<div class="line">  <a id="2528" class="Symbol">;</a> <a id="2530" href="/agda_html/Leios.Protocol.html#1050" class="Field">FFDState</a>    <a id="2542" class="Symbol">=</a> <a id="2544" href="/agda_html/Leios.FFD.html#531" class="Function">FFD.initFFDState</a></div>
<div class="line">  <a id="2563" class="Symbol">;</a> <a id="2565" href="/agda_html/Leios.Protocol.html#1082" class="Field">Ledger</a>      <a id="2577" class="Symbol">=</a> <a id="2579" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a></div>
<div class="line">  <a id="2584" class="Symbol">;</a> <a id="2586" href="/agda_html/Leios.Protocol.html#1112" class="Field">ToPropose</a>   <a id="2598" class="Symbol">=</a> <a id="2600" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a></div>
<div class="line">  <a id="2605" class="Symbol">;</a> <a id="2607" href="/agda_html/Leios.Protocol.html#1142" class="Field">IBs</a>         <a id="2619" class="Symbol">=</a> <a id="2621" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a></div>
<div class="line">  <a id="2626" class="Symbol">;</a> <a id="2628" href="/agda_html/Leios.Protocol.html#1180" class="Field">EBs</a>         <a id="2640" class="Symbol">=</a> <a id="2642" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a></div>
<div class="line">  <a id="2647" class="Symbol">;</a> <a id="2649" href="/agda_html/Leios.Protocol.html#1221" class="Field">Vs</a>          <a id="2661" class="Symbol">=</a> <a id="2663" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a></div>
<div class="line">  <a id="2668" class="Symbol">;</a> <a id="2670" href="/agda_html/Leios.Protocol.html#1260" class="Field">slot</a>        <a id="2682" class="Symbol">=</a> <a id="2684" href="/agda_html/Leios.Base.html#463" class="Function">initSlot</a> <a id="2693" href="/agda_html/Leios.Protocol.html#2464" class="Bound">V</a></div>
<div class="line">  <a id="2697" class="Symbol">;</a> <a id="2699" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a>   <a id="2711" class="Symbol">=</a> <a id="2713" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a></div>
<div class="line">  <a id="2718" class="Symbol">;</a> <a id="2720" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a>    <a id="2732" class="Symbol">=</a> <a id="2734" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a></div>
<div class="line">  <a id="2739" class="Symbol">;</a> <a id="2741" href="/agda_html/Leios.Protocol.html#1354" class="Field">Upkeep</a>      <a id="2753" class="Symbol">=</a> <a id="2755" href="/agda_html/Class.HasEmptySet.html#287" class="Field">∅</a></div>
<div class="line">  <a id="2759" class="Symbol">;</a> <a id="2761" href="/agda_html/Leios.Protocol.html#1389" class="Field">BaseState</a>   <a id="2773" class="Symbol">=</a> <a id="2775" href="/agda_html/Leios.Protocol.html#2469" class="Bound">bs</a></div>
<div class="line">  <a id="2780" class="Symbol">;</a> <a id="2782" href="/agda_html/Leios.Protocol.html#1419" class="Field">votingState</a> <a id="2794" class="Symbol">=</a> <a id="2796" href="/agda_html/Leios.Voting.html#165" class="Function">initVotingState</a></div>
<div class="line">  <a id="2814" class="Symbol">;</a> <a id="2816" href="/agda_html/Leios.Protocol.html#1453" class="Field">PubKeys</a>     <a id="2828" class="Symbol">=</a> <a id="2830" href="/agda_html/Leios.Protocol.html#2472" class="Bound">pks</a></div>
<div class="line">  <a id="2836" class="Symbol">}</a></div>
<div class="line"></div>
<div class="line"><a id="stake&#39;"></a><a id="2839" href="/agda_html/Leios.Protocol.html#2839" class="Function">stake&#39;</a> <a id="2846" class="Symbol">:</a> <a id="2848" href="/agda_html/Leios.Abstract.html#174" class="Function">PoolID</a> <a id="2855" class="Symbol">→</a> <a id="2857" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="2868" class="Symbol">→</a> <a id="2870" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a></div>
<div class="line"><a id="2872" href="/agda_html/Leios.Protocol.html#2839" class="Function">stake&#39;</a> <a id="2879" href="/agda_html/Leios.Protocol.html#2879" class="Bound">pid</a> <a id="2883" class="Keyword">record</a> <a id="2890" class="Symbol">{</a> <a id="2892" href="/agda_html/Leios.Protocol.html#1017" class="Field">SD</a> <a id="2895" class="Symbol">=</a> <a id="2897" href="/agda_html/Leios.Protocol.html#2897" class="Bound">SD</a> <a id="2900" class="Symbol">}</a> <a id="2902" class="Symbol">=</a> <a id="2904" href="/agda_html/Axiom.Set.TotalMap.html#779" class="Function">TotalMap.lookup</a> <a id="2920" href="/agda_html/Leios.Protocol.html#2897" class="Bound">SD</a> <a id="2923" href="/agda_html/Leios.Protocol.html#2879" class="Bound">pid</a></div>
<div class="line"></div>
<div class="line"><a id="stake&#39;&#39;"></a><a id="2928" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="2936" class="Symbol">:</a> <a id="2938" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a> <a id="2945" class="Symbol">→</a> <a id="2947" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="2958" class="Symbol">→</a> <a id="2960" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a></div>
<div class="line"><a id="2962" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="2970" href="/agda_html/Leios.Protocol.html#2970" class="Bound">pk</a> <a id="2973" class="Symbol">=</a> <a id="2975" href="/agda_html/Leios.Protocol.html#2839" class="Function">stake&#39;</a> <a id="2982" class="Symbol">(</a><a id="2983" href="/agda_html/Leios.VRF.html#502" class="Function">poolID</a> <a id="2990" href="/agda_html/Leios.Protocol.html#2970" class="Bound">pk</a><a id="2992" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line"><a id="stake"></a><a id="2995" href="/agda_html/Leios.Protocol.html#2995" class="Function">stake</a> <a id="3001" class="Symbol">:</a> <a id="3003" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="3014" class="Symbol">→</a> <a id="3016" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a></div>
<div class="line"><a id="3018" href="/agda_html/Leios.Protocol.html#2995" class="Function">stake</a> <a id="3024" class="Symbol">=</a> <a id="3026" href="/agda_html/Leios.Protocol.html#2839" class="Function">stake&#39;</a> <a id="3033" href="/agda_html/Leios.SpecStructure.html#601" class="Field">id</a></div>
<div class="line"></div>
<div class="line"><a id="lookupPubKeyAndStake"></a><a id="3037" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="3058" class="Symbol">:</a> <a id="3060" class="Symbol">∀</a> <a id="3062" class="Symbol">{</a><a id="3063" href="/agda_html/Leios.Protocol.html#3063" class="Bound">B</a><a id="3064" class="Symbol">}</a> <a id="3066" class="Symbol">→</a> <a id="3068" class="Symbol">⦃</a> <a id="3070" href="/agda_html/Leios.Protocol.html#3070" class="Bound">_</a> <a id="3072" class="Symbol">:</a> <a id="3074" href="/agda_html/Leios.Blocks.html#357" class="Record">IsBlock</a> <a id="3082" href="/agda_html/Leios.Protocol.html#3063" class="Bound">B</a> <a id="3084" class="Symbol">⦄</a> <a id="3086" class="Symbol">→</a> <a id="3088" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="3099" class="Symbol">→</a> <a id="3101" href="/agda_html/Leios.Protocol.html#3063" class="Bound">B</a> <a id="3103" class="Symbol">→</a> <a id="3105" href="/agda_html/Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="3111" class="Symbol">(</a><a id="3112" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a> <a id="3119" href="/agda_html/Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3121" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3122" class="Symbol">)</a></div>
<div class="line"><a id="3124" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="3145" href="/agda_html/Leios.Protocol.html#3145" class="Bound">s</a> <a id="3147" href="/agda_html/Leios.Protocol.html#3147" class="Bound">b</a> <a id="3149" class="Symbol">=</a></div>
<div class="line">  <a id="3153" href="/agda_html/Data.List.Base.html#8441" class="Function">L.head</a> <a id="3160" href="/agda_html/Function.Base.html#1974" class="Function Operator">$</a></div>
<div class="line">    <a id="3166" href="/agda_html/Data.List.Base.html#1634" class="Function">L.map</a> <a id="3172" class="Symbol">(λ</a> <a id="3175" href="/agda_html/Leios.Protocol.html#3175" class="Bound">pk</a> <a id="3178" class="Symbol">→</a> <a id="3180" class="Symbol">(</a><a id="3181" href="/agda_html/Leios.Protocol.html#3175" class="Bound">pk</a> <a id="3184" href="/agda_html/Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="3186" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="3194" href="/agda_html/Leios.Protocol.html#3175" class="Bound">pk</a> <a id="3197" href="/agda_html/Leios.Protocol.html#3145" class="Bound">s</a><a id="3198" class="Symbol">))</a> <a id="3201" href="/agda_html/Function.Base.html#1974" class="Function Operator">$</a></div>
<div class="line">      <a id="3209" href="/agda_html/Data.List.Base.html#10687" class="Function">L.filter</a> <a id="3218" class="Symbol">(λ</a> <a id="3221" href="/agda_html/Leios.Protocol.html#3221" class="Bound">pk</a> <a id="3224" class="Symbol">→</a> <a id="3226" href="/agda_html/Leios.Blocks.html#424" class="Field">producerID</a> <a id="3237" href="/agda_html/Leios.Protocol.html#3147" class="Bound">b</a> <a id="3239" href="/agda_html/Class.DecEq.Core.html#159" class="Field Operator">≟</a> <a id="3241" href="/agda_html/Leios.VRF.html#502" class="Function">poolID</a> <a id="3248" href="/agda_html/Leios.Protocol.html#3221" class="Bound">pk</a><a id="3250" class="Symbol">)</a> <a id="3252" class="Symbol">(</a><a id="3253" href="/agda_html/Leios.Protocol.html#1453" class="Field">LeiosState.PubKeys</a> <a id="3272" href="/agda_html/Leios.Protocol.html#3145" class="Bound">s</a><a id="3273" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line"><a id="3276" class="Keyword">module</a> <a id="3283" href="/agda_html/Leios.Protocol.html#3283" class="Module">_</a> <a id="3285" class="Symbol">(</a><a id="3286" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a> <a id="3288" class="Symbol">:</a> <a id="3290" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a><a id="3300" class="Symbol">)</a>  <a id="3303" class="Keyword">where</a></div>
<div class="line"></div>
<div class="line">  <a id="3312" class="Keyword">record</a> <a id="3319" href="/agda_html/Leios.Protocol.html#3319" class="Record">ibHeaderValid</a> <a id="3333" class="Symbol">(</a><a id="3334" href="/agda_html/Leios.Protocol.html#3334" class="Bound">h</a> <a id="3336" class="Symbol">:</a> <a id="3338" href="/agda_html/Leios.Blocks.html#987" class="Function">IBHeader</a><a id="3346" class="Symbol">)</a> <a id="3348" class="Symbol">(</a><a id="3349" href="/agda_html/Leios.Protocol.html#3349" class="Bound">pk</a> <a id="3352" class="Symbol">:</a> <a id="3354" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a><a id="3360" class="Symbol">)</a> <a id="3362" class="Symbol">(</a><a id="3363" href="/agda_html/Leios.Protocol.html#3363" class="Bound">st</a> <a id="3366" class="Symbol">:</a> <a id="3368" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3369" class="Symbol">)</a> <a id="3371" class="Symbol">:</a> <a id="3373" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3378" class="Keyword">where</a></div>
<div class="line">    <a id="3388" class="Keyword">field</a> <a id="3394" href="/agda_html/Leios.Protocol.html#3394" class="Field">lotteryPfValid</a> <a id="3409" class="Symbol">:</a> <a id="3411" href="/agda_html/Leios.VRF.html#298" class="Function">verify</a> <a id="3418" href="/agda_html/Leios.Protocol.html#3349" class="Bound">pk</a> <a id="3421" class="Symbol">(</a><a id="3422" href="/agda_html/Leios.Blocks.html#397" class="Field">slotNumber</a> <a id="3433" href="/agda_html/Leios.Protocol.html#3334" class="Bound">h</a><a id="3434" class="Symbol">)</a> <a id="3436" href="/agda_html/Leios.Protocol.html#3363" class="Bound">st</a> <a id="3439" class="Symbol">(</a><a id="3440" href="/agda_html/Leios.Blocks.html#456" class="Field">lotteryPf</a> <a id="3450" href="/agda_html/Leios.Protocol.html#3334" class="Bound">h</a><a id="3451" class="Symbol">)</a></div>
<div class="line">          <a id="3463" href="/agda_html/Leios.Protocol.html#3463" class="Field">signatureValid</a> <a id="3478" class="Symbol">:</a> <a id="3480" href="/agda_html/Leios.VRF.html#535" class="Function">verifySig</a> <a id="3490" href="/agda_html/Leios.Protocol.html#3349" class="Bound">pk</a> <a id="3493" class="Symbol">(</a><a id="3494" href="/agda_html/Leios.Blocks.html#487" class="Field">signature</a> <a id="3504" href="/agda_html/Leios.Protocol.html#3334" class="Bound">h</a><a id="3505" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line">  <a id="3510" class="Keyword">record</a> <a id="3517" href="/agda_html/Leios.Protocol.html#3517" class="Record">ibBodyValid</a> <a id="3529" class="Symbol">(</a><a id="3530" href="/agda_html/Leios.Protocol.html#3530" class="Bound">b</a> <a id="3532" class="Symbol">:</a> <a id="3534" href="/agda_html/Leios.Blocks.html#1055" class="Record">IBBody</a><a id="3540" class="Symbol">)</a> <a id="3542" class="Symbol">:</a> <a id="3544" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a> <a id="3549" class="Keyword">where</a></div>
<div class="line"></div>
<div class="line">  <a id="3558" href="/agda_html/Leios.Protocol.html#3558" class="Function">ibHeaderValid?</a> <a id="3573" class="Symbol">:</a> <a id="3575" class="Symbol">(</a><a id="3576" href="/agda_html/Leios.Protocol.html#3576" class="Bound">h</a> <a id="3578" class="Symbol">:</a> <a id="3580" href="/agda_html/Leios.Blocks.html#987" class="Function">IBHeader</a><a id="3588" class="Symbol">)</a> <a id="3590" class="Symbol">(</a><a id="3591" href="/agda_html/Leios.Protocol.html#3591" class="Bound">pk</a> <a id="3594" class="Symbol">:</a> <a id="3596" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a><a id="3602" class="Symbol">)</a> <a id="3604" class="Symbol">(</a><a id="3605" href="/agda_html/Leios.Protocol.html#3605" class="Bound">st</a> <a id="3608" class="Symbol">:</a> <a id="3610" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="3611" class="Symbol">)</a> <a id="3613" class="Symbol">→</a> <a id="3615" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="3619" class="Symbol">(</a><a id="3620" href="/agda_html/Leios.Protocol.html#3319" class="Record">ibHeaderValid</a> <a id="3634" href="/agda_html/Leios.Protocol.html#3576" class="Bound">h</a> <a id="3636" href="/agda_html/Leios.Protocol.html#3591" class="Bound">pk</a> <a id="3639" href="/agda_html/Leios.Protocol.html#3605" class="Bound">st</a><a id="3641" class="Symbol">)</a></div>
<div class="line">  <a id="3645" href="/agda_html/Leios.Protocol.html#3558" class="Function">ibHeaderValid?</a> <a id="3660" href="/agda_html/Leios.Protocol.html#3660" class="Bound">h</a> <a id="3662" href="/agda_html/Leios.Protocol.html#3662" class="Bound">pk</a> <a id="3665" href="/agda_html/Leios.Protocol.html#3665" class="Bound">st</a></div>
<div class="line">    <a id="3672" class="Keyword">with</a> <a id="3677" href="/agda_html/Leios.VRF.html#351" class="Function">verify?</a> <a id="3685" href="/agda_html/Leios.Protocol.html#3662" class="Bound">pk</a> <a id="3688" class="Symbol">(</a><a id="3689" href="/agda_html/Leios.Blocks.html#397" class="Field">slotNumber</a> <a id="3700" href="/agda_html/Leios.Protocol.html#3660" class="Bound">h</a><a id="3701" class="Symbol">)</a> <a id="3703" href="/agda_html/Leios.Protocol.html#3665" class="Bound">st</a> <a id="3706" class="Symbol">(</a><a id="3707" href="/agda_html/Leios.Blocks.html#456" class="Field">lotteryPf</a> <a id="3717" href="/agda_html/Leios.Protocol.html#3660" class="Bound">h</a><a id="3718" class="Symbol">)</a></div>
<div class="line">  <a id="3722" class="Symbol">...</a> <a id="3726" class="Symbol">|</a> <a id="3728" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="3731" href="/agda_html/Leios.Protocol.html#3731" class="Bound">¬p</a> <a id="3734" class="Symbol">=</a> <a id="3736" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="3739" class="Symbol">(</a><a id="3740" href="/agda_html/Leios.Protocol.html#3731" class="Bound">¬p</a> <a id="3743" href="/agda_html/Function.Base.html#1115" class="Function Operator">∘</a> <a id="3745" href="/agda_html/Leios.Protocol.html#3394" class="Field">ibHeaderValid.lotteryPfValid</a><a id="3773" class="Symbol">)</a></div>
<div class="line">  <a id="3777" class="Symbol">...</a> <a id="3781" class="Symbol">|</a> <a id="3783" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="3787" href="/agda_html/Leios.Protocol.html#3787" class="Bound">p</a></div>
<div class="line">    <a id="3793" class="Keyword">with</a> <a id="3798" href="/agda_html/Leios.VRF.html#575" class="Function">verifySig?</a> <a id="3809" class="Bound">pk</a> <a id="3812" class="Symbol">(</a><a id="3813" href="/agda_html/Leios.Blocks.html#487" class="Field">signature</a> <a id="3823" class="Bound">h</a><a id="3824" class="Symbol">)</a></div>
<div class="line">  <a id="3828" class="Symbol">...</a> <a id="3832" class="Symbol">|</a> <a id="3834" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="3838" href="/agda_html/Leios.Protocol.html#3838" class="Bound">q</a> <a id="3840" class="Symbol">=</a> <a id="3842" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="3846" class="Symbol">(</a><a id="3847" class="Keyword">record</a> <a id="3854" class="Symbol">{</a> <a id="3856" href="/agda_html/Leios.Protocol.html#3394" class="Field">lotteryPfValid</a> <a id="3871" class="Symbol">=</a> <a id="3873" class="Bound">p</a> <a id="3875" class="Symbol">;</a> <a id="3877" href="/agda_html/Leios.Protocol.html#3463" class="Field">signatureValid</a> <a id="3892" class="Symbol">=</a> <a id="3894" href="/agda_html/Leios.Protocol.html#3838" class="Bound">q</a> <a id="3896" class="Symbol">})</a></div>
<div class="line">  <a id="3901" class="Symbol">...</a> <a id="3905" class="Symbol">|</a> <a id="3907" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="3910" href="/agda_html/Leios.Protocol.html#3910" class="Bound">¬q</a> <a id="3913" class="Symbol">=</a> <a id="3915" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="3918" class="Symbol">(</a><a id="3919" href="/agda_html/Leios.Protocol.html#3910" class="Bound">¬q</a> <a id="3922" href="/agda_html/Function.Base.html#1115" class="Function Operator">∘</a> <a id="3924" href="/agda_html/Leios.Protocol.html#3463" class="Field">ibHeaderValid.signatureValid</a><a id="3952" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line">  <a id="3957" href="/agda_html/Leios.Protocol.html#3957" class="Function">ibBodyValid?</a> <a id="3970" class="Symbol">:</a> <a id="3972" class="Symbol">(</a><a id="3973" href="/agda_html/Leios.Protocol.html#3973" class="Bound">b</a> <a id="3975" class="Symbol">:</a> <a id="3977" href="/agda_html/Leios.Blocks.html#1055" class="Record">IBBody</a><a id="3983" class="Symbol">)</a> <a id="3985" class="Symbol">→</a> <a id="3987" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="3991" class="Symbol">(</a><a id="3992" href="/agda_html/Leios.Protocol.html#3517" class="Record">ibBodyValid</a> <a id="4004" href="/agda_html/Leios.Protocol.html#3973" class="Bound">b</a><a id="4005" class="Symbol">)</a></div>
<div class="line">  <a id="4009" href="/agda_html/Leios.Protocol.html#3957" class="Function">ibBodyValid?</a> <a id="4022" class="Symbol">_</a> <a id="4024" class="Symbol">=</a> <a id="4026" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="4030" class="Keyword">record</a> <a id="4037" class="Symbol">{}</a></div>
<div class="line"></div>
<div class="line">  <a id="4043" href="/agda_html/Leios.Protocol.html#4043" class="Function">ibValid</a> <a id="4051" class="Symbol">:</a> <a id="4053" href="/agda_html/Leios.Blocks.html#1105" class="Record">InputBlock</a> <a id="4064" class="Symbol">→</a> <a id="4066" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a></div>
<div class="line">  <a id="4073" href="/agda_html/Leios.Protocol.html#4043" class="Function">ibValid</a> <a id="4081" class="Keyword">record</a> <a id="4088" class="Symbol">{</a> <a id="4090" href="/agda_html/Leios.Blocks.html#1137" class="Field">header</a> <a id="4097" class="Symbol">=</a> <a id="4099" href="/agda_html/Leios.Protocol.html#4099" class="Bound">h</a> <a id="4101" class="Symbol">;</a> <a id="4103" href="/agda_html/Leios.Blocks.html#1163" class="Field">body</a> <a id="4108" class="Symbol">=</a> <a id="4110" href="/agda_html/Leios.Protocol.html#4110" class="Bound">b</a> <a id="4112" class="Symbol">}</a></div>
<div class="line">    <a id="4118" class="Keyword">with</a> <a id="4123" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="4144" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a> <a id="4146" href="/agda_html/Leios.Protocol.html#4099" class="Bound">h</a></div>
<div class="line">  <a id="4150" class="Symbol">...</a> <a id="4154" class="Symbol">|</a> <a id="4156" href="/agda_html/Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4161" class="Symbol">(</a><a id="4162" href="/agda_html/Leios.Protocol.html#4162" class="Bound">pk</a> <a id="4165" href="/agda_html/Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4167" href="/agda_html/Leios.Protocol.html#4167" class="Bound">pid</a><a id="4170" class="Symbol">)</a> <a id="4172" class="Symbol">=</a> <a id="4174" href="/agda_html/Leios.Protocol.html#3319" class="Record">ibHeaderValid</a> <a id="4188" class="Bound">h</a> <a id="4190" href="/agda_html/Leios.Protocol.html#4162" class="Bound">pk</a> <a id="4193" class="Symbol">(</a><a id="4194" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="4202" href="/agda_html/Leios.Protocol.html#4162" class="Bound">pk</a> <a id="4205" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a><a id="4206" class="Symbol">)</a> <a id="4208" href="/agda_html/Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="4210" href="/agda_html/Leios.Protocol.html#3517" class="Record">ibBodyValid</a> <a id="4222" class="Bound">b</a></div>
<div class="line">  <a id="4226" class="Symbol">...</a> <a id="4230" class="Symbol">|</a> <a id="4232" href="/agda_html/Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="4240" class="Symbol">=</a> <a id="4242" href="/agda_html/Data.Empty.html#914" class="Function">⊥</a></div>
<div class="line"></div>
<div class="line">  <a id="4247" href="/agda_html/Leios.Protocol.html#4247" class="Function">ibValid?</a> <a id="4256" class="Symbol">:</a> <a id="4258" class="Symbol">(</a><a id="4259" href="/agda_html/Leios.Protocol.html#4259" class="Bound">ib</a> <a id="4262" class="Symbol">:</a> <a id="4264" href="/agda_html/Leios.Blocks.html#1105" class="Record">InputBlock</a><a id="4274" class="Symbol">)</a> <a id="4276" class="Symbol">→</a> <a id="4278" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="4282" class="Symbol">(</a><a id="4283" href="/agda_html/Leios.Protocol.html#4043" class="Function">ibValid</a> <a id="4291" href="/agda_html/Leios.Protocol.html#4259" class="Bound">ib</a><a id="4293" class="Symbol">)</a></div>
<div class="line">  <a id="4297" href="/agda_html/Leios.Protocol.html#4247" class="Function">ibValid?</a> <a id="4306" class="Keyword">record</a> <a id="4313" class="Symbol">{</a> <a id="4315" href="/agda_html/Leios.Blocks.html#1137" class="Field">header</a> <a id="4322" class="Symbol">=</a> <a id="4324" href="/agda_html/Leios.Protocol.html#4324" class="Bound">h</a> <a id="4326" class="Symbol">;</a> <a id="4328" href="/agda_html/Leios.Blocks.html#1163" class="Field">body</a> <a id="4333" class="Symbol">=</a> <a id="4335" href="/agda_html/Leios.Protocol.html#4335" class="Bound">b</a> <a id="4337" class="Symbol">}</a></div>
<div class="line">    <a id="4343" class="Keyword">with</a> <a id="4348" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="4369" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a> <a id="4371" href="/agda_html/Leios.Protocol.html#4324" class="Bound">h</a></div>
<div class="line">  <a id="4375" class="Symbol">...</a> <a id="4379" class="Symbol">|</a> <a id="4381" href="/agda_html/Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="4386" class="Symbol">(</a><a id="4387" href="/agda_html/Leios.Protocol.html#4387" class="Bound">pk</a> <a id="4390" href="/agda_html/Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="4392" href="/agda_html/Leios.Protocol.html#4392" class="Bound">pid</a><a id="4395" class="Symbol">)</a> <a id="4397" class="Symbol">=</a> <a id="4399" href="/agda_html/Leios.Protocol.html#3558" class="Function">ibHeaderValid?</a> <a id="4414" class="Bound">h</a> <a id="4416" href="/agda_html/Leios.Protocol.html#4387" class="Bound">pk</a> <a id="4419" class="Symbol">(</a><a id="4420" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="4428" href="/agda_html/Leios.Protocol.html#4387" class="Bound">pk</a> <a id="4431" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a><a id="4432" class="Symbol">)</a> <a id="4434" href="/agda_html/Relation.Nullary.Decidable.Core.html#3103" class="Function Operator">×-dec</a> <a id="4440" href="/agda_html/Leios.Protocol.html#3957" class="Function">ibBodyValid?</a> <a id="4453" class="Bound">b</a></div>
<div class="line">  <a id="4457" class="Symbol">...</a> <a id="4461" class="Symbol">|</a> <a id="4463" href="/agda_html/Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="4471" class="Symbol">=</a> <a id="4473" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="4476" class="Symbol">λ</a> <a id="4478" href="/agda_html/Leios.Protocol.html#4478" class="Bound">x</a> <a id="4480" class="Symbol">→</a> <a id="4482" href="/agda_html/Leios.Protocol.html#4478" class="Bound">x</a></div>
<div class="line"></div>
<div class="line">  <a id="4487" class="Keyword">record</a> <a id="4494" href="/agda_html/Leios.Protocol.html#4494" class="Record">ebValid</a> <a id="4502" class="Symbol">(</a><a id="4503" href="/agda_html/Leios.Protocol.html#4503" class="Bound">eb</a> <a id="4506" class="Symbol">:</a> <a id="4508" href="/agda_html/Leios.Blocks.html#2804" class="Function">EndorserBlock</a><a id="4521" class="Symbol">)</a> <a id="4523" class="Symbol">(</a><a id="4524" href="/agda_html/Leios.Protocol.html#4524" class="Bound">pk</a> <a id="4527" class="Symbol">:</a> <a id="4529" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a><a id="4535" class="Symbol">)</a> <a id="4537" class="Symbol">(</a><a id="4538" href="/agda_html/Leios.Protocol.html#4538" class="Bound">st</a> <a id="4541" class="Symbol">:</a> <a id="4543" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="4544" class="Symbol">)</a> <a id="4546" class="Symbol">:</a> <a id="4548" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a> <a id="4553" class="Keyword">where</a></div>
<div class="line">    <a id="4563" class="Keyword">field</a> <a id="4569" href="/agda_html/Leios.Protocol.html#4569" class="Field">lotteryPfValid</a> <a id="4584" class="Symbol">:</a> <a id="4586" href="/agda_html/Leios.VRF.html#298" class="Function">verify</a> <a id="4593" href="/agda_html/Leios.Protocol.html#4524" class="Bound">pk</a> <a id="4596" class="Symbol">(</a><a id="4597" href="/agda_html/Leios.Blocks.html#397" class="Field">slotNumber</a> <a id="4608" href="/agda_html/Leios.Protocol.html#4503" class="Bound">eb</a><a id="4610" class="Symbol">)</a> <a id="4612" href="/agda_html/Leios.Protocol.html#4538" class="Bound">st</a> <a id="4615" class="Symbol">(</a><a id="4616" href="/agda_html/Leios.Blocks.html#456" class="Field">lotteryPf</a> <a id="4626" href="/agda_html/Leios.Protocol.html#4503" class="Bound">eb</a><a id="4628" class="Symbol">)</a></div>
<div class="line">          <a id="4640" href="/agda_html/Leios.Protocol.html#4640" class="Field">signatureValid</a> <a id="4655" class="Symbol">:</a> <a id="4657" href="/agda_html/Leios.VRF.html#535" class="Function">verifySig</a> <a id="4667" href="/agda_html/Leios.Protocol.html#4524" class="Bound">pk</a> <a id="4670" class="Symbol">(</a><a id="4671" href="/agda_html/Leios.Blocks.html#487" class="Field">signature</a> <a id="4681" href="/agda_html/Leios.Protocol.html#4503" class="Bound">eb</a><a id="4683" class="Symbol">)</a></div>
<div class="line">    <a id="4689" class="Comment">-- TODO</a></div>
<div class="line">    <a id="4701" class="Comment">-- ibRefsValid : ?</a></div>
<div class="line">    <a id="4724" class="Comment">-- ebRefsValid : ?</a></div>
<div class="line"></div>
<div class="line">  <a id="4746" href="/agda_html/Leios.Protocol.html#4746" class="Function">ebValid?</a> <a id="4755" class="Symbol">:</a> <a id="4757" class="Symbol">(</a><a id="4758" href="/agda_html/Leios.Protocol.html#4758" class="Bound">eb</a> <a id="4761" class="Symbol">:</a> <a id="4763" href="/agda_html/Leios.Blocks.html#2804" class="Function">EndorserBlock</a><a id="4776" class="Symbol">)</a> <a id="4778" class="Symbol">(</a><a id="4779" href="/agda_html/Leios.Protocol.html#4779" class="Bound">pk</a> <a id="4782" class="Symbol">:</a> <a id="4784" href="/agda_html/Leios.VRF.html#480" class="Function">PubKey</a><a id="4790" class="Symbol">)</a> <a id="4792" class="Symbol">(</a><a id="4793" href="/agda_html/Leios.Protocol.html#4793" class="Bound">st</a> <a id="4796" class="Symbol">:</a> <a id="4798" href="/agda_html/Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a><a id="4799" class="Symbol">)</a> <a id="4801" class="Symbol">→</a> <a id="4803" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="4807" class="Symbol">(</a><a id="4808" href="/agda_html/Leios.Protocol.html#4494" class="Record">ebValid</a> <a id="4816" href="/agda_html/Leios.Protocol.html#4758" class="Bound">eb</a> <a id="4819" href="/agda_html/Leios.Protocol.html#4779" class="Bound">pk</a> <a id="4822" href="/agda_html/Leios.Protocol.html#4793" class="Bound">st</a><a id="4824" class="Symbol">)</a></div>
<div class="line">  <a id="4828" href="/agda_html/Leios.Protocol.html#4746" class="Function">ebValid?</a> <a id="4837" href="/agda_html/Leios.Protocol.html#4837" class="Bound">h</a> <a id="4839" href="/agda_html/Leios.Protocol.html#4839" class="Bound">pk</a> <a id="4842" href="/agda_html/Leios.Protocol.html#4842" class="Bound">st</a></div>
<div class="line">    <a id="4849" class="Keyword">with</a> <a id="4854" href="/agda_html/Leios.VRF.html#351" class="Function">verify?</a> <a id="4862" href="/agda_html/Leios.Protocol.html#4839" class="Bound">pk</a> <a id="4865" class="Symbol">(</a><a id="4866" href="/agda_html/Leios.Blocks.html#397" class="Field">slotNumber</a> <a id="4877" href="/agda_html/Leios.Protocol.html#4837" class="Bound">h</a><a id="4878" class="Symbol">)</a> <a id="4880" href="/agda_html/Leios.Protocol.html#4842" class="Bound">st</a> <a id="4883" class="Symbol">(</a><a id="4884" href="/agda_html/Leios.Blocks.html#456" class="Field">lotteryPf</a> <a id="4894" href="/agda_html/Leios.Protocol.html#4837" class="Bound">h</a><a id="4895" class="Symbol">)</a></div>
<div class="line">  <a id="4899" class="Symbol">...</a> <a id="4903" class="Symbol">|</a> <a id="4905" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="4908" href="/agda_html/Leios.Protocol.html#4908" class="Bound">¬p</a> <a id="4911" class="Symbol">=</a> <a id="4913" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="4916" class="Symbol">(</a><a id="4917" href="/agda_html/Leios.Protocol.html#4908" class="Bound">¬p</a> <a id="4920" href="/agda_html/Function.Base.html#1115" class="Function Operator">∘</a> <a id="4922" href="/agda_html/Leios.Protocol.html#4569" class="Field">ebValid.lotteryPfValid</a><a id="4944" class="Symbol">)</a></div>
<div class="line">  <a id="4948" class="Symbol">...</a> <a id="4952" class="Symbol">|</a> <a id="4954" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="4958" href="/agda_html/Leios.Protocol.html#4958" class="Bound">p</a></div>
<div class="line">    <a id="4964" class="Keyword">with</a> <a id="4969" href="/agda_html/Leios.VRF.html#575" class="Function">verifySig?</a> <a id="4980" class="Bound">pk</a> <a id="4983" class="Symbol">(</a><a id="4984" href="/agda_html/Leios.Blocks.html#487" class="Field">signature</a> <a id="4994" class="Bound">h</a><a id="4995" class="Symbol">)</a></div>
<div class="line">  <a id="4999" class="Symbol">...</a> <a id="5003" class="Symbol">|</a> <a id="5005" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="5009" href="/agda_html/Leios.Protocol.html#5009" class="Bound">q</a> <a id="5011" class="Symbol">=</a> <a id="5013" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="5017" class="Symbol">(</a><a id="5018" class="Keyword">record</a> <a id="5025" class="Symbol">{</a> <a id="5027" href="/agda_html/Leios.Protocol.html#4569" class="Field">lotteryPfValid</a> <a id="5042" class="Symbol">=</a> <a id="5044" class="Bound">p</a> <a id="5046" class="Symbol">;</a> <a id="5048" href="/agda_html/Leios.Protocol.html#4640" class="Field">signatureValid</a> <a id="5063" class="Symbol">=</a> <a id="5065" href="/agda_html/Leios.Protocol.html#5009" class="Bound">q</a> <a id="5067" class="Symbol">})</a></div>
<div class="line">  <a id="5072" class="Symbol">...</a> <a id="5076" class="Symbol">|</a> <a id="5078" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="5081" href="/agda_html/Leios.Protocol.html#5081" class="Bound">¬q</a> <a id="5084" class="Symbol">=</a> <a id="5086" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="5089" class="Symbol">(</a><a id="5090" href="/agda_html/Leios.Protocol.html#5081" class="Bound">¬q</a> <a id="5093" href="/agda_html/Function.Base.html#1115" class="Function Operator">∘</a> <a id="5095" href="/agda_html/Leios.Protocol.html#4640" class="Field">ebValid.signatureValid</a><a id="5117" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line">  <a id="5122" class="Comment">-- TODO</a></div>
<div class="line">  <a id="5132" class="Keyword">record</a> <a id="5139" href="/agda_html/Leios.Protocol.html#5139" class="Record">vsValid</a> <a id="5147" class="Symbol">(</a><a id="5148" href="/agda_html/Leios.Protocol.html#5148" class="Bound">vs</a> <a id="5151" class="Symbol">:</a> <a id="5153" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5158" href="/agda_html/Leios.Abstract.html#448" class="Function">Vote</a><a id="5162" class="Symbol">)</a> <a id="5164" class="Symbol">:</a> <a id="5166" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5171" class="Keyword">where</a></div>
<div class="line"></div>
<div class="line">  <a id="5180" href="/agda_html/Leios.Protocol.html#5180" class="Function">vsValid?</a> <a id="5189" class="Symbol">:</a> <a id="5191" class="Symbol">(</a><a id="5192" href="/agda_html/Leios.Protocol.html#5192" class="Bound">vs</a> <a id="5195" class="Symbol">:</a> <a id="5197" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="5202" href="/agda_html/Leios.Abstract.html#448" class="Function">Vote</a><a id="5206" class="Symbol">)</a> <a id="5208" class="Symbol">→</a> <a id="5210" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="5214" class="Symbol">(</a><a id="5215" href="/agda_html/Leios.Protocol.html#5139" class="Record">vsValid</a> <a id="5223" href="/agda_html/Leios.Protocol.html#5192" class="Bound">vs</a><a id="5225" class="Symbol">)</a></div>
<div class="line">  <a id="5229" href="/agda_html/Leios.Protocol.html#5180" class="Function">vsValid?</a> <a id="5238" class="Symbol">_</a> <a id="5240" class="Symbol">=</a> <a id="5242" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="5246" class="Keyword">record</a> <a id="5253" class="Symbol">{}</a></div>
<div class="line"></div>
<div class="line">  <a id="5259" href="/agda_html/Leios.Protocol.html#5259" class="Function">headerValid</a> <a id="5271" class="Symbol">:</a> <a id="5273" href="/agda_html/Leios.Blocks.html#4294" class="Datatype">Header</a> <a id="5280" class="Symbol">→</a> <a id="5282" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a></div>
<div class="line">  <a id="5289" href="/agda_html/Leios.Protocol.html#5259" class="Function">headerValid</a> <a id="5301" class="Symbol">(</a><a id="5302" href="/agda_html/Leios.Blocks.html#4318" class="InductiveConstructor">ibHeader</a> <a id="5311" href="/agda_html/Leios.Protocol.html#5311" class="Bound">h</a><a id="5312" class="Symbol">)</a></div>
<div class="line">    <a id="5318" class="Keyword">with</a> <a id="5323" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="5344" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a> <a id="5346" href="/agda_html/Leios.Protocol.html#5311" class="Bound">h</a></div>
<div class="line">  <a id="5350" class="Symbol">...</a> <a id="5354" class="Symbol">|</a> <a id="5356" href="/agda_html/Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5361" class="Symbol">(</a><a id="5362" href="/agda_html/Leios.Protocol.html#5362" class="Bound">pk</a> <a id="5365" href="/agda_html/Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5367" href="/agda_html/Leios.Protocol.html#5367" class="Bound">pid</a><a id="5370" class="Symbol">)</a> <a id="5372" class="Symbol">=</a> <a id="5374" href="/agda_html/Leios.Protocol.html#3319" class="Record">ibHeaderValid</a> <a id="5388" class="Bound">h</a> <a id="5390" href="/agda_html/Leios.Protocol.html#5362" class="Bound">pk</a> <a id="5393" class="Symbol">(</a><a id="5394" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="5402" href="/agda_html/Leios.Protocol.html#5362" class="Bound">pk</a> <a id="5405" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a><a id="5406" class="Symbol">)</a></div>
<div class="line">  <a id="5410" class="Symbol">...</a> <a id="5414" class="Symbol">|</a> <a id="5416" href="/agda_html/Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5424" class="Symbol">=</a> <a id="5426" href="/agda_html/Data.Empty.html#914" class="Function">⊥</a></div>
<div class="line">  <a id="5430" href="/agda_html/Leios.Protocol.html#5259" class="Function">headerValid</a> <a id="5442" class="Symbol">(</a><a id="5443" href="/agda_html/Leios.Blocks.html#4351" class="InductiveConstructor">ebHeader</a> <a id="5452" href="/agda_html/Leios.Protocol.html#5452" class="Bound">h</a><a id="5453" class="Symbol">)</a></div>
<div class="line">    <a id="5459" class="Keyword">with</a> <a id="5464" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="5485" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a> <a id="5487" href="/agda_html/Leios.Protocol.html#5452" class="Bound">h</a></div>
<div class="line">  <a id="5491" class="Symbol">...</a> <a id="5495" class="Symbol">|</a> <a id="5497" href="/agda_html/Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5502" class="Symbol">(</a><a id="5503" href="/agda_html/Leios.Protocol.html#5503" class="Bound">pk</a> <a id="5506" href="/agda_html/Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5508" href="/agda_html/Leios.Protocol.html#5508" class="Bound">pid</a><a id="5511" class="Symbol">)</a> <a id="5513" class="Symbol">=</a> <a id="5515" href="/agda_html/Leios.Protocol.html#4494" class="Record">ebValid</a> <a id="5523" class="Bound">h</a> <a id="5525" href="/agda_html/Leios.Protocol.html#5503" class="Bound">pk</a> <a id="5528" class="Symbol">(</a><a id="5529" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="5537" href="/agda_html/Leios.Protocol.html#5503" class="Bound">pk</a> <a id="5540" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a><a id="5541" class="Symbol">)</a></div>
<div class="line">  <a id="5545" class="Symbol">...</a> <a id="5549" class="Symbol">|</a> <a id="5551" href="/agda_html/Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5559" class="Symbol">=</a> <a id="5561" href="/agda_html/Data.Empty.html#914" class="Function">⊥</a></div>
<div class="line">  <a id="5565" href="/agda_html/Leios.Protocol.html#5259" class="Function">headerValid</a> <a id="5577" class="Symbol">(</a><a id="5578" href="/agda_html/Leios.Blocks.html#4389" class="InductiveConstructor">vtHeader</a> <a id="5587" href="/agda_html/Leios.Protocol.html#5587" class="Bound">h</a><a id="5588" class="Symbol">)</a> <a id="5590" class="Symbol">=</a> <a id="5592" href="/agda_html/Leios.Protocol.html#5139" class="Record">vsValid</a> <a id="5600" href="/agda_html/Leios.Protocol.html#5587" class="Bound">h</a></div>
<div class="line"></div>
<div class="line">  <a id="5605" href="/agda_html/Leios.Protocol.html#5605" class="Function">headerValid?</a> <a id="5618" class="Symbol">:</a> <a id="5620" class="Symbol">(</a><a id="5621" href="/agda_html/Leios.Protocol.html#5621" class="Bound">h</a> <a id="5623" class="Symbol">:</a> <a id="5625" href="/agda_html/Leios.Blocks.html#4294" class="Datatype">Header</a><a id="5631" class="Symbol">)</a> <a id="5633" class="Symbol">→</a> <a id="5635" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="5639" class="Symbol">(</a><a id="5640" href="/agda_html/Leios.Protocol.html#5259" class="Function">headerValid</a> <a id="5652" href="/agda_html/Leios.Protocol.html#5621" class="Bound">h</a><a id="5653" class="Symbol">)</a></div>
<div class="line">  <a id="5657" href="/agda_html/Leios.Protocol.html#5605" class="Function">headerValid?</a> <a id="5670" class="Symbol">(</a><a id="5671" href="/agda_html/Leios.Blocks.html#4318" class="InductiveConstructor">ibHeader</a> <a id="5680" href="/agda_html/Leios.Protocol.html#5680" class="Bound">h</a><a id="5681" class="Symbol">)</a></div>
<div class="line">    <a id="5687" class="Keyword">with</a> <a id="5692" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="5713" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a> <a id="5715" href="/agda_html/Leios.Protocol.html#5680" class="Bound">h</a></div>
<div class="line">  <a id="5719" class="Symbol">...</a> <a id="5723" class="Symbol">|</a> <a id="5725" href="/agda_html/Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5730" class="Symbol">(</a><a id="5731" href="/agda_html/Leios.Protocol.html#5731" class="Bound">pk</a> <a id="5734" href="/agda_html/Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5736" href="/agda_html/Leios.Protocol.html#5736" class="Bound">pid</a><a id="5739" class="Symbol">)</a> <a id="5741" class="Symbol">=</a> <a id="5743" href="/agda_html/Leios.Protocol.html#3558" class="Function">ibHeaderValid?</a> <a id="5758" class="Bound">h</a> <a id="5760" href="/agda_html/Leios.Protocol.html#5731" class="Bound">pk</a> <a id="5763" class="Symbol">(</a><a id="5764" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="5772" href="/agda_html/Leios.Protocol.html#5731" class="Bound">pk</a> <a id="5775" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a><a id="5776" class="Symbol">)</a></div>
<div class="line">  <a id="5780" class="Symbol">...</a> <a id="5784" class="Symbol">|</a> <a id="5786" href="/agda_html/Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5794" class="Symbol">=</a> <a id="5796" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="5799" class="Symbol">λ</a> <a id="5801" href="/agda_html/Leios.Protocol.html#5801" class="Bound">x</a> <a id="5803" class="Symbol">→</a> <a id="5805" href="/agda_html/Leios.Protocol.html#5801" class="Bound">x</a></div>
<div class="line">  <a id="5809" href="/agda_html/Leios.Protocol.html#5605" class="Function">headerValid?</a> <a id="5822" class="Symbol">(</a><a id="5823" href="/agda_html/Leios.Blocks.html#4351" class="InductiveConstructor">ebHeader</a> <a id="5832" href="/agda_html/Leios.Protocol.html#5832" class="Bound">h</a><a id="5833" class="Symbol">)</a></div>
<div class="line">    <a id="5839" class="Keyword">with</a> <a id="5844" href="/agda_html/Leios.Protocol.html#3037" class="Function">lookupPubKeyAndStake</a> <a id="5865" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a> <a id="5867" href="/agda_html/Leios.Protocol.html#5832" class="Bound">h</a></div>
<div class="line">  <a id="5871" class="Symbol">...</a> <a id="5875" class="Symbol">|</a> <a id="5877" href="/agda_html/Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5882" class="Symbol">(</a><a id="5883" href="/agda_html/Leios.Protocol.html#5883" class="Bound">pk</a> <a id="5886" href="/agda_html/Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="5888" href="/agda_html/Leios.Protocol.html#5888" class="Bound">pid</a><a id="5891" class="Symbol">)</a> <a id="5893" class="Symbol">=</a> <a id="5895" href="/agda_html/Leios.Protocol.html#4746" class="Function">ebValid?</a> <a id="5904" class="Bound">h</a> <a id="5906" href="/agda_html/Leios.Protocol.html#5883" class="Bound">pk</a> <a id="5909" class="Symbol">(</a><a id="5910" href="/agda_html/Leios.Protocol.html#2928" class="Function">stake&#39;&#39;</a> <a id="5918" href="/agda_html/Leios.Protocol.html#5883" class="Bound">pk</a> <a id="5921" href="/agda_html/Leios.Protocol.html#3286" class="Bound">s</a><a id="5922" class="Symbol">)</a></div>
<div class="line">  <a id="5926" class="Symbol">...</a> <a id="5930" class="Symbol">|</a> <a id="5932" href="/agda_html/Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5940" class="Symbol">=</a> <a id="5942" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="5945" class="Symbol">λ</a> <a id="5947" href="/agda_html/Leios.Protocol.html#5947" class="Bound">x</a> <a id="5949" class="Symbol">→</a> <a id="5951" href="/agda_html/Leios.Protocol.html#5947" class="Bound">x</a></div>
<div class="line">  <a id="5955" href="/agda_html/Leios.Protocol.html#5605" class="Function">headerValid?</a> <a id="5968" class="Symbol">(</a><a id="5969" href="/agda_html/Leios.Blocks.html#4389" class="InductiveConstructor">vtHeader</a> <a id="5978" href="/agda_html/Leios.Protocol.html#5978" class="Bound">h</a><a id="5979" class="Symbol">)</a> <a id="5981" class="Symbol">=</a> <a id="5983" href="/agda_html/Leios.Protocol.html#5180" class="Function">vsValid?</a> <a id="5992" href="/agda_html/Leios.Protocol.html#5978" class="Bound">h</a></div>
<div class="line"></div>
<div class="line">  <a id="5997" href="/agda_html/Leios.Protocol.html#5997" class="Function">bodyValid</a> <a id="6007" class="Symbol">:</a> <a id="6009" href="/agda_html/Leios.Blocks.html#4427" class="Datatype">Body</a> <a id="6014" class="Symbol">→</a> <a id="6016" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a></div>
<div class="line">  <a id="6023" href="/agda_html/Leios.Protocol.html#5997" class="Function">bodyValid</a> <a id="6033" class="Symbol">(</a><a id="6034" href="/agda_html/Leios.Blocks.html#4449" class="InductiveConstructor">ibBody</a> <a id="6041" href="/agda_html/Leios.Protocol.html#6041" class="Bound">b</a><a id="6042" class="Symbol">)</a> <a id="6044" class="Symbol">=</a> <a id="6046" href="/agda_html/Leios.Protocol.html#3517" class="Record">ibBodyValid</a> <a id="6058" href="/agda_html/Leios.Protocol.html#6041" class="Bound">b</a></div>
<div class="line"></div>
<div class="line">  <a id="6063" href="/agda_html/Leios.Protocol.html#6063" class="Function">bodyValid?</a> <a id="6074" class="Symbol">:</a> <a id="6076" class="Symbol">(</a><a id="6077" href="/agda_html/Leios.Protocol.html#6077" class="Bound">b</a> <a id="6079" class="Symbol">:</a> <a id="6081" href="/agda_html/Leios.Blocks.html#4427" class="Datatype">Body</a><a id="6085" class="Symbol">)</a> <a id="6087" class="Symbol">→</a> <a id="6089" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="6093" class="Symbol">(</a><a id="6094" href="/agda_html/Leios.Protocol.html#5997" class="Function">bodyValid</a> <a id="6104" href="/agda_html/Leios.Protocol.html#6077" class="Bound">b</a><a id="6105" class="Symbol">)</a></div>
<div class="line">  <a id="6109" href="/agda_html/Leios.Protocol.html#6063" class="Function">bodyValid?</a> <a id="6120" class="Symbol">(</a><a id="6121" href="/agda_html/Leios.Blocks.html#4449" class="InductiveConstructor">ibBody</a> <a id="6128" href="/agda_html/Leios.Protocol.html#6128" class="Bound">b</a><a id="6129" class="Symbol">)</a> <a id="6131" class="Symbol">=</a> <a id="6133" href="/agda_html/Leios.Protocol.html#3957" class="Function">ibBodyValid?</a> <a id="6146" href="/agda_html/Leios.Protocol.html#6128" class="Bound">b</a></div>
<div class="line"></div>
<div class="line">  <a id="6151" href="/agda_html/Leios.Protocol.html#6151" class="Function">isValid</a> <a id="6159" class="Symbol">:</a> <a id="6161" href="/agda_html/Leios.Blocks.html#4294" class="Datatype">Header</a> <a id="6168" href="/agda_html/Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6170" href="/agda_html/Leios.Blocks.html#4427" class="Datatype">Body</a> <a id="6175" class="Symbol">→</a> <a id="6177" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a></div>
<div class="line">  <a id="6184" href="/agda_html/Leios.Protocol.html#6151" class="Function">isValid</a> <a id="6192" class="Symbol">(</a><a id="6193" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6198" href="/agda_html/Leios.Protocol.html#6198" class="Bound">h</a><a id="6199" class="Symbol">)</a> <a id="6201" class="Symbol">=</a> <a id="6203" href="/agda_html/Leios.Protocol.html#5259" class="Function">headerValid</a> <a id="6215" href="/agda_html/Leios.Protocol.html#6198" class="Bound">h</a></div>
<div class="line">  <a id="6219" href="/agda_html/Leios.Protocol.html#6151" class="Function">isValid</a> <a id="6227" class="Symbol">(</a><a id="6228" href="/agda_html/Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6233" href="/agda_html/Leios.Protocol.html#6233" class="Bound">b</a><a id="6234" class="Symbol">)</a> <a id="6236" class="Symbol">=</a> <a id="6238" href="/agda_html/Leios.Protocol.html#5997" class="Function">bodyValid</a> <a id="6248" href="/agda_html/Leios.Protocol.html#6233" class="Bound">b</a></div>
<div class="line"></div>
<div class="line">  <a id="6253" href="/agda_html/Leios.Protocol.html#6253" class="Function">isValid?</a> <a id="6262" class="Symbol">:</a> <a id="6264" class="Symbol">∀</a> <a id="6266" class="Symbol">(</a><a id="6267" href="/agda_html/Leios.Protocol.html#6267" class="Bound">x</a> <a id="6269" class="Symbol">:</a> <a id="6271" href="/agda_html/Leios.Blocks.html#4294" class="Datatype">Header</a> <a id="6278" href="/agda_html/Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6280" href="/agda_html/Leios.Blocks.html#4427" class="Datatype">Body</a><a id="6284" class="Symbol">)</a> <a id="6286" class="Symbol">→</a> <a id="6288" href="/agda_html/Relation.Nullary.Decidable.Core.html#1861" class="Record">Dec</a> <a id="6292" class="Symbol">(</a><a id="6293" href="/agda_html/Leios.Protocol.html#6151" class="Function">isValid</a> <a id="6301" href="/agda_html/Leios.Protocol.html#6267" class="Bound">x</a><a id="6302" class="Symbol">)</a></div>
<div class="line">  <a id="6306" href="/agda_html/Leios.Protocol.html#6253" class="Function">isValid?</a> <a id="6315" class="Symbol">(</a><a id="6316" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6321" href="/agda_html/Leios.Protocol.html#6321" class="Bound">h</a><a id="6322" class="Symbol">)</a> <a id="6324" class="Symbol">=</a> <a id="6326" href="/agda_html/Leios.Protocol.html#5605" class="Function">headerValid?</a> <a id="6339" href="/agda_html/Leios.Protocol.html#6321" class="Bound">h</a></div>
<div class="line">  <a id="6343" href="/agda_html/Leios.Protocol.html#6253" class="Function">isValid?</a> <a id="6352" class="Symbol">(</a><a id="6353" href="/agda_html/Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6358" href="/agda_html/Leios.Protocol.html#6358" class="Bound">b</a><a id="6359" class="Symbol">)</a> <a id="6361" class="Symbol">=</a> <a id="6363" href="/agda_html/Leios.Protocol.html#6063" class="Function">bodyValid?</a> <a id="6374" href="/agda_html/Leios.Protocol.html#6358" class="Bound">b</a></div>
<div class="line"></div>
<div class="line"><a id="6377" class="Comment">-- some predicates about EBs</a></div>
<div class="line"><a id="6406" class="Keyword">module</a> <a id="6413" href="/agda_html/Leios.Protocol.html#6413" class="Module">_</a> <a id="6415" class="Symbol">(</a><a id="6416" href="/agda_html/Leios.Protocol.html#6416" class="Bound">s</a> <a id="6418" class="Symbol">:</a> <a id="6420" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a><a id="6430" class="Symbol">)</a> <a id="6432" class="Symbol">(</a><a id="6433" href="/agda_html/Leios.Protocol.html#6433" class="Bound">eb</a> <a id="6436" class="Symbol">:</a> <a id="6438" href="/agda_html/Leios.Blocks.html#2804" class="Function">EndorserBlock</a><a id="6451" class="Symbol">)</a> <a id="6453" class="Keyword">where</a></div>
<div class="line">  <a id="6461" class="Keyword">open</a> <a id="6466" href="/agda_html/Leios.Blocks.html#2592" class="Module">EndorserBlockOSig</a> <a id="6484" href="/agda_html/Leios.Protocol.html#6433" class="Bound">eb</a></div>
<div class="line">  <a id="6489" class="Keyword">open</a> <a id="6494" href="/agda_html/Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="6505" href="/agda_html/Leios.Protocol.html#6416" class="Bound">s</a></div>
<div class="line"></div>
<div class="line">  <a id="6510" href="/agda_html/Leios.Protocol.html#6510" class="Function">allIBRefsKnown</a> <a id="6525" class="Symbol">:</a> <a id="6527" href="/agda_html/Agda.Primitive.html#388" class="Primitive">Type</a></div>
<div class="line">  <a id="6534" href="/agda_html/Leios.Protocol.html#6510" class="Function">allIBRefsKnown</a> <a id="6549" class="Symbol">=</a> <a id="6551" href="/agda_html/Class.IsSet.html#576" class="Function">∀[</a> <a id="6554" href="/agda_html/Leios.Protocol.html#6554" class="Bound">ref</a> <a id="6558" href="/agda_html/Class.IsSet.html#576" class="Function">∈</a> <a id="6560" href="/agda_html/Axiom.Set.html#5718" class="Function">fromList</a> <a id="6569" href="/agda_html/Leios.Blocks.html#2722" class="Field">ibRefs</a> <a id="6576" href="/agda_html/Class.IsSet.html#576" class="Function">]</a> <a id="6578" href="/agda_html/Leios.Protocol.html#6554" class="Bound">ref</a> <a id="6582" href="/agda_html/abstract-set-theory.Prelude.html#563" class="Function Operator">∈ˡ</a> <a id="6585" href="/agda_html/abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="6589" href="/agda_html/Leios.Blocks.html#2304" class="Function">getIBRef</a> <a id="6598" href="/agda_html/Leios.Protocol.html#1142" class="Function">IBs</a></div>
<div class="line"></div>
<div class="line"><a id="6603" class="Keyword">module</a> <a id="6610" href="/agda_html/Leios.Protocol.html#6610" class="Module">_</a> <a id="6612" class="Symbol">(</a><a id="6613" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a> <a id="6615" class="Symbol">:</a> <a id="6617" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a><a id="6627" class="Symbol">)</a> <a id="6629" class="Keyword">where</a></div>
<div class="line"></div>
<div class="line">  <a id="6638" class="Keyword">open</a> <a id="6643" href="/agda_html/Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="6654" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a></div>
<div class="line"></div>
<div class="line">  <a id="6659" href="/agda_html/Leios.Protocol.html#6659" class="Function">upd</a> <a id="6663" class="Symbol">:</a> <a id="6665" href="/agda_html/Leios.Blocks.html#4294" class="Datatype">Header</a> <a id="6672" href="/agda_html/Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6674" href="/agda_html/Leios.Blocks.html#4427" class="Datatype">Body</a> <a id="6679" class="Symbol">→</a> <a id="6681" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a></div>
<div class="line">  <a id="6694" href="/agda_html/Leios.Protocol.html#6659" class="Function">upd</a> <a id="6698" class="Symbol">(</a><a id="6699" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6704" class="Symbol">(</a><a id="6705" href="/agda_html/Leios.Blocks.html#4351" class="InductiveConstructor">ebHeader</a> <a id="6714" href="/agda_html/Leios.Protocol.html#6714" class="Bound">eb</a><a id="6716" class="Symbol">))</a> <a id="6719" class="Symbol">=</a> <a id="6721" class="Keyword">record</a> <a id="6728" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a> <a id="6730" class="Symbol">{</a> <a id="6732" href="/agda_html/Leios.Protocol.html#1180" class="Field">EBs</a> <a id="6736" class="Symbol">=</a> <a id="6738" href="/agda_html/Leios.Protocol.html#6714" class="Bound">eb</a> <a id="6741" href="/agda_html/Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6743" href="/agda_html/Leios.Protocol.html#1180" class="Field">EBs</a> <a id="6747" class="Symbol">}</a></div>
<div class="line">  <a id="6751" href="/agda_html/Leios.Protocol.html#6659" class="Function">upd</a> <a id="6755" class="Symbol">(</a><a id="6756" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6761" class="Symbol">(</a><a id="6762" href="/agda_html/Leios.Blocks.html#4389" class="InductiveConstructor">vtHeader</a> <a id="6771" href="/agda_html/Leios.Protocol.html#6771" class="Bound">vs</a><a id="6773" class="Symbol">))</a> <a id="6776" class="Symbol">=</a> <a id="6778" class="Keyword">record</a> <a id="6785" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a> <a id="6787" class="Symbol">{</a> <a id="6789" href="/agda_html/Leios.Protocol.html#1221" class="Field">Vs</a> <a id="6792" class="Symbol">=</a> <a id="6794" href="/agda_html/Leios.Protocol.html#6771" class="Bound">vs</a> <a id="6797" href="/agda_html/Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6799" href="/agda_html/Leios.Protocol.html#1221" class="Field">Vs</a> <a id="6802" class="Symbol">}</a></div>
<div class="line">  <a id="6806" href="/agda_html/Leios.Protocol.html#6659" class="Function">upd</a> <a id="6810" class="Symbol">(</a><a id="6811" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="6816" class="Symbol">(</a><a id="6817" href="/agda_html/Leios.Blocks.html#4318" class="InductiveConstructor">ibHeader</a> <a id="6826" href="/agda_html/Leios.Protocol.html#6826" class="Bound">h</a><a id="6827" class="Symbol">))</a> <a id="6830" class="Keyword">with</a> <a id="6835" href="/agda_html/Data.List.Relation.Unary.Any.html#2684" class="Function">A.any?</a> <a id="6842" class="Symbol">(</a><a id="6843" href="/agda_html/Leios.Blocks.html#4746" class="Function">matchIB?</a> <a id="6852" href="/agda_html/Leios.Protocol.html#6826" class="Bound">h</a><a id="6853" class="Symbol">)</a> <a id="6855" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a></div>
<div class="line">  <a id="6866" class="Symbol">...</a> <a id="6870" class="Symbol">|</a> <a id="6872" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="6876" href="/agda_html/Leios.Protocol.html#6876" class="Bound">p</a> <a id="6878" class="Symbol">=</a></div>
<div class="line">    <a id="6884" class="Keyword">record</a> <a id="6891" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a></div>
<div class="line">      <a id="6899" class="Symbol">{</a> <a id="6901" href="/agda_html/Leios.Protocol.html#1142" class="Field">IBs</a> <a id="6905" class="Symbol">=</a> <a id="6907" class="Keyword">record</a> <a id="6914" class="Symbol">{</a> <a id="6916" href="/agda_html/Leios.Blocks.html#1137" class="Field">header</a> <a id="6923" class="Symbol">=</a> <a id="6925" class="Bound">h</a> <a id="6927" class="Symbol">;</a> <a id="6929" href="/agda_html/Leios.Blocks.html#1163" class="Field">body</a> <a id="6934" class="Symbol">=</a> <a id="6936" href="/agda_html/Data.List.Relation.Unary.Any.html#1916" class="Function">A.lookup</a> <a id="6945" href="/agda_html/Leios.Protocol.html#6876" class="Bound">p</a> <a id="6947" class="Symbol">}</a> <a id="6949" href="/agda_html/Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6951" href="/agda_html/Leios.Protocol.html#1142" class="Field">IBs</a></div>
<div class="line">      <a id="6961" class="Symbol">;</a> <a id="6963" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a> <a id="6972" class="Symbol">=</a> <a id="6974" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a> <a id="6983" href="/agda_html/Data.List.Relation.Unary.Any.html#2128" class="Function Operator">A.─</a> <a id="6987" href="/agda_html/Leios.Protocol.html#6876" class="Bound">p</a></div>
<div class="line">      <a id="6995" class="Symbol">}</a></div>
<div class="line">  <a id="6999" class="Symbol">...</a> <a id="7003" class="Symbol">|</a> <a id="7005" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="7008" class="Symbol">_</a> <a id="7010" class="Symbol">=</a></div>
<div class="line">    <a id="7016" class="Keyword">record</a> <a id="7023" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a></div>
<div class="line">      <a id="7031" class="Symbol">{</a> <a id="7033" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a> <a id="7043" class="Symbol">=</a> <a id="7045" class="Bound">h</a> <a id="7047" href="/agda_html/Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7049" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a></div>
<div class="line">      <a id="7065" class="Symbol">}</a></div>
<div class="line">  <a id="7069" href="/agda_html/Leios.Protocol.html#6659" class="Function">upd</a> <a id="7073" class="Symbol">(</a><a id="7074" href="/agda_html/Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="7079" class="Symbol">(</a><a id="7080" href="/agda_html/Leios.Blocks.html#4449" class="InductiveConstructor">ibBody</a> <a id="7087" href="/agda_html/Leios.Protocol.html#7087" class="Bound">b</a><a id="7088" class="Symbol">))</a> <a id="7091" class="Keyword">with</a> <a id="7096" href="/agda_html/Data.List.Relation.Unary.Any.html#2684" class="Function">A.any?</a> <a id="7103" class="Symbol">(</a><a id="7104" href="/agda_html/Function.Base.html#1638" class="Function">flip</a> <a id="7109" href="/agda_html/Leios.Blocks.html#4746" class="Function">matchIB?</a> <a id="7118" href="/agda_html/Leios.Protocol.html#7087" class="Bound">b</a><a id="7119" class="Symbol">)</a> <a id="7121" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a></div>
<div class="line">  <a id="7133" class="Symbol">...</a> <a id="7137" class="Symbol">|</a> <a id="7139" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="7143" href="/agda_html/Leios.Protocol.html#7143" class="Bound">p</a> <a id="7145" class="Symbol">=</a></div>
<div class="line">    <a id="7151" class="Keyword">record</a> <a id="7158" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a></div>
<div class="line">      <a id="7166" class="Symbol">{</a> <a id="7168" href="/agda_html/Leios.Protocol.html#1142" class="Field">IBs</a> <a id="7172" class="Symbol">=</a> <a id="7174" class="Keyword">record</a> <a id="7181" class="Symbol">{</a> <a id="7183" href="/agda_html/Leios.Blocks.html#1137" class="Field">header</a> <a id="7190" class="Symbol">=</a> <a id="7192" href="/agda_html/Data.List.Relation.Unary.Any.html#1916" class="Function">A.lookup</a> <a id="7201" href="/agda_html/Leios.Protocol.html#7143" class="Bound">p</a> <a id="7203" class="Symbol">;</a> <a id="7205" href="/agda_html/Leios.Blocks.html#1163" class="Field">body</a> <a id="7210" class="Symbol">=</a> <a id="7212" class="Bound">b</a> <a id="7214" class="Symbol">}</a> <a id="7216" href="/agda_html/Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7218" href="/agda_html/Leios.Protocol.html#1142" class="Field">IBs</a></div>
<div class="line">      <a id="7228" class="Symbol">;</a> <a id="7230" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a> <a id="7240" class="Symbol">=</a> <a id="7242" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a> <a id="7252" href="/agda_html/Data.List.Relation.Unary.Any.html#2128" class="Function Operator">A.─</a> <a id="7256" href="/agda_html/Leios.Protocol.html#7143" class="Bound">p</a></div>
<div class="line">      <a id="7264" class="Symbol">}</a></div>
<div class="line">  <a id="7268" class="Symbol">...</a> <a id="7272" class="Symbol">|</a> <a id="7274" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="7277" class="Symbol">_</a> <a id="7279" class="Symbol">=</a></div>
<div class="line">    <a id="7285" class="Keyword">record</a> <a id="7292" href="/agda_html/Leios.Protocol.html#6613" class="Bound">s</a></div>
<div class="line">      <a id="7300" class="Symbol">{</a> <a id="7302" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a> <a id="7311" class="Symbol">=</a> <a id="7313" class="Bound">b</a> <a id="7315" href="/agda_html/Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="7317" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a></div>
<div class="line">      <a id="7332" class="Symbol">}</a></div>
<div class="line"></div>
<div class="line"><a id="7335" class="Keyword">module</a> <a id="7342" href="/agda_html/Leios.Protocol.html#7342" class="Module">_</a> <a id="7344" class="Symbol">{</a><a id="7345" href="/agda_html/Leios.Protocol.html#7345" class="Bound">s</a> <a id="7347" href="/agda_html/Leios.Protocol.html#7347" class="Bound">s&#39;</a><a id="7349" class="Symbol">}</a> <a id="7351" class="Keyword">where</a></div>
<div class="line">  <a id="7359" class="Keyword">open</a> <a id="7364" href="/agda_html/Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="7375" href="/agda_html/Leios.Protocol.html#7347" class="Bound">s&#39;</a></div>
<div class="line"></div>
<div class="line">  <a id="7381" href="/agda_html/Leios.Protocol.html#7381" class="Function">upd-preserves-Upkeep</a> <a id="7402" class="Symbol">:</a> <a id="7404" class="Symbol">∀</a> <a id="7406" class="Symbol">{</a><a id="7407" href="/agda_html/Leios.Protocol.html#7407" class="Bound">x</a><a id="7408" class="Symbol">}</a> <a id="7410" class="Symbol">→</a> <a id="7412" href="/agda_html/Leios.Protocol.html#1354" class="Field">LeiosState.Upkeep</a> <a id="7430" href="/agda_html/Leios.Protocol.html#7345" class="Bound">s</a> <a id="7432" href="/agda_html/Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7434" href="/agda_html/Leios.Protocol.html#1354" class="Field">LeiosState.Upkeep</a> <a id="7452" href="/agda_html/Leios.Protocol.html#7347" class="Bound">s&#39;</a></div>
<div class="line">                               <a id="7486" class="Symbol">→</a> <a id="7488" href="/agda_html/Leios.Protocol.html#1354" class="Field">LeiosState.Upkeep</a> <a id="7506" href="/agda_html/Leios.Protocol.html#7345" class="Bound">s</a> <a id="7508" href="/agda_html/Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7510" href="/agda_html/Leios.Protocol.html#1354" class="Field">LeiosState.Upkeep</a> <a id="7528" class="Symbol">(</a><a id="7529" href="/agda_html/Leios.Protocol.html#6659" class="Function">upd</a> <a id="7533" href="/agda_html/Leios.Protocol.html#7347" class="Bound">s&#39;</a> <a id="7536" href="/agda_html/Leios.Protocol.html#7407" class="Bound">x</a><a id="7537" class="Symbol">)</a></div>
<div class="line">  <a id="7541" href="/agda_html/Leios.Protocol.html#7381" class="Function">upd-preserves-Upkeep</a> <a id="7562" class="Symbol">{</a><a id="7563" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7568" class="Symbol">(</a><a id="7569" href="/agda_html/Leios.Blocks.html#4318" class="InductiveConstructor">ibHeader</a> <a id="7578" href="/agda_html/Leios.Protocol.html#7578" class="Bound">x</a><a id="7579" class="Symbol">)}</a> <a id="7582" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="7587" class="Keyword">with</a> <a id="7592" href="/agda_html/Data.List.Relation.Unary.Any.html#2684" class="Function">A.any?</a> <a id="7599" class="Symbol">(</a><a id="7600" href="/agda_html/Leios.Blocks.html#4746" class="Function">matchIB?</a> <a id="7609" href="/agda_html/Leios.Protocol.html#7578" class="Bound">x</a><a id="7610" class="Symbol">)</a> <a id="7612" href="/agda_html/Leios.Protocol.html#1320" class="Field">IBBodies</a></div>
<div class="line">  <a id="7623" class="Symbol">...</a> <a id="7627" class="Symbol">|</a> <a id="7629" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="7633" href="/agda_html/Leios.Protocol.html#7633" class="Bound">p</a> <a id="7635" class="Symbol">=</a> <a id="7637" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a></div>
<div class="line">  <a id="7644" class="Symbol">...</a> <a id="7648" class="Symbol">|</a> <a id="7650" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="7653" href="/agda_html/Leios.Protocol.html#7653" class="Bound">¬p</a> <a id="7656" class="Symbol">=</a> <a id="7658" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a></div>
<div class="line">  <a id="7665" href="/agda_html/Leios.Protocol.html#7381" class="Function">upd-preserves-Upkeep</a> <a id="7686" class="Symbol">{</a><a id="7687" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7692" class="Symbol">(</a><a id="7693" href="/agda_html/Leios.Blocks.html#4351" class="InductiveConstructor">ebHeader</a> <a id="7702" href="/agda_html/Leios.Protocol.html#7702" class="Bound">x</a><a id="7703" class="Symbol">)}</a> <a id="7706" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="7711" class="Symbol">=</a> <a id="7713" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a></div>
<div class="line">  <a id="7720" href="/agda_html/Leios.Protocol.html#7381" class="Function">upd-preserves-Upkeep</a> <a id="7741" class="Symbol">{</a><a id="7742" href="/agda_html/Data.Sum.Base.html#675" class="InductiveConstructor">inj₁</a> <a id="7747" class="Symbol">(</a><a id="7748" href="/agda_html/Leios.Blocks.html#4389" class="InductiveConstructor">vtHeader</a> <a id="7757" href="/agda_html/Leios.Protocol.html#7757" class="Bound">x</a><a id="7758" class="Symbol">)}</a> <a id="7761" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="7766" class="Symbol">=</a> <a id="7768" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a></div>
<div class="line">  <a id="7775" href="/agda_html/Leios.Protocol.html#7381" class="Function">upd-preserves-Upkeep</a> <a id="7796" class="Symbol">{</a><a id="7797" href="/agda_html/Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="7802" class="Symbol">(</a><a id="7803" href="/agda_html/Leios.Blocks.html#4449" class="InductiveConstructor">ibBody</a> <a id="7810" href="/agda_html/Leios.Protocol.html#7810" class="Bound">x</a><a id="7811" class="Symbol">)}</a> <a id="7814" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="7819" class="Keyword">with</a> <a id="7824" href="/agda_html/Data.List.Relation.Unary.Any.html#2684" class="Function">A.any?</a> <a id="7831" class="Symbol">(</a><a id="7832" href="/agda_html/Function.Base.html#1638" class="Function">flip</a> <a id="7837" href="/agda_html/Leios.Blocks.html#4746" class="Function">matchIB?</a> <a id="7846" href="/agda_html/Leios.Protocol.html#7810" class="Bound">x</a><a id="7847" class="Symbol">)</a> <a id="7849" href="/agda_html/Leios.Protocol.html#1284" class="Field">IBHeaders</a></div>
<div class="line">  <a id="7861" class="Symbol">...</a> <a id="7865" class="Symbol">|</a> <a id="7867" href="/agda_html/Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a> <a id="7871" href="/agda_html/Leios.Protocol.html#7871" class="Bound">p</a> <a id="7873" class="Symbol">=</a> <a id="7875" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a></div>
<div class="line">  <a id="7882" class="Symbol">...</a> <a id="7886" class="Symbol">|</a> <a id="7888" href="/agda_html/Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a> <a id="7891" href="/agda_html/Leios.Protocol.html#7891" class="Bound">¬p</a> <a id="7894" class="Symbol">=</a> <a id="7896" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a></div>
<div class="line"></div>
<div class="line"><a id="7902" class="Keyword">infix</a> <a id="7908" class="Number">25</a> <a id="7911" href="/agda_html/Leios.Protocol.html#7915" class="Function Operator">_↑_</a></div>
<div class="line"><a id="_↑_"></a><a id="7915" href="/agda_html/Leios.Protocol.html#7915" class="Function Operator">_↑_</a> <a id="7919" class="Symbol">:</a> <a id="7921" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="7932" class="Symbol">→</a> <a id="7934" href="/agda_html/Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="7939" class="Symbol">(</a><a id="7940" href="/agda_html/Leios.Blocks.html#4294" class="Datatype">Header</a> <a id="7947" href="/agda_html/Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="7949" href="/agda_html/Leios.Blocks.html#4427" class="Datatype">Body</a><a id="7953" class="Symbol">)</a> <a id="7955" class="Symbol">→</a> <a id="7957" href="/agda_html/Leios.Protocol.html#959" class="Record">LeiosState</a></div>
<div class="line"><a id="7968" href="/agda_html/Leios.Protocol.html#7915" class="Function Operator">_↑_</a> <a id="7972" class="Symbol">=</a> <a id="7974" href="/agda_html/Data.List.Base.html#4148" class="Function">foldr</a> <a id="7980" class="Symbol">(</a><a id="7981" href="/agda_html/Function.Base.html#1638" class="Function">flip</a> <a id="7986" href="/agda_html/Leios.Protocol.html#6659" class="Function">upd</a><a id="7989" class="Symbol">)</a></div>
<div class="line"></div>
<div class="line"><a id="↑-preserves-Upkeep"></a><a id="7992" href="/agda_html/Leios.Protocol.html#7992" class="Function">↑-preserves-Upkeep</a> <a id="8011" class="Symbol">:</a> <a id="8013" class="Symbol">∀</a> <a id="8015" class="Symbol">{</a><a id="8016" href="/agda_html/Leios.Protocol.html#8016" class="Bound">s</a> <a id="8018" href="/agda_html/Leios.Protocol.html#8018" class="Bound">x</a><a id="8019" class="Symbol">}</a> <a id="8021" class="Symbol">→</a> <a id="8023" href="/agda_html/Leios.Protocol.html#1354" class="Field">LeiosState.Upkeep</a> <a id="8041" href="/agda_html/Leios.Protocol.html#8016" class="Bound">s</a> <a id="8043" href="/agda_html/Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8045" href="/agda_html/Leios.Protocol.html#1354" class="Field">LeiosState.Upkeep</a> <a id="8063" class="Symbol">(</a><a id="8064" href="/agda_html/Leios.Protocol.html#8016" class="Bound">s</a> <a id="8066" href="/agda_html/Leios.Protocol.html#7915" class="Function Operator">↑</a> <a id="8068" href="/agda_html/Leios.Protocol.html#8018" class="Bound">x</a><a id="8069" class="Symbol">)</a></div>
<div class="line"><a id="8071" href="/agda_html/Leios.Protocol.html#7992" class="Function">↑-preserves-Upkeep</a> <a id="8090" class="Symbol">{</a><a id="8091" class="Argument">x</a> <a id="8093" class="Symbol">=</a> <a id="8095" href="/agda_html/Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="8097" class="Symbol">}</a> <a id="8099" class="Symbol">=</a> <a id="8101" href="/agda_html/Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a></div>
<div class="line"><a id="8106" href="/agda_html/Leios.Protocol.html#7992" class="Function">↑-preserves-Upkeep</a> <a id="8125" class="Symbol">{</a><a id="8126" class="Argument">s</a> <a id="8128" class="Symbol">=</a> <a id="8130" href="/agda_html/Leios.Protocol.html#8130" class="Bound">s</a><a id="8131" class="Symbol">}</a> <a id="8133" class="Symbol">{</a><a id="8134" class="Argument">x</a> <a id="8136" class="Symbol">=</a> <a id="8138" href="/agda_html/Leios.Protocol.html#8138" class="Bound">x</a> <a id="8140" href="/agda_html/Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="8142" href="/agda_html/Leios.Protocol.html#8142" class="Bound">x₁</a><a id="8144" class="Symbol">}</a> <a id="8146" class="Symbol">=</a></div>
<div class="line">  <a id="8150" href="/agda_html/Leios.Protocol.html#7381" class="Function">upd-preserves-Upkeep</a> <a id="8171" class="Symbol">{</a><a id="8172" class="Argument">s</a> <a id="8174" class="Symbol">=</a> <a id="8176" href="/agda_html/Leios.Protocol.html#8130" class="Bound">s</a><a id="8177" class="Symbol">}</a> <a id="8179" class="Symbol">{</a><a id="8180" class="Argument">x</a> <a id="8182" class="Symbol">=</a> <a id="8184" href="/agda_html/Leios.Protocol.html#8138" class="Bound">x</a><a id="8185" class="Symbol">}</a> <a id="8187" class="Symbol">(</a><a id="8188" href="/agda_html/Leios.Protocol.html#7992" class="Function">↑-preserves-Upkeep</a> <a id="8207" class="Symbol">{</a><a id="8208" class="Argument">x</a> <a id="8210" class="Symbol">=</a> <a id="8212" href="/agda_html/Leios.Protocol.html#8142" class="Bound">x₁</a><a id="8214" class="Symbol">})</a></div>
<div class="line"></div></pre></main></div></body></html>
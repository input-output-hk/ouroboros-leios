## Short-Pipeline Leios

<!--
<pre class="Agda"><a id="39" class="Symbol">{-#</a> <a id="43" class="Keyword">OPTIONS</a> <a id="51" class="Pragma">--safe</a> <a id="58" class="Symbol">#-}</a>
<a id="62" class="Keyword">open</a> <a id="67" class="Keyword">import</a> <a id="74" href="Leios.Prelude.html" class="Module">Leios.Prelude</a> <a id="88" class="Keyword">hiding</a> <a id="95" class="Symbol">(</a><a id="96" href="Function.Base.html#704" class="Function">id</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Leios.FFD.html" class="Module">Leios.FFD</a>
<a id="122" class="Keyword">open</a> <a id="127" class="Keyword">import</a> <a id="134" href="Leios.SpecStructure.html" class="Module">Leios.SpecStructure</a>

<a id="155" class="Keyword">open</a> <a id="160" class="Keyword">import</a> <a id="167" href="Tactic.Defaults.html" class="Module">Tactic.Defaults</a>
<a id="183" class="Keyword">open</a> <a id="188" class="Keyword">import</a> <a id="195" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="216" class="Keyword">module</a> <a id="223" href="Leios.Short.html" class="Module">Leios.Short</a> <a id="235" class="Symbol">(</a><a id="236" href="Leios.Short.html#236" class="Bound">⋯</a> <a id="238" class="Symbol">:</a> <a id="240" href="Leios.SpecStructure.html#286" class="Record">SpecStructure</a> <a id="254" class="Number">1</a><a id="255" class="Symbol">)</a>
  <a id="259" class="Symbol">(</a><a id="260" class="Keyword">let</a> <a id="264" class="Keyword">open</a> <a id="269" href="Leios.SpecStructure.html#286" class="Module">SpecStructure</a> <a id="283" href="Leios.Short.html#236" class="Bound">⋯</a> <a id="285" class="Keyword">renaming</a> <a id="294" class="Symbol">(</a><a id="295" href="Leios.Voting.html#203" class="Function">isVoteCertified</a> <a id="311" class="Symbol">to</a> <a id="314" class="Function">isVoteCertified&#39;</a><a id="330" class="Symbol">))</a> <a id="333" class="Keyword">where</a>
</pre>-->

This document is a specification of Short-Pipeline Leios, usually
abbreviated as Short Leios. On a high level, the pipeline looks like this:

1. If elected, propose IB
2. Wait
3. Wait
4. If elected, propose EB
5. If elected, vote
   If elected, propose RB

### Upkeep

A node that never produces a block even though it could is not
supposed to be an honest node, and we prevent that by tracking whether
a node has checked if it can make a block in a particular slot.
`LeiosState` contains a set of `SlotUpkeep` and we ensure that this
set contains all elements before we can advance to the next slot,
resetting this field to the empty set.

<pre class="Agda"><a id="997" class="Keyword">data</a> <a id="SlotUpkeep"></a><a id="1002" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a> <a id="1013" class="Symbol">:</a> <a id="1015" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1020" class="Keyword">where</a>
  <a id="SlotUpkeep.Base"></a><a id="1028" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="SlotUpkeep.IB-Role"></a><a id="1033" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a> <a id="SlotUpkeep.EB-Role"></a><a id="1041" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a> <a id="1049" class="Symbol">:</a> <a id="1051" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a>

<a id="1063" class="Keyword">unquoteDecl</a> <a id="DecEq-SlotUpkeep"></a><a id="1075" href="Leios.Short.html#1075" class="Function">DecEq-SlotUpkeep</a> <a id="1092" class="Symbol">=</a> <a id="1094" href="Tactic.Derive.DecEq.html#3512" class="Function">derive-DecEq</a> <a id="1107" class="Symbol">((</a><a id="1109" class="Keyword">quote</a> <a id="1115" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a> <a id="1126" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1128" href="Leios.Short.html#1075" class="Function">DecEq-SlotUpkeep</a><a id="1144" class="Symbol">)</a> <a id="1146" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1148" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1150" class="Symbol">)</a>
</pre><!--
<pre class="Agda"><a id="1169" class="Keyword">data</a> <a id="StageUpkeep"></a><a id="1174" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a> <a id="1186" class="Symbol">:</a> <a id="1188" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1193" class="Keyword">where</a>
  <a id="StageUpkeep.VT-Role"></a><a id="1201" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a> <a id="1209" class="Symbol">:</a> <a id="1211" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a>

<a id="1224" class="Keyword">unquoteDecl</a> <a id="DecEq-StageUpkeep"></a><a id="1236" href="Leios.Short.html#1236" class="Function">DecEq-StageUpkeep</a> <a id="1254" class="Symbol">=</a> <a id="1256" href="Tactic.Derive.DecEq.html#3512" class="Function">derive-DecEq</a> <a id="1269" class="Symbol">((</a><a id="1271" class="Keyword">quote</a> <a id="1277" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a> <a id="1289" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1291" href="Leios.Short.html#1236" class="Function">DecEq-StageUpkeep</a><a id="1308" class="Symbol">)</a> <a id="1310" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1312" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1314" class="Symbol">)</a>
</pre><pre class="Agda"><a id="1328" class="Keyword">open</a> <a id="1333" class="Keyword">import</a> <a id="1340" href="Leios.Protocol.html" class="Module">Leios.Protocol</a> <a id="1355" class="Symbol">(</a><a id="1356" href="Leios.Short.html#236" class="Bound">⋯</a><a id="1357" class="Symbol">)</a> <a id="1359" href="Leios.Short.html#1002" class="Datatype">SlotUpkeep</a> <a id="1370" href="Leios.Short.html#1174" class="Datatype">StageUpkeep</a> <a id="1382" class="Keyword">public</a>

<a id="1390" class="Keyword">open</a> <a id="1395" href="Leios.Base.html#576" class="Module">BaseAbstract</a> <a id="1408" href="Leios.SpecStructure.html#835" class="Field">B&#39;</a> <a id="1411" class="Keyword">using</a> <a id="1417" class="Symbol">(</a><a id="1418" href="Leios.Base.html#611" class="Field">Cert</a><a id="1422" class="Symbol">;</a> <a id="1424" href="Leios.Base.html#677" class="Field">V-chkCerts</a><a id="1434" class="Symbol">;</a> <a id="1436" href="Leios.Base.html#631" class="Field">VTy</a><a id="1439" class="Symbol">;</a> <a id="1441" href="Leios.Base.html#650" class="Field">initSlot</a><a id="1449" class="Symbol">)</a>
<a id="1451" class="Keyword">open</a> <a id="1456" href="Leios.SpecStructure.html#1203" class="Module">FFD</a> <a id="1460" class="Keyword">hiding</a> <a id="1467" class="Symbol">(</a><a id="1468" href="Leios.FFD.html#562" class="Function Operator">_-⟦_/_⟧⇀_</a><a id="1477" class="Symbol">)</a>
<a id="1479" class="Keyword">open</a> <a id="1484" href="Leios.Blocks.html#4489" class="Module">GenFFD</a>
</pre><pre class="Agda"><a id="isVoteCertified"></a><a id="1503" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="1519" class="Symbol">:</a> <a id="1521" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="1532" class="Symbol">→</a> <a id="1534" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a> <a id="1548" class="Symbol">→</a> <a id="1550" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1555" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="1571" href="Leios.Short.html#1571" class="Bound">s</a> <a id="1573" href="Leios.Short.html#1573" class="Bound">eb</a> <a id="1576" class="Symbol">=</a> <a id="1578" href="Leios.Short.html#314" class="Function">isVoteCertified&#39;</a> <a id="1595" class="Symbol">(</a><a id="1596" href="Leios.Protocol.html#1869" class="Field">LeiosState.votingState</a> <a id="1619" href="Leios.Short.html#1571" class="Bound">s</a><a id="1620" class="Symbol">)</a> <a id="1622" class="Symbol">(</a><a id="1623" href="Data.Fin.Patterns.html#399" class="InductiveConstructor">0F</a> <a id="1626" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1628" href="Leios.Short.html#1573" class="Bound">eb</a><a id="1630" class="Symbol">)</a>
</pre><pre class="Agda"><a id="1644" class="Keyword">private</a> <a id="1652" class="Keyword">variable</a> <a id="1661" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="1663" href="Leios.Short.html#1663" class="Generalizable">s&#39;</a>   <a id="1668" class="Symbol">:</a> <a id="1670" href="Leios.Protocol.html#1359" class="Record">LeiosState</a>
                 <a id="1698" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>  <a id="1705" class="Symbol">:</a> <a id="1707" href="Leios.FFD.html#508" class="Function">FFD.State</a>
                 <a id="1734" href="Leios.Short.html#1734" class="Generalizable">π</a>      <a id="1741" class="Symbol">:</a> <a id="1743" href="Leios.Abstract.html#578" class="Function">VrfPf</a>
                 <a id="1766" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>    <a id="1773" class="Symbol">:</a> <a id="1775" href="Leios.Base.html#3253" class="Function">B.State</a>
                 <a id="1800" href="Leios.Short.html#1800" class="Generalizable">ks</a> <a id="1803" href="Leios.Short.html#1803" class="Generalizable">ks&#39;</a> <a id="1807" class="Symbol">:</a> <a id="1809" href="Leios.KeyRegistration.html#453" class="Function">K.State</a>
                 <a id="1834" href="Leios.Short.html#1834" class="Generalizable">msgs</a>   <a id="1841" class="Symbol">:</a> <a id="1843" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1848" class="Symbol">(</a><a id="1849" href="Leios.FFD.html#117" class="Field">FFDAbstract.Header</a> <a id="1868" href="Leios.Blocks.html#5537" class="Function">ffdAbstract</a> <a id="1880" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="1882" href="Leios.FFD.html#124" class="Field">FFDAbstract.Body</a> <a id="1899" href="Leios.Blocks.html#5537" class="Function">ffdAbstract</a><a id="1910" class="Symbol">)</a>
                 <a id="1929" href="Leios.Short.html#1929" class="Generalizable">eb</a>     <a id="1936" class="Symbol">:</a> <a id="1938" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a>
                 <a id="1969" href="Leios.Short.html#1969" class="Generalizable">ebs</a>    <a id="1976" class="Symbol">:</a> <a id="1978" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1983" href="Leios.Blocks.html#3047" class="Function">EndorserBlock</a>
                 <a id="2014" href="Leios.Short.html#2014" class="Generalizable">rbs</a>    <a id="2021" class="Symbol">:</a> <a id="2023" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2028" href="Leios.Base.html#503" class="Function">RankingBlock</a>
                 <a id="2058" href="Leios.Short.html#2058" class="Generalizable">txs</a>    <a id="2065" class="Symbol">:</a> <a id="2067" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2072" href="Leios.Abstract.html#457" class="Function">Tx</a>
                 <a id="2092" href="Leios.Short.html#2092" class="Generalizable">V</a>      <a id="2099" class="Symbol">:</a> <a id="2101" href="Leios.Base.html#631" class="Function">VTy</a>
                 <a id="2122" href="Leios.Short.html#2122" class="Generalizable">SD</a>     <a id="2129" class="Symbol">:</a> <a id="2131" href="Leios.Base.html#453" class="Function">StakeDistr</a>
                 <a id="2159" href="Leios.Short.html#2159" class="Generalizable">pks</a>    <a id="2166" class="Symbol">:</a> <a id="2168" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2173" href="Leios.VRF.html#911" class="Function">PubKey</a>
</pre>-->

### Block/Vote production rules

We now define the rules for block production given by the relation `_↝_`. These are split in two:

1. Positive rules, when we do need to create a block.
2. Negative rules, when we cannot create a block.

The purpose of the negative rules is to properly adjust the upkeep if
we cannot make a block.

Note that `_↝_`, starting with an empty upkeep can always make exactly
three steps corresponding to the three types of Leios specific blocks.

<pre class="Agda"><a id="2672" class="Keyword">data</a> <a id="_↝_"></a><a id="2677" href="Leios.Short.html#2677" class="Datatype Operator">_↝_</a> <a id="2681" class="Symbol">:</a> <a id="2683" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="2694" class="Symbol">→</a> <a id="2696" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="2707" class="Symbol">→</a> <a id="2709" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2714" class="Keyword">where</a>
</pre>#### Positive rules
<pre class="Agda">  <a id="_↝_.IB-Role"></a><a id="2754" href="Leios.Short.html#2754" class="InductiveConstructor">IB-Role</a> <a id="2762" class="Symbol">:</a> <a id="2764" class="Keyword">let</a> <a id="2768" class="Keyword">open</a> <a id="2773" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="2784" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="2786" class="Keyword">renaming</a> <a id="2795" class="Symbol">(</a><a id="2796" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="2805" class="Symbol">to</a> <a id="2808" class="Field">ffds</a><a id="2812" class="Symbol">)</a>
                <a id="2830" href="Leios.Short.html#2830" class="Bound">b</a> <a id="2832" class="Symbol">=</a> <a id="2834" href="Leios.Blocks.html#4692" class="InductiveConstructor">ibBody</a> <a id="2841" class="Symbol">(</a><a id="2842" class="Keyword">record</a> <a id="2849" class="Symbol">{</a> <a id="2851" href="Leios.Blocks.html#1326" class="Field">txs</a> <a id="2855" class="Symbol">=</a> <a id="2857" href="Leios.Protocol.html#1516" class="Function">ToPropose</a> <a id="2867" class="Symbol">})</a>
                <a id="2886" href="Leios.Short.html#2886" class="Bound">h</a> <a id="2888" class="Symbol">=</a> <a id="2890" href="Leios.Blocks.html#4561" class="InductiveConstructor">ibHeader</a> <a id="2899" class="Symbol">(</a><a id="2900" href="Leios.Blocks.html#2141" class="Function">mkIBHeader</a> <a id="2911" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="2916" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="2919" href="Leios.Short.html#1734" class="Generalizable">π</a> <a id="2921" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="2927" href="Leios.Protocol.html#1516" class="Function">ToPropose</a><a id="2936" class="Symbol">)</a>
          <a id="2948" class="Keyword">in</a>
          <a id="2961" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="2963" href="Leios.VRF.html#1245" class="Function">canProduceIB</a> <a id="2976" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="2981" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="2987" class="Symbol">(</a><a id="2988" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="2994" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="2995" class="Symbol">)</a> <a id="2997" href="Leios.Short.html#1734" class="Generalizable">π</a>
          <a id="3009" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3011" href="Leios.Short.html#2808" class="Function">ffds</a> <a id="3016" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="3023" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="3028" href="Leios.Short.html#2886" class="Bound">h</a> <a id="3030" class="Symbol">(</a><a id="3031" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="3036" href="Leios.Short.html#2830" class="Bound">b</a><a id="3037" class="Symbol">)</a> <a id="3039" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="3041" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="3049" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="3052" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
          <a id="3068" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="3152" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3154" href="Leios.Short.html#2677" class="Datatype Operator">↝</a> <a id="3156" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="3166" class="Keyword">record</a> <a id="3173" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3175" class="Symbol">{</a> <a id="3177" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="3186" class="Symbol">=</a> <a id="3188" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a> <a id="3194" class="Symbol">}</a> <a id="3196" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>
</pre>When η = 0 there is no indirect ledger inclusion; in case η > 0 earlier EBs might
be referenced (Full-Short Leios).
<pre class="Agda">  <a id="_↝_.EB-Role"></a><a id="3334" href="Leios.Short.html#3334" class="InductiveConstructor">EB-Role</a> <a id="3342" class="Symbol">:</a> <a id="3344" class="Keyword">let</a> <a id="3348" class="Keyword">open</a> <a id="3353" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="3364" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3366" class="Keyword">renaming</a> <a id="3375" class="Symbol">(</a><a id="3376" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="3385" class="Symbol">to</a> <a id="3388" class="Field">ffds</a><a id="3392" class="Symbol">)</a>
                <a id="3410" href="Leios.Short.html#3410" class="Bound">LI</a> <a id="3413" class="Symbol">=</a> <a id="3415" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="3419" href="Leios.Blocks.html#2547" class="Function">getIBRef</a> <a id="3428" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3430" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="3437" class="Symbol">(</a><a id="3438" href="Leios.Blocks.html#770" class="Function Operator">_∈ᴮ</a> <a id="3442" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="3448" href="Leios.Abstract.html#961" class="Function">L</a> <a id="3450" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="3455" class="Number">3</a><a id="3456" class="Symbol">)</a> <a id="3458" href="Leios.Protocol.html#1547" class="Function">IBs</a> <a id="3462" class="Comment">-- TODO: add late IB inclusion</a>
                <a id="3509" href="Leios.Short.html#3509" class="Bound">LE</a> <a id="3512" class="Symbol">=</a> <a id="3514" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="3518" href="Leios.Blocks.html#4034" class="Function">getEBRef</a> <a id="3527" href="Leios.Short.html#1969" class="Generalizable">ebs</a>
                <a id="3547" href="Leios.Short.html#3547" class="Bound">h</a>  <a id="3550" class="Symbol">=</a> <a id="3552" href="Leios.Blocks.html#3578" class="Function">mkEB</a> <a id="3557" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="3562" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="3565" href="Leios.Short.html#1734" class="Generalizable">π</a> <a id="3567" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="3573" href="Leios.Short.html#3410" class="Bound">LI</a> <a id="3576" href="Leios.Short.html#3509" class="Bound">LE</a>
                <a id="3595" href="Leios.Short.html#3595" class="Bound">P</a>  <a id="3598" class="Symbol">=</a> <a id="3600" class="Symbol">λ</a> <a id="3602" href="Leios.Short.html#3602" class="Bound">x</a> <a id="3604" class="Symbol">→</a> <a id="3606" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="3622" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="3624" href="Leios.Short.html#3602" class="Bound">x</a>
                         <a id="3651" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3653" href="Leios.Short.html#3602" class="Bound">x</a> <a id="3655" href="abstract-set-theory.Prelude.html#563" class="Function Operator">∈ˡ</a> <a id="3658" href="Leios.Protocol.html#1586" class="Function">EBs</a>
                         <a id="3687" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3689" href="Leios.Short.html#3602" class="Bound">x</a> <a id="3691" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="3694" href="Leios.Prelude.html#1475" class="Function">slices</a> <a id="3701" href="Leios.Abstract.html#961" class="Function">L</a> <a id="3703" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="3708" class="Number">2</a> <a id="3710" class="Symbol">(</a><a id="3711" class="Number">3</a> <a id="3713" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="3715" href="Leios.Abstract.html#1009" class="Function">η</a> <a id="3717" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="3719" href="Leios.Abstract.html#961" class="Function">L</a><a id="3720" class="Symbol">)</a>
                <a id="3738" href="Leios.Short.html#3738" class="Bound">slots</a> <a id="3744" class="Symbol">=</a> <a id="3746" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="3750" href="Leios.Blocks.html#640" class="Field">slotNumber</a>
          <a id="3771" class="Keyword">in</a>
          <a id="3784" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="3786" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="3798" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
          <a id="3816" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3818" href="Leios.VRF.html#1849" class="Function">canProduceEB</a> <a id="3831" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="3836" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="3842" class="Symbol">(</a><a id="3843" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="3849" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="3850" class="Symbol">)</a> <a id="3852" href="Leios.Short.html#1734" class="Generalizable">π</a>
          <a id="3864" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3866" href="Data.List.Relation.Unary.All.html#1639" class="Datatype">All.All</a> <a id="3874" href="Leios.Short.html#3595" class="Bound">P</a> <a id="3876" href="Leios.Short.html#1969" class="Generalizable">ebs</a>
          <a id="3890" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3892" href="Data.List.Relation.Unary.Unique.Setoid.html#785" class="Datatype">Unique</a> <a id="3899" class="Symbol">(</a><a id="3900" href="Leios.Short.html#3738" class="Bound">slots</a> <a id="3906" href="Leios.Short.html#1969" class="Generalizable">ebs</a><a id="3909" class="Symbol">)</a> <a id="3911" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="3913" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="3922" class="Symbol">(</a><a id="3923" href="Leios.Short.html#3738" class="Bound">slots</a> <a id="3929" href="Leios.Short.html#1969" class="Generalizable">ebs</a><a id="3932" class="Symbol">)</a> <a id="3934" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="3937" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="3946" class="Symbol">(</a><a id="3947" href="Leios.Short.html#3738" class="Bound">slots</a> <a id="3953" class="Symbol">(</a><a id="3954" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="3961" href="Leios.Short.html#3595" class="Bound">P</a> <a id="3963" href="Leios.Protocol.html#1586" class="Function">EBs</a><a id="3966" class="Symbol">))</a>
          <a id="3979" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3981" href="Leios.Short.html#3388" class="Function">ffds</a> <a id="3986" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="3993" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="3998" class="Symbol">(</a><a id="3999" href="Leios.Blocks.html#4594" class="InductiveConstructor">ebHeader</a> <a id="4008" href="Leios.Short.html#3547" class="Bound">h</a><a id="4009" class="Symbol">)</a> <a id="4011" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="4019" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="4021" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="4029" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="4032" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
          <a id="4048" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="4132" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4134" href="Leios.Short.html#2677" class="Datatype Operator">↝</a> <a id="4136" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="4146" class="Keyword">record</a> <a id="4153" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4155" class="Symbol">{</a> <a id="4157" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="4166" class="Symbol">=</a> <a id="4168" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a> <a id="4174" class="Symbol">}</a> <a id="4176" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.VT-Role"></a><a id="4198" href="Leios.Short.html#4198" class="InductiveConstructor">VT-Role</a> <a id="4206" class="Symbol">:</a> <a id="4208" class="Keyword">let</a> <a id="4212" class="Keyword">open</a> <a id="4217" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="4228" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4230" class="Keyword">renaming</a> <a id="4239" class="Symbol">(</a><a id="4240" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="4249" class="Symbol">to</a> <a id="4252" class="Field">ffds</a><a id="4256" class="Symbol">)</a>
                <a id="4274" href="Leios.Short.html#4274" class="Bound">EBs&#39;</a> <a id="4279" class="Symbol">=</a> <a id="4281" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="4288" class="Symbol">(</a><a id="4289" href="Leios.Protocol.html#7383" class="Function">allIBRefsKnown</a> <a id="4304" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="4305" class="Symbol">)</a> <a id="4307" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="4309" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="4316" class="Symbol">(</a><a id="4317" href="Leios.Blocks.html#770" class="Function Operator">_∈ᴮ</a> <a id="4321" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="4327" href="Leios.Abstract.html#961" class="Function">L</a> <a id="4329" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="4334" class="Number">1</a><a id="4335" class="Symbol">)</a> <a id="4337" href="Leios.Protocol.html#1586" class="Function">EBs</a>
                <a id="4357" href="Leios.Short.html#4357" class="Bound">votes</a> <a id="4363" class="Symbol">=</a> <a id="4365" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="4369" class="Symbol">(</a><a id="4370" href="Leios.Abstract.html#837" class="Function">vote</a> <a id="4375" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="4381" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="4383" href="Class.Hashable.html#167" class="Field">hash</a><a id="4387" class="Symbol">)</a> <a id="4389" href="Leios.Short.html#4274" class="Bound">EBs&#39;</a>
          <a id="4404" class="Keyword">in</a>
          <a id="4417" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4419" href="Leios.Protocol.html#2535" class="Function">needsUpkeep-Stage</a> <a id="4437" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
          <a id="4455" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4457" href="Leios.VRF.html#2453" class="Function">canProduceV</a> <a id="4469" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="4474" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="4480" class="Symbol">(</a><a id="4481" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="4487" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="4488" class="Symbol">)</a>
          <a id="4500" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4502" href="Leios.Short.html#4252" class="Function">ffds</a> <a id="4507" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="4514" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="4519" class="Symbol">(</a><a id="4520" href="Leios.Blocks.html#4632" class="InductiveConstructor">vtHeader</a> <a id="4529" href="Leios.Short.html#4357" class="Bound">votes</a><a id="4534" class="Symbol">)</a> <a id="4536" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="4544" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="4546" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="4554" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="4557" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
          <a id="4573" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="4657" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4659" href="Leios.Short.html#2677" class="Datatype Operator">↝</a> <a id="4661" href="Leios.Protocol.html#3062" class="Function">addUpkeep-Stage</a> <a id="4677" class="Keyword">record</a> <a id="4684" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4686" class="Symbol">{</a> <a id="4688" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="4697" class="Symbol">=</a> <a id="4699" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a> <a id="4705" class="Symbol">}</a> <a id="4707" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
</pre>#### Negative rules
<pre class="Agda">  <a id="_↝_.No-IB-Role"></a><a id="4749" href="Leios.Short.html#4749" class="InductiveConstructor">No-IB-Role</a> <a id="4760" class="Symbol">:</a> <a id="4762" class="Keyword">let</a> <a id="4766" class="Keyword">open</a> <a id="4771" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="4782" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4784" class="Keyword">in</a>
             <a id="4800" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4802" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="4814" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>
             <a id="4835" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4837" class="Symbol">(∀</a> <a id="4840" href="Leios.Short.html#4840" class="Bound">π</a> <a id="4842" class="Symbol">→</a> <a id="4844" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="4846" href="Leios.VRF.html#1245" class="Function">canProduceIB</a> <a id="4859" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="4864" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="4870" class="Symbol">(</a><a id="4871" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="4877" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="4878" class="Symbol">)</a> <a id="4880" href="Leios.Short.html#4840" class="Bound">π</a><a id="4881" class="Symbol">)</a>
             <a id="4896" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="4955" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4957" href="Leios.Short.html#2677" class="Datatype Operator">↝</a> <a id="4959" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="4969" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="4971" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-EB-Role"></a><a id="4993" href="Leios.Short.html#4993" class="InductiveConstructor">No-EB-Role</a> <a id="5004" class="Symbol">:</a> <a id="5006" class="Keyword">let</a> <a id="5010" class="Keyword">open</a> <a id="5015" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="5026" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5028" class="Keyword">in</a>
             <a id="5044" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5046" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="5058" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
             <a id="5079" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5081" class="Symbol">(∀</a> <a id="5084" href="Leios.Short.html#5084" class="Bound">π</a> <a id="5086" class="Symbol">→</a> <a id="5088" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="5090" href="Leios.VRF.html#1849" class="Function">canProduceEB</a> <a id="5103" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="5108" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="5114" class="Symbol">(</a><a id="5115" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="5121" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="5122" class="Symbol">)</a> <a id="5124" href="Leios.Short.html#5084" class="Bound">π</a><a id="5125" class="Symbol">)</a>
             <a id="5140" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="5199" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5201" href="Leios.Short.html#2677" class="Datatype Operator">↝</a> <a id="5203" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="5213" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5215" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-VT-Role"></a><a id="5237" href="Leios.Short.html#5237" class="InductiveConstructor">No-VT-Role</a> <a id="5248" class="Symbol">:</a> <a id="5250" class="Keyword">let</a> <a id="5254" class="Keyword">open</a> <a id="5259" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="5270" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5272" class="Keyword">in</a>
             <a id="5288" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5290" href="Leios.Protocol.html#2535" class="Function">needsUpkeep-Stage</a> <a id="5308" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
             <a id="5329" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5331" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="5333" href="Leios.VRF.html#2453" class="Function">canProduceV</a> <a id="5345" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="5350" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="5356" class="Symbol">(</a><a id="5357" href="Leios.Protocol.html#3868" class="Function">stake</a> <a id="5363" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="5364" class="Symbol">)</a>
             <a id="5379" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="5438" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5440" href="Leios.Short.html#2677" class="Datatype Operator">↝</a> <a id="5442" href="Leios.Protocol.html#3062" class="Function">addUpkeep-Stage</a> <a id="5458" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="5460" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a>
</pre>### Uniform short-pipeline
<pre class="Agda"><a id="stage"></a><a id="5507" href="Leios.Short.html#5507" class="Function">stage</a> <a id="5513" class="Symbol">:</a> <a id="5515" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5517" class="Symbol">→</a> <a id="5519" class="Symbol">⦃</a> <a id="5521" href="Leios.Short.html#5521" class="Bound">_</a> <a id="5523" class="Symbol">:</a> <a id="5525" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="5533" href="Leios.Abstract.html#961" class="Function">L</a> <a id="5535" class="Symbol">⦄</a> <a id="5537" class="Symbol">→</a> <a id="5539" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="5541" href="Leios.Short.html#5507" class="Function">stage</a> <a id="5547" href="Leios.Short.html#5547" class="Bound">s</a> <a id="5549" class="Symbol">=</a> <a id="5551" href="Leios.Short.html#5547" class="Bound">s</a> <a id="5553" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="5555" href="Leios.Abstract.html#961" class="Function">L</a>

<a id="beginningOfStage"></a><a id="5558" href="Leios.Short.html#5558" class="Function">beginningOfStage</a> <a id="5575" class="Symbol">:</a> <a id="5577" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5579" class="Symbol">→</a> <a id="5581" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5586" href="Leios.Short.html#5558" class="Function">beginningOfStage</a> <a id="5603" href="Leios.Short.html#5603" class="Bound">s</a> <a id="5605" class="Symbol">=</a> <a id="5607" href="Leios.Short.html#5507" class="Function">stage</a> <a id="5613" href="Leios.Short.html#5603" class="Bound">s</a> <a id="5615" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="5617" href="Leios.Abstract.html#961" class="Function">L</a> <a id="5619" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5621" href="Leios.Short.html#5603" class="Bound">s</a>

<a id="endOfStage"></a><a id="5624" href="Leios.Short.html#5624" class="Function">endOfStage</a> <a id="5635" class="Symbol">:</a> <a id="5637" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="5639" class="Symbol">→</a> <a id="5641" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5646" href="Leios.Short.html#5624" class="Function">endOfStage</a> <a id="5657" href="Leios.Short.html#5657" class="Bound">s</a> <a id="5659" class="Symbol">=</a> <a id="5661" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="5665" class="Symbol">(</a><a id="5666" href="Leios.Short.html#5507" class="Function">stage</a> <a id="5672" href="Leios.Short.html#5657" class="Bound">s</a><a id="5673" class="Symbol">)</a> <a id="5675" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="5677" href="Leios.Short.html#5507" class="Function">stage</a> <a id="5683" class="Symbol">(</a><a id="5684" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="5688" href="Leios.Short.html#5657" class="Bound">s</a><a id="5689" class="Symbol">)</a>
</pre>Predicate needed for slot transition. Special care needs to be taken when starting from
genesis.
<pre class="Agda"><a id="allDone"></a><a id="5800" href="Leios.Short.html#5800" class="Function">allDone</a> <a id="5808" class="Symbol">:</a> <a id="5810" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="5821" class="Symbol">→</a> <a id="5823" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5828" href="Leios.Short.html#5800" class="Function">allDone</a> <a id="5836" class="Keyword">record</a> <a id="5843" class="Symbol">{</a> <a id="5845" href="Leios.Protocol.html#1668" class="Field">slot</a> <a id="5850" class="Symbol">=</a> <a id="5852" href="Leios.Short.html#5852" class="Bound">s</a> <a id="5854" class="Symbol">;</a> <a id="5856" href="Leios.Protocol.html#1765" class="Field">Upkeep</a> <a id="5863" class="Symbol">=</a> <a id="5865" href="Leios.Short.html#5865" class="Bound">u</a> <a id="5867" class="Symbol">;</a> <a id="5869" href="Leios.Protocol.html#1801" class="Field">Upkeep-Stage</a> <a id="5882" class="Symbol">=</a> <a id="5884" href="Leios.Short.html#5884" class="Bound">v</a> <a id="5886" class="Symbol">}</a> <a id="5888" class="Symbol">=</a>
  <a id="5892" class="Comment">-- bootstrapping</a>
    <a id="5913" class="Symbol">(</a><a id="5914" href="Leios.Short.html#5507" class="Function">stage</a> <a id="5920" href="Leios.Short.html#5852" class="Bound">s</a> <a id="5922" href="Class.HasOrder.Core.html#555" class="Field Operator">&lt;</a> <a id="5924" class="Number">3</a> <a id="5926" href="Data.Product.Base.html#1618" class="Function Operator">×</a>                        <a id="5951" href="Leios.Short.html#5865" class="Bound">u</a> <a id="5953" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="5956" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5965" class="Symbol">(</a><a id="5966" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>           <a id="5984" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5986" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="5991" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5993" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5995" class="Symbol">))</a>
  <a id="6000" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6002" class="Symbol">(</a><a id="6003" href="Leios.Short.html#5507" class="Function">stage</a> <a id="6009" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6011" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6013" class="Number">3</a> <a id="6015" href="Data.Product.Base.html#1618" class="Function Operator">×</a>   <a id="6019" href="Leios.Short.html#5558" class="Function">beginningOfStage</a> <a id="6036" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6038" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6040" href="Leios.Short.html#5865" class="Bound">u</a> <a id="6042" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6045" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6054" class="Symbol">(</a><a id="6055" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a> <a id="6063" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6065" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a> <a id="6073" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6075" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6080" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6082" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6084" class="Symbol">))</a>
  <a id="6089" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6091" class="Symbol">(</a><a id="6092" href="Leios.Short.html#5507" class="Function">stage</a> <a id="6098" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6100" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="6102" class="Number">3</a> <a id="6104" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6106" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="6108" href="Leios.Short.html#5558" class="Function">beginningOfStage</a> <a id="6125" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6127" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6129" href="Leios.Short.html#5865" class="Bound">u</a> <a id="6131" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6134" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6143" class="Symbol">(</a><a id="6144" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>           <a id="6162" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6164" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6169" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6171" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6173" class="Symbol">))</a>
  <a id="6178" class="Comment">-- done</a>
  <a id="6188" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6190" class="Symbol">(</a><a id="6191" href="Leios.Short.html#5507" class="Function">stage</a> <a id="6197" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6199" href="Class.HasOrder.Core.html#748" class="Function Operator">&gt;</a> <a id="6201" class="Number">3</a> <a id="6203" href="Data.Product.Base.html#1618" class="Function Operator">×</a>   <a id="6207" href="Leios.Short.html#5558" class="Function">beginningOfStage</a> <a id="6224" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6226" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6228" href="Leios.Short.html#5865" class="Bound">u</a> <a id="6230" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6233" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6242" class="Symbol">(</a><a id="6243" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a> <a id="6251" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6253" href="Leios.Short.html#1041" class="InductiveConstructor">EB-Role</a> <a id="6261" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6263" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6268" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6270" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6272" class="Symbol">))</a>
  <a id="6277" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6279" class="Symbol">(</a><a id="6280" href="Leios.Short.html#5507" class="Function">stage</a> <a id="6286" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6288" href="Class.HasOrder.Core.html#748" class="Function Operator">&gt;</a> <a id="6290" class="Number">3</a> <a id="6292" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6294" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="6296" href="Leios.Short.html#5558" class="Function">beginningOfStage</a> <a id="6313" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6315" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6317" href="Leios.Short.html#5865" class="Bound">u</a> <a id="6319" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6322" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6331" class="Symbol">(</a><a id="6332" href="Leios.Short.html#1033" class="InductiveConstructor">IB-Role</a>           <a id="6350" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6352" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a> <a id="6357" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6359" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6361" class="Symbol">)</a> <a id="6363" href="Data.Product.Base.html#1618" class="Function Operator">×</a>
       <a id="6372" class="Symbol">(((</a>  <a id="6377" href="Leios.Short.html#5624" class="Function">endOfStage</a> <a id="6388" href="Leios.Short.html#5852" class="Bound">s</a> <a id="6390" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6392" href="Leios.Short.html#5884" class="Bound">v</a> <a id="6394" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="6397" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="6406" class="Symbol">(</a><a id="6407" href="Leios.Short.html#1201" class="InductiveConstructor">VT-Role</a> <a id="6415" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="6417" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="6419" class="Symbol">))</a>
       <a id="6429" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="6431" class="Symbol">(</a><a id="6432" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="6434" href="Leios.Short.html#5624" class="Function">endOfStage</a> <a id="6445" href="Leios.Short.html#5852" class="Bound">s</a><a id="6446" class="Symbol">))))</a>
</pre>### (Full-)Short Leios transitions
The relation describing the transition given input and state
<pre class="Agda"><a id="6559" class="Keyword">data</a> <a id="_-⟦_/_⟧⇀_"></a><a id="6564" href="Leios.Short.html#6564" class="Datatype Operator">_-⟦_/_⟧⇀_</a> <a id="6574" class="Symbol">:</a> <a id="6576" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6582" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="6593" class="Symbol">→</a> <a id="6595" href="Leios.Protocol.html#1108" class="Datatype">LeiosInput</a> <a id="6606" class="Symbol">→</a> <a id="6608" href="Leios.Protocol.html#1266" class="Datatype">LeiosOutput</a> <a id="6620" class="Symbol">→</a> <a id="6622" href="Leios.Protocol.html#1359" class="Record">LeiosState</a> <a id="6633" class="Symbol">→</a> <a id="6635" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="6640" class="Keyword">where</a>
</pre>#### Initialization
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Init"></a><a id="6680" href="Leios.Short.html#6680" class="InductiveConstructor">Init</a> <a id="6685" class="Symbol">:</a>
       <a id="6694" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="6696" href="Leios.Short.html#1800" class="Generalizable">ks</a> <a id="6699" href="Leios.KeyRegistration.html#476" class="Function Operator">K.-⟦</a> <a id="6704" href="Leios.KeyRegistration.html#302" class="InductiveConstructor">K.INIT</a> <a id="6711" href="Leios.SpecStructure.html#766" class="Field">pk-IB</a> <a id="6717" href="Leios.SpecStructure.html#772" class="Field">pk-EB</a> <a id="6723" href="Leios.SpecStructure.html#778" class="Field">pk-VT</a> <a id="6729" href="Leios.KeyRegistration.html#476" class="Function Operator">/</a> <a id="6731" href="Leios.KeyRegistration.html#374" class="InductiveConstructor">K.PUBKEYS</a> <a id="6741" href="Leios.Short.html#2159" class="Generalizable">pks</a> <a id="6745" href="Leios.KeyRegistration.html#476" class="Function Operator">⟧⇀</a> <a id="6748" href="Leios.Short.html#1803" class="Generalizable">ks&#39;</a>
       <a id="6759" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="6761" href="Leios.SpecStructure.html#904" class="Field">initBaseState</a> <a id="6775" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="6780" href="Leios.Base.html#1390" class="InductiveConstructor">B.INIT</a> <a id="6787" class="Symbol">(</a><a id="6788" href="Leios.Base.html#677" class="Function">V-chkCerts</a> <a id="6799" href="Leios.Short.html#2159" class="Generalizable">pks</a><a id="6802" class="Symbol">)</a> <a id="6804" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="6806" href="Leios.Base.html#2591" class="InductiveConstructor">B.STAKE</a> <a id="6814" href="Leios.Short.html#2122" class="Generalizable">SD</a> <a id="6817" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="6820" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
       <a id="6831" href="Prelude.InferenceRules.html#11981" class="Function Operator">────────────────────────────────────────────────────────────────</a>
       <a id="6903" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="6911" href="Leios.Short.html#6564" class="Datatype Operator">-⟦</a> <a id="6914" href="Leios.Protocol.html#1134" class="InductiveConstructor">INIT</a> <a id="6919" href="Leios.Short.html#2092" class="Generalizable">V</a> <a id="6921" href="Leios.Short.html#6564" class="Datatype Operator">/</a> <a id="6923" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="6929" href="Leios.Short.html#6564" class="Datatype Operator">⟧⇀</a> <a id="6932" href="Leios.Protocol.html#3215" class="Function">initLeiosState</a> <a id="6947" href="Leios.Short.html#2092" class="Generalizable">V</a> <a id="6949" href="Leios.Short.html#2122" class="Generalizable">SD</a> <a id="6952" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a> <a id="6956" href="Leios.Short.html#2159" class="Generalizable">pks</a>
</pre>#### Network and Ledger
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Slot"></a><a id="6998" href="Leios.Short.html#6998" class="InductiveConstructor">Slot</a> <a id="7003" class="Symbol">:</a> <a id="7005" class="Keyword">let</a> <a id="7009" class="Keyword">open</a> <a id="7014" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="7025" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="7027" class="Keyword">renaming</a> <a id="7036" class="Symbol">(</a><a id="7037" href="Leios.Protocol.html#1452" class="Field">FFDState</a> <a id="7046" class="Symbol">to</a> <a id="7049" class="Field">ffds</a><a id="7053" class="Symbol">;</a> <a id="7055" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="7065" class="Symbol">to</a> <a id="7068" class="Field">bs</a><a id="7070" class="Symbol">)</a> <a id="7072" class="Keyword">in</a>
       <a id="7082" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="7084" href="Leios.Short.html#5800" class="Function">allDone</a> <a id="7092" href="Leios.Short.html#1661" class="Generalizable">s</a>
       <a id="7101" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7103" href="Leios.Short.html#7068" class="Function">bs</a> <a id="7106" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="7111" href="Leios.Base.html#1991" class="InductiveConstructor">B.FTCH-LDG</a> <a id="7122" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="7124" href="Leios.Base.html#3167" class="InductiveConstructor">B.BASE-LDG</a> <a id="7135" href="Leios.Short.html#2014" class="Generalizable">rbs</a> <a id="7139" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="7142" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
       <a id="7153" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7155" href="Leios.Short.html#7049" class="Function">ffds</a> <a id="7160" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="7167" href="Leios.FFD.html#351" class="InductiveConstructor">Fetch</a> <a id="7173" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="7175" href="Leios.FFD.html#419" class="InductiveConstructor">FetchRes</a> <a id="7184" href="Leios.Short.html#1834" class="Generalizable">msgs</a> <a id="7189" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="7192" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
       <a id="7205" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
       <a id="7284" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7289" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="7291" href="Leios.Short.html#6564" class="Datatype Operator">-⟦</a> <a id="7294" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="7299" href="Leios.Short.html#6564" class="Datatype Operator">/</a> <a id="7301" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="7307" href="Leios.Short.html#6564" class="Datatype Operator">⟧⇀</a> <a id="7310" class="Keyword">record</a> <a id="7317" href="Leios.Short.html#1661" class="Generalizable">s</a>
           <a id="7330" class="Symbol">{</a> <a id="7332" href="Leios.Protocol.html#1452" class="Field">FFDState</a>     <a id="7345" class="Symbol">=</a> <a id="7347" href="Leios.Short.html#1698" class="Generalizable">ffds&#39;</a>
           <a id="7364" class="Symbol">;</a> <a id="7366" href="Leios.Protocol.html#1838" class="Field">BaseState</a>    <a id="7379" class="Symbol">=</a> <a id="7381" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
           <a id="7396" class="Symbol">;</a> <a id="7398" href="Leios.Protocol.html#1485" class="Field">Ledger</a>       <a id="7411" class="Symbol">=</a> <a id="7413" href="Leios.Protocol.html#2348" class="Function">constructLedger</a> <a id="7429" href="Leios.Short.html#2014" class="Generalizable">rbs</a>
           <a id="7444" class="Symbol">;</a> <a id="7446" href="Leios.Protocol.html#1668" class="Field">slot</a>         <a id="7459" class="Symbol">=</a> <a id="7461" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="7465" href="Leios.Protocol.html#1668" class="Function">slot</a>
           <a id="7481" class="Symbol">;</a> <a id="7483" href="Leios.Protocol.html#1765" class="Field">Upkeep</a>       <a id="7496" class="Symbol">=</a> <a id="7498" href="Class.HasEmptySet.html#287" class="Field">∅</a>
           <a id="7511" class="Symbol">;</a> <a id="7513" href="Leios.Protocol.html#1801" class="Field">Upkeep-Stage</a> <a id="7526" class="Symbol">=</a> <a id="7528" href="Class.Decidable.Core.html#593" class="Function Operator">ifᵈ</a> <a id="7532" class="Symbol">(</a><a id="7533" href="Leios.Short.html#5624" class="Function">endOfStage</a> <a id="7544" href="Leios.Protocol.html#1668" class="Function">slot</a><a id="7548" class="Symbol">)</a> <a id="7550" href="Class.Decidable.Core.html#593" class="Function Operator">then</a> <a id="7555" href="Class.HasEmptySet.html#287" class="Field">∅</a> <a id="7557" href="Class.Decidable.Core.html#593" class="Function Operator">else</a> <a id="7562" href="Leios.Protocol.html#1801" class="Function">Upkeep-Stage</a>
           <a id="7586" class="Symbol">}</a> <a id="7588" href="Leios.Protocol.html#8878" class="Function Operator">↑</a> <a id="7590" href="Data.List.Base.html#10687" class="Function">L.filter</a> <a id="7599" class="Symbol">(</a><a id="7600" href="Leios.Protocol.html#7126" class="Function">isValid?</a> <a id="7609" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="7610" class="Symbol">)</a> <a id="7612" href="Leios.Short.html#1834" class="Generalizable">msgs</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Ftch"></a><a id="7631" href="Leios.Short.html#7631" class="InductiveConstructor">Ftch</a> <a id="7636" class="Symbol">:</a>
       <a id="7645" href="Prelude.InferenceRules.html#42426" class="Function Operator">────────────────────────────────────────────────────────</a>
       <a id="7709" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7714" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="7716" href="Leios.Short.html#6564" class="Datatype Operator">-⟦</a> <a id="7719" href="Leios.Protocol.html#1238" class="InductiveConstructor">FTCH-LDG</a> <a id="7728" href="Leios.Short.html#6564" class="Datatype Operator">/</a> <a id="7730" href="Leios.Protocol.html#1293" class="InductiveConstructor">FTCH-LDG</a> <a id="7739" class="Symbol">(</a><a id="7740" href="Leios.Protocol.html#1485" class="Field">LeiosState.Ledger</a> <a id="7758" href="Leios.Short.html#1661" class="Generalizable">s</a><a id="7759" class="Symbol">)</a> <a id="7761" href="Leios.Short.html#6564" class="Datatype Operator">⟧⇀</a> <a id="7764" href="Leios.Short.html#1661" class="Generalizable">s</a>
</pre>#### Base chain

Note: Submitted data to the base chain is only taken into account
      if the party submitting is the block producer on the base chain
      for the given slot
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₁"></a><a id="7958" href="Leios.Short.html#7958" class="InductiveConstructor">Base₁</a>   <a id="7966" class="Symbol">:</a>
          <a id="7978" href="Prelude.InferenceRules.html#41139" class="Function Operator">───────────────────────────────────────────────────────────────────</a>
          <a id="8056" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8061" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8063" href="Leios.Short.html#6564" class="Datatype Operator">-⟦</a> <a id="8066" href="Leios.Protocol.html#1164" class="InductiveConstructor">SUBMIT</a> <a id="8073" class="Symbol">(</a><a id="8074" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="8079" href="Leios.Short.html#2058" class="Generalizable">txs</a><a id="8082" class="Symbol">)</a> <a id="8084" href="Leios.Short.html#6564" class="Datatype Operator">/</a> <a id="8086" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="8092" href="Leios.Short.html#6564" class="Datatype Operator">⟧⇀</a> <a id="8095" class="Keyword">record</a> <a id="8102" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8104" class="Symbol">{</a> <a id="8106" href="Leios.Protocol.html#1516" class="Field">ToPropose</a> <a id="8116" class="Symbol">=</a> <a id="8118" href="Leios.Short.html#2058" class="Generalizable">txs</a> <a id="8122" class="Symbol">}</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₂a"></a><a id="8138" href="Leios.Short.html#8138" class="InductiveConstructor">Base₂a</a>  <a id="8146" class="Symbol">:</a> <a id="8148" class="Keyword">let</a> <a id="8152" class="Keyword">open</a> <a id="8157" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="8168" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8170" class="Keyword">renaming</a> <a id="8179" class="Symbol">(</a><a id="8180" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="8190" class="Symbol">to</a> <a id="8193" class="Field">bs</a><a id="8195" class="Symbol">)</a> <a id="8197" class="Keyword">in</a>
          <a id="8210" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="8212" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="8224" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>
          <a id="8239" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="8241" href="Leios.Short.html#1929" class="Generalizable">eb</a> <a id="8244" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="8246" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="8253" class="Symbol">(λ</a> <a id="8256" href="Leios.Short.html#8256" class="Bound">x</a> <a id="8258" class="Symbol">→</a> <a id="8260" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="8276" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8278" href="Leios.Short.html#8256" class="Bound">x</a> <a id="8280" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8282" href="Leios.Short.html#8256" class="Bound">x</a> <a id="8284" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="8287" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="8293" href="Leios.Abstract.html#961" class="Function">L</a> <a id="8295" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="8300" class="Number">2</a><a id="8301" class="Symbol">)</a> <a id="8303" href="Leios.Protocol.html#1586" class="Function">EBs</a>
          <a id="8317" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="8319" href="Leios.Short.html#8193" class="Function">bs</a> <a id="8322" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="8327" href="Leios.Base.html#1769" class="InductiveConstructor">B.SUBMIT</a> <a id="8336" class="Symbol">(</a><a id="8337" href="Data.These.Base.html#595" class="InductiveConstructor">this</a> <a id="8342" href="Leios.Short.html#1929" class="Generalizable">eb</a><a id="8344" class="Symbol">)</a> <a id="8346" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="8348" href="Leios.Base.html#2840" class="InductiveConstructor">B.EMPTY</a> <a id="8356" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="8359" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
          <a id="8373" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="8455" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8460" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8462" href="Leios.Short.html#6564" class="Datatype Operator">-⟦</a> <a id="8465" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="8470" href="Leios.Short.html#6564" class="Datatype Operator">/</a> <a id="8472" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="8478" href="Leios.Short.html#6564" class="Datatype Operator">⟧⇀</a> <a id="8481" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="8491" class="Keyword">record</a> <a id="8498" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8500" class="Symbol">{</a> <a id="8502" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="8512" class="Symbol">=</a> <a id="8514" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a> <a id="8518" class="Symbol">}</a> <a id="8520" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>

  <a id="_-⟦_/_⟧⇀_.Base₂b"></a><a id="8528" href="Leios.Short.html#8528" class="InductiveConstructor">Base₂b</a>  <a id="8536" class="Symbol">:</a> <a id="8538" class="Keyword">let</a> <a id="8542" class="Keyword">open</a> <a id="8547" href="Leios.Protocol.html#1359" class="Module">LeiosState</a> <a id="8558" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8560" class="Keyword">renaming</a> <a id="8569" class="Symbol">(</a><a id="8570" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="8580" class="Symbol">to</a> <a id="8583" class="Field">bs</a><a id="8585" class="Symbol">)</a> <a id="8587" class="Keyword">in</a>
          <a id="8600" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="8602" href="Leios.Protocol.html#2475" class="Function">needsUpkeep</a> <a id="8614" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>
          <a id="8629" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="8631" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="8634" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="8636" href="Leios.Prelude.html#1588" class="Function">filter</a> <a id="8643" class="Symbol">(λ</a> <a id="8646" href="Leios.Short.html#8646" class="Bound">x</a> <a id="8648" class="Symbol">→</a> <a id="8650" href="Leios.Short.html#1503" class="Function">isVoteCertified</a> <a id="8666" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8668" href="Leios.Short.html#8646" class="Bound">x</a> <a id="8670" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="8672" href="Leios.Short.html#8646" class="Bound">x</a> <a id="8674" href="Leios.Blocks.html#770" class="Function Operator">∈ᴮ</a> <a id="8677" href="Leios.Prelude.html#1209" class="Function">slice</a> <a id="8683" href="Leios.Abstract.html#961" class="Function">L</a> <a id="8685" href="Leios.Protocol.html#1668" class="Function">slot</a> <a id="8690" class="Number">2</a><a id="8691" class="Symbol">)</a> <a id="8693" href="Leios.Protocol.html#1586" class="Function">EBs</a>
          <a id="8707" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="8709" href="Leios.Short.html#8583" class="Function">bs</a> <a id="8712" href="Leios.Base.html#3276" class="Function Operator">B.-⟦</a> <a id="8717" href="Leios.Base.html#1769" class="InductiveConstructor">B.SUBMIT</a> <a id="8726" class="Symbol">(</a><a id="8727" href="Data.These.Base.html#623" class="InductiveConstructor">that</a> <a id="8732" href="Leios.Protocol.html#1516" class="Function">ToPropose</a><a id="8741" class="Symbol">)</a> <a id="8743" href="Leios.Base.html#3276" class="Function Operator">/</a> <a id="8745" href="Leios.Base.html#2840" class="InductiveConstructor">B.EMPTY</a> <a id="8753" href="Leios.Base.html#3276" class="Function Operator">⟧⇀</a> <a id="8756" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a>
          <a id="8770" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="8852" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="8857" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8859" href="Leios.Short.html#6564" class="Datatype Operator">-⟦</a> <a id="8862" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="8867" href="Leios.Short.html#6564" class="Datatype Operator">/</a> <a id="8869" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="8875" href="Leios.Short.html#6564" class="Datatype Operator">⟧⇀</a> <a id="8878" href="Leios.Protocol.html#2892" class="Function">addUpkeep</a> <a id="8888" class="Keyword">record</a> <a id="8895" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8897" class="Symbol">{</a> <a id="8899" href="Leios.Protocol.html#1838" class="Field">BaseState</a> <a id="8909" class="Symbol">=</a> <a id="8911" href="Leios.Short.html#1766" class="Generalizable">bs&#39;</a> <a id="8915" class="Symbol">}</a> <a id="8917" href="Leios.Short.html#1028" class="InductiveConstructor">Base</a>
</pre>#### Protocol rules
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Roles"></a><a id="8956" href="Leios.Short.html#8956" class="InductiveConstructor">Roles</a> <a id="8962" class="Symbol">:</a>
        <a id="8972" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="8974" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="8976" href="Leios.Short.html#2677" class="Datatype Operator">↝</a> <a id="8978" href="Leios.Short.html#1663" class="Generalizable">s&#39;</a>
        <a id="8989" href="Prelude.InferenceRules.html#13801" class="Function Operator">─────────────────────────────</a>
        <a id="9027" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="9032" href="Leios.Short.html#1661" class="Generalizable">s</a> <a id="9034" href="Leios.Short.html#6564" class="Datatype Operator">-⟦</a> <a id="9037" href="Leios.Protocol.html#1214" class="InductiveConstructor">SLOT</a> <a id="9042" href="Leios.Short.html#6564" class="Datatype Operator">/</a> <a id="9044" href="Leios.Protocol.html#1328" class="InductiveConstructor">EMPTY</a> <a id="9050" href="Leios.Short.html#6564" class="Datatype Operator">⟧⇀</a> <a id="9053" href="Leios.Short.html#1663" class="Generalizable">s&#39;</a>
</pre>
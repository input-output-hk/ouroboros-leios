## Short-Pipeline Leios

<!--
<pre class="Agda"><a id="39" class="Symbol">{-#</a> <a id="43" class="Keyword">OPTIONS</a> <a id="51" class="Pragma">--safe</a> <a id="58" class="Symbol">#-}</a>
<a id="62" class="Keyword">open</a> <a id="67" class="Keyword">import</a> <a id="74" href="Leios.Prelude.html" class="Module">Leios.Prelude</a> <a id="88" class="Keyword">hiding</a> <a id="95" class="Symbol">(</a><a id="96" href="Function.Base.html#704" class="Function">id</a><a id="98" class="Symbol">)</a>
<a id="100" class="Keyword">open</a> <a id="105" class="Keyword">import</a> <a id="112" href="Leios.FFD.html" class="Module">Leios.FFD</a>
<a id="122" class="Keyword">open</a> <a id="127" class="Keyword">import</a> <a id="134" href="Leios.SpecStructure.html" class="Module">Leios.SpecStructure</a>
<a id="154" class="Keyword">open</a> <a id="159" class="Keyword">import</a> <a id="166" href="Data.Fin.Patterns.html" class="Module">Data.Fin.Patterns</a>
<a id="184" class="Keyword">open</a> <a id="189" class="Keyword">import</a> <a id="196" href="Class.ToBool.html" class="Module">Class.ToBool</a>

<a id="210" class="Keyword">open</a> <a id="215" class="Keyword">import</a> <a id="222" href="Tactic.Defaults.html" class="Module">Tactic.Defaults</a>
<a id="238" class="Keyword">open</a> <a id="243" class="Keyword">import</a> <a id="250" href="Tactic.Derive.DecEq.html" class="Module">Tactic.Derive.DecEq</a>

<a id="271" class="Keyword">module</a> <a id="278" href="Leios.Short.html" class="Module">Leios.Short</a> <a id="290" class="Symbol">(</a><a id="291" href="Leios.Short.html#291" class="Bound">⋯</a> <a id="293" class="Symbol">:</a> <a id="295" href="Leios.SpecStructure.html#286" class="Record">SpecStructure</a> <a id="309" class="Number">1</a><a id="310" class="Symbol">)</a>
  <a id="314" class="Symbol">(</a><a id="315" class="Keyword">let</a> <a id="319" class="Keyword">open</a> <a id="324" href="Leios.SpecStructure.html#286" class="Module">SpecStructure</a> <a id="338" href="Leios.Short.html#291" class="Bound">⋯</a> <a id="340" class="Keyword">renaming</a> <a id="349" class="Symbol">(</a><a id="350" href="Leios.Voting.html#203" class="Function">isVoteCertified</a> <a id="366" class="Symbol">to</a> <a id="369" class="Function">isVoteCertified&#39;</a><a id="385" class="Symbol">))</a> <a id="388" class="Keyword">where</a>
</pre>-->

This document is a specification of Short-Pipeline Leios, usually
abbreviated as Short Leios. On a high level, the pipeline looks like this:

1. If elected, propose IB
2. Wait
3. Wait
4. If elected, propose EB
5. If elected, vote
   If elected, propose RB

### Upkeep

A node that never produces a block even though it could is not
supposed to be an honest node, and we prevent that by tracking whether
a node has checked if it can make a block in a particular slot.
`LeiosState` contains a set of `SlotUpkeep` and we ensure that this
set contains all elements before we can advance to the next slot,
resetting this field to the empty set.

<pre class="Agda"><a id="1052" class="Keyword">data</a> <a id="SlotUpkeep"></a><a id="1057" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a> <a id="1068" class="Symbol">:</a> <a id="1070" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="1075" class="Keyword">where</a>
  <a id="SlotUpkeep.Base"></a><a id="1083" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a> <a id="SlotUpkeep.IB-Role"></a><a id="1088" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a> <a id="SlotUpkeep.EB-Role"></a><a id="1096" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a> <a id="SlotUpkeep.VT-Role"></a><a id="1104" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a> <a id="1112" class="Symbol">:</a> <a id="1114" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a>
</pre><!--
<pre class="Agda"><a id="1142" class="Keyword">unquoteDecl</a> <a id="DecEq-SlotUpkeep"></a><a id="1154" href="Leios.Short.html#1154" class="Function">DecEq-SlotUpkeep</a> <a id="1171" class="Symbol">=</a> <a id="1173" href="Tactic.Derive.DecEq.html#3512" class="Function">derive-DecEq</a> <a id="1186" class="Symbol">((</a><a id="1188" class="Keyword">quote</a> <a id="1194" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a> <a id="1205" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1207" href="Leios.Short.html#1154" class="Function">DecEq-SlotUpkeep</a><a id="1223" class="Symbol">)</a> <a id="1225" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="1227" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="1229" class="Symbol">)</a>

<a id="1232" class="Keyword">open</a> <a id="1237" class="Keyword">import</a> <a id="1244" href="Leios.Protocol.html" class="Module">Leios.Protocol</a> <a id="1259" class="Symbol">(</a><a id="1260" href="Leios.Short.html#291" class="Bound">⋯</a><a id="1261" class="Symbol">)</a> <a id="1263" href="Leios.Short.html#1057" class="Datatype">SlotUpkeep</a> <a id="1274" class="Keyword">public</a>
<a id="1281" class="Keyword">open</a> <a id="1286" href="Leios.Base.html#389" class="Module">BaseAbstract</a> <a id="1299" href="Leios.SpecStructure.html#835" class="Field">B&#39;</a> <a id="1302" class="Keyword">using</a> <a id="1308" class="Symbol">(</a><a id="1309" href="Leios.Base.html#424" class="Field">Cert</a><a id="1313" class="Symbol">;</a> <a id="1315" href="Leios.Base.html#490" class="Field">V-chkCerts</a><a id="1325" class="Symbol">;</a> <a id="1327" href="Leios.Base.html#444" class="Field">VTy</a><a id="1330" class="Symbol">;</a> <a id="1332" href="Leios.Base.html#463" class="Field">initSlot</a><a id="1340" class="Symbol">)</a>
<a id="1342" class="Keyword">open</a> <a id="1347" href="Leios.SpecStructure.html#1203" class="Module">FFD</a> <a id="1351" class="Keyword">hiding</a> <a id="1358" class="Symbol">(</a><a id="1359" href="Leios.FFD.html#562" class="Function Operator">_-⟦_/_⟧⇀_</a><a id="1368" class="Symbol">)</a>
<a id="1370" class="Keyword">open</a> <a id="1375" href="Leios.Blocks.html#4246" class="Module">GenFFD</a>
</pre><pre class="Agda"><a id="isVoteCertified"></a><a id="1394" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="1410" class="Symbol">:</a> <a id="1412" href="Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="1423" class="Symbol">→</a> <a id="1425" href="Leios.Blocks.html#2804" class="Function">EndorserBlock</a> <a id="1439" class="Symbol">→</a> <a id="1441" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="1446" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="1462" href="Leios.Short.html#1462" class="Bound">s</a> <a id="1464" href="Leios.Short.html#1464" class="Bound">eb</a> <a id="1467" class="Symbol">=</a> <a id="1469" href="Leios.Short.html#369" class="Function">isVoteCertified&#39;</a> <a id="1486" class="Symbol">(</a><a id="1487" href="Leios.Protocol.html#1419" class="Field">LeiosState.votingState</a> <a id="1510" href="Leios.Short.html#1462" class="Bound">s</a><a id="1511" class="Symbol">)</a> <a id="1513" class="Symbol">(</a><a id="1514" href="Data.Fin.Patterns.html#399" class="InductiveConstructor">0F</a> <a id="1517" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">,</a> <a id="1519" href="Leios.Short.html#1464" class="Bound">eb</a><a id="1521" class="Symbol">)</a>
</pre><pre class="Agda"><a id="1535" class="Keyword">private</a> <a id="1543" class="Keyword">variable</a> <a id="1552" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="1554" href="Leios.Short.html#1554" class="Generalizable">s&#39;</a>   <a id="1559" class="Symbol">:</a> <a id="1561" href="Leios.Protocol.html#959" class="Record">LeiosState</a>
                 <a id="1589" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>  <a id="1596" class="Symbol">:</a> <a id="1598" href="Leios.FFD.html#508" class="Function">FFD.State</a>
                 <a id="1625" href="Leios.Short.html#1625" class="Generalizable">π</a>      <a id="1632" class="Symbol">:</a> <a id="1634" href="Leios.Abstract.html#245" class="Function">VrfPf</a>
                 <a id="1657" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>    <a id="1664" class="Symbol">:</a> <a id="1666" href="Leios.Base.html#847" class="Function">B.State</a>
                 <a id="1691" href="Leios.Short.html#1691" class="Generalizable">ks</a> <a id="1694" href="Leios.Short.html#1694" class="Generalizable">ks&#39;</a> <a id="1698" class="Symbol">:</a> <a id="1700" href="Leios.KeyRegistration.html#453" class="Function">K.State</a>
                 <a id="1725" href="Leios.Short.html#1725" class="Generalizable">msgs</a>   <a id="1732" class="Symbol">:</a> <a id="1734" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1739" class="Symbol">(</a><a id="1740" href="Leios.FFD.html#117" class="Field">FFDAbstract.Header</a> <a id="1759" href="Leios.Blocks.html#5294" class="Function">ffdAbstract</a> <a id="1771" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="1773" href="Leios.FFD.html#124" class="Field">FFDAbstract.Body</a> <a id="1790" href="Leios.Blocks.html#5294" class="Function">ffdAbstract</a><a id="1801" class="Symbol">)</a>
                 <a id="1820" href="Leios.Short.html#1820" class="Generalizable">eb</a>     <a id="1827" class="Symbol">:</a> <a id="1829" href="Leios.Blocks.html#2804" class="Function">EndorserBlock</a>
                 <a id="1860" href="Leios.Short.html#1860" class="Generalizable">rbs</a>    <a id="1867" class="Symbol">:</a> <a id="1869" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1874" href="Leios.Base.html#316" class="Function">RankingBlock</a>
                 <a id="1904" href="Leios.Short.html#1904" class="Generalizable">txs</a>    <a id="1911" class="Symbol">:</a> <a id="1913" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="1918" href="Leios.Abstract.html#124" class="Function">Tx</a>
                 <a id="1938" href="Leios.Short.html#1938" class="Generalizable">V</a>      <a id="1945" class="Symbol">:</a> <a id="1947" href="Leios.Base.html#444" class="Function">VTy</a>
                 <a id="1968" href="Leios.Short.html#1968" class="Generalizable">SD</a>     <a id="1975" class="Symbol">:</a> <a id="1977" href="Leios.Base.html#266" class="Function">StakeDistr</a>
                 <a id="2005" href="Leios.Short.html#2005" class="Generalizable">pks</a>    <a id="2012" class="Symbol">:</a> <a id="2014" href="Agda.Builtin.List.html#147" class="Datatype">List</a> <a id="2019" href="Leios.VRF.html#480" class="Function">PubKey</a>
</pre>-->

### Block/Vote production rules

We now define the rules for block production given by the relation `_↝_`. These are split in two:

1. Positive rules, when we do need to create a block.
2. Negative rules, when we cannot create a block.

The purpose of the negative rules is to properly adjust the upkeep if
we cannot make a block.

Note that `_↝_`, starting with an empty upkeep can always make exactly
three steps corresponding to the three types of Leios specific blocks.

<pre class="Agda"><a id="2518" class="Keyword">data</a> <a id="_↝_"></a><a id="2523" href="Leios.Short.html#2523" class="Datatype Operator">_↝_</a> <a id="2527" class="Symbol">:</a> <a id="2529" href="Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="2540" class="Symbol">→</a> <a id="2542" href="Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="2553" class="Symbol">→</a> <a id="2555" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="2560" class="Keyword">where</a>
</pre>#### Positive rules
<pre class="Agda">  <a id="_↝_.IB-Role"></a><a id="2600" href="Leios.Short.html#2600" class="InductiveConstructor">IB-Role</a> <a id="2608" class="Symbol">:</a> <a id="2610" class="Keyword">let</a> <a id="2614" class="Keyword">open</a> <a id="2619" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="2630" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="2632" class="Keyword">renaming</a> <a id="2641" class="Symbol">(</a><a id="2642" href="Leios.Protocol.html#1050" class="Field">FFDState</a> <a id="2651" class="Symbol">to</a> <a id="2654" class="Field">ffds</a><a id="2658" class="Symbol">)</a>
                <a id="2676" href="Leios.Short.html#2676" class="Bound">b</a> <a id="2678" class="Symbol">=</a> <a id="2680" href="Leios.Blocks.html#4449" class="InductiveConstructor">ibBody</a> <a id="2687" class="Symbol">(</a><a id="2688" class="Keyword">record</a> <a id="2695" class="Symbol">{</a> <a id="2697" href="Leios.Blocks.html#1083" class="Field">txs</a> <a id="2701" class="Symbol">=</a> <a id="2703" href="Leios.Protocol.html#1112" class="Function">ToPropose</a> <a id="2713" class="Symbol">})</a>
                <a id="2732" href="Leios.Short.html#2732" class="Bound">h</a> <a id="2734" class="Symbol">=</a> <a id="2736" href="Leios.Blocks.html#4318" class="InductiveConstructor">ibHeader</a> <a id="2745" class="Symbol">(</a><a id="2746" href="Leios.Blocks.html#1898" class="Function">mkIBHeader</a> <a id="2757" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="2762" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="2765" href="Leios.Short.html#1625" class="Generalizable">π</a> <a id="2767" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="2773" href="Leios.Protocol.html#1112" class="Function">ToPropose</a><a id="2782" class="Symbol">)</a>
          <a id="2794" class="Keyword">in</a>
          <a id="2807" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="2809" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="2821" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
          <a id="2839" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="2841" href="Leios.VRF.html#814" class="Function">canProduceIB</a> <a id="2854" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="2859" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="2865" class="Symbol">(</a><a id="2866" href="Leios.Protocol.html#2995" class="Function">stake</a> <a id="2872" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="2873" class="Symbol">)</a> <a id="2875" href="Leios.Short.html#1625" class="Generalizable">π</a>
          <a id="2887" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="2889" href="Leios.Short.html#2654" class="Function">ffds</a> <a id="2894" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="2901" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="2906" href="Leios.Short.html#2732" class="Bound">h</a> <a id="2908" class="Symbol">(</a><a id="2909" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="2914" href="Leios.Short.html#2676" class="Bound">b</a><a id="2915" class="Symbol">)</a> <a id="2917" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="2919" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="2927" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="2930" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
          <a id="2946" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="3030" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3032" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="3034" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="3044" class="Keyword">record</a> <a id="3051" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3053" class="Symbol">{</a> <a id="3055" href="Leios.Protocol.html#1050" class="Field">FFDState</a> <a id="3064" class="Symbol">=</a> <a id="3066" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a> <a id="3072" class="Symbol">}</a> <a id="3074" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.EB-Role"></a><a id="3096" href="Leios.Short.html#3096" class="InductiveConstructor">EB-Role</a> <a id="3104" class="Symbol">:</a> <a id="3106" class="Keyword">let</a> <a id="3110" class="Keyword">open</a> <a id="3115" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="3126" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3128" class="Keyword">renaming</a> <a id="3137" class="Symbol">(</a><a id="3138" href="Leios.Protocol.html#1050" class="Field">FFDState</a> <a id="3147" class="Symbol">to</a> <a id="3150" class="Field">ffds</a><a id="3154" class="Symbol">)</a>
                <a id="3172" href="Leios.Short.html#3172" class="Bound">LI</a> <a id="3175" class="Symbol">=</a> <a id="3177" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="3181" href="Leios.Blocks.html#2304" class="Function">getIBRef</a> <a id="3190" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3192" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="3199" class="Symbol">(</a><a id="3200" href="Leios.Blocks.html#527" class="Function Operator">_∈ᴮ</a> <a id="3204" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="3210" href="Leios.Abstract.html#628" class="Function">L</a> <a id="3212" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="3217" class="Number">3</a><a id="3218" class="Symbol">)</a> <a id="3220" href="Leios.Protocol.html#1142" class="Function">IBs</a>
                <a id="3240" href="Leios.Short.html#3240" class="Bound">h</a> <a id="3242" class="Symbol">=</a> <a id="3244" href="Leios.Blocks.html#3335" class="Function">mkEB</a> <a id="3249" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="3254" href="Leios.SpecStructure.html#601" class="Field">id</a> <a id="3257" href="Leios.Short.html#1625" class="Generalizable">π</a> <a id="3259" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="3265" href="Leios.Short.html#3172" class="Bound">LI</a> <a id="3268" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a>
          <a id="3281" class="Keyword">in</a>
          <a id="3294" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="3296" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="3308" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
          <a id="3326" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3328" href="Leios.VRF.html#1418" class="Function">canProduceEB</a> <a id="3341" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="3346" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="3352" class="Symbol">(</a><a id="3353" href="Leios.Protocol.html#2995" class="Function">stake</a> <a id="3359" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="3360" class="Symbol">)</a> <a id="3362" href="Leios.Short.html#1625" class="Generalizable">π</a>
          <a id="3374" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3376" href="Leios.Short.html#3150" class="Function">ffds</a> <a id="3381" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="3388" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="3393" class="Symbol">(</a><a id="3394" href="Leios.Blocks.html#4351" class="InductiveConstructor">ebHeader</a> <a id="3403" href="Leios.Short.html#3240" class="Bound">h</a><a id="3404" class="Symbol">)</a> <a id="3406" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="3414" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="3416" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="3424" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="3427" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
          <a id="3443" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="3527" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3529" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="3531" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="3541" class="Keyword">record</a> <a id="3548" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3550" class="Symbol">{</a> <a id="3552" href="Leios.Protocol.html#1050" class="Field">FFDState</a> <a id="3561" class="Symbol">=</a> <a id="3563" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a> <a id="3569" class="Symbol">}</a> <a id="3571" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.VT-Role"></a><a id="3593" href="Leios.Short.html#3593" class="InductiveConstructor">VT-Role</a> <a id="3601" class="Symbol">:</a> <a id="3603" class="Keyword">let</a> <a id="3607" class="Keyword">open</a> <a id="3612" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="3623" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="3625" class="Keyword">renaming</a> <a id="3634" class="Symbol">(</a><a id="3635" href="Leios.Protocol.html#1050" class="Field">FFDState</a> <a id="3644" class="Symbol">to</a> <a id="3647" class="Field">ffds</a><a id="3651" class="Symbol">)</a>
                <a id="3669" href="Leios.Short.html#3669" class="Bound">EBs&#39;</a> <a id="3674" class="Symbol">=</a> <a id="3676" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="3683" class="Symbol">(</a><a id="3684" href="Leios.Protocol.html#6510" class="Function">allIBRefsKnown</a> <a id="3699" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="3700" class="Symbol">)</a> <a id="3702" href="Function.Base.html#1974" class="Function Operator">$</a> <a id="3704" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="3711" class="Symbol">(</a><a id="3712" href="Leios.Blocks.html#527" class="Function Operator">_∈ᴮ</a> <a id="3716" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="3722" href="Leios.Abstract.html#628" class="Function">L</a> <a id="3724" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="3729" class="Number">1</a><a id="3730" class="Symbol">)</a> <a id="3732" href="Leios.Protocol.html#1180" class="Function">EBs</a>
                <a id="3752" href="Leios.Short.html#3752" class="Bound">votes</a> <a id="3758" class="Symbol">=</a> <a id="3760" href="abstract-set-theory.Prelude.html#1824" class="Function">map</a> <a id="3764" class="Symbol">(</a><a id="3765" href="Leios.Abstract.html#504" class="Function">vote</a> <a id="3770" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="3776" href="Function.Base.html#1115" class="Function Operator">∘</a> <a id="3778" href="Class.Hashable.html#167" class="Field">hash</a><a id="3782" class="Symbol">)</a> <a id="3784" href="Leios.Short.html#3669" class="Bound">EBs&#39;</a>
          <a id="3799" class="Keyword">in</a>
          <a id="3812" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="3814" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="3826" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
          <a id="3844" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3846" href="Leios.VRF.html#2022" class="Function">canProduceV</a> <a id="3858" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="3863" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="3869" class="Symbol">(</a><a id="3870" href="Leios.Protocol.html#2995" class="Function">stake</a> <a id="3876" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="3877" class="Symbol">)</a>
          <a id="3889" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="3891" href="Leios.Short.html#3647" class="Function">ffds</a> <a id="3896" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="3903" href="Leios.FFD.html#311" class="InductiveConstructor">Send</a> <a id="3908" class="Symbol">(</a><a id="3909" href="Leios.Blocks.html#4389" class="InductiveConstructor">vtHeader</a> <a id="3918" href="Leios.Short.html#3752" class="Bound">votes</a><a id="3923" class="Symbol">)</a> <a id="3925" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="3933" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="3935" href="Leios.FFD.html#397" class="InductiveConstructor">SendRes</a> <a id="3943" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="3946" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
          <a id="3962" href="Prelude.InferenceRules.html#11315" class="Function Operator">─────────────────────────────────────────────────────────────────────────</a>
          <a id="4046" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4048" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4050" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="4060" class="Keyword">record</a> <a id="4067" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4069" class="Symbol">{</a> <a id="4071" href="Leios.Protocol.html#1050" class="Field">FFDState</a> <a id="4080" class="Symbol">=</a> <a id="4082" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a> <a id="4088" class="Symbol">}</a> <a id="4090" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
</pre>#### Negative rules
<pre class="Agda">  <a id="_↝_.No-IB-Role"></a><a id="4132" href="Leios.Short.html#4132" class="InductiveConstructor">No-IB-Role</a> <a id="4143" class="Symbol">:</a> <a id="4145" class="Keyword">let</a> <a id="4149" class="Keyword">open</a> <a id="4154" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="4165" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4167" class="Keyword">in</a>
             <a id="4183" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4185" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="4197" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
             <a id="4218" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4220" class="Symbol">(∀</a> <a id="4223" href="Leios.Short.html#4223" class="Bound">π</a> <a id="4225" class="Symbol">→</a> <a id="4227" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="4229" href="Leios.VRF.html#814" class="Function">canProduceIB</a> <a id="4242" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="4247" href="Leios.SpecStructure.html#730" class="Field">sk-IB</a> <a id="4253" class="Symbol">(</a><a id="4254" href="Leios.Protocol.html#2995" class="Function">stake</a> <a id="4260" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="4261" class="Symbol">)</a> <a id="4263" href="Leios.Short.html#4223" class="Bound">π</a><a id="4264" class="Symbol">)</a>
             <a id="4279" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="4338" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4340" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4342" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="4352" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4354" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-EB-Role"></a><a id="4376" href="Leios.Short.html#4376" class="InductiveConstructor">No-EB-Role</a> <a id="4387" class="Symbol">:</a> <a id="4389" class="Keyword">let</a> <a id="4393" class="Keyword">open</a> <a id="4398" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="4409" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4411" class="Keyword">in</a>
             <a id="4427" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4429" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="4441" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
             <a id="4462" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4464" class="Symbol">(∀</a> <a id="4467" href="Leios.Short.html#4467" class="Bound">π</a> <a id="4469" class="Symbol">→</a> <a id="4471" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="4473" href="Leios.VRF.html#1418" class="Function">canProduceEB</a> <a id="4486" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="4491" href="Leios.SpecStructure.html#736" class="Field">sk-EB</a> <a id="4497" class="Symbol">(</a><a id="4498" href="Leios.Protocol.html#2995" class="Function">stake</a> <a id="4504" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="4505" class="Symbol">)</a> <a id="4507" href="Leios.Short.html#4467" class="Bound">π</a><a id="4508" class="Symbol">)</a>
             <a id="4523" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="4582" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4584" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4586" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="4596" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4598" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a>
</pre><pre class="Agda">  <a id="_↝_.No-VT-Role"></a><a id="4620" href="Leios.Short.html#4620" class="InductiveConstructor">No-VT-Role</a> <a id="4631" class="Symbol">:</a> <a id="4633" class="Keyword">let</a> <a id="4637" class="Keyword">open</a> <a id="4642" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="4653" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4655" class="Keyword">in</a>
             <a id="4671" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="4673" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="4685" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
             <a id="4706" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="4708" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="4710" href="Leios.VRF.html#2022" class="Function">canProduceV</a> <a id="4722" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="4727" href="Leios.SpecStructure.html#742" class="Field">sk-VT</a> <a id="4733" class="Symbol">(</a><a id="4734" href="Leios.Protocol.html#2995" class="Function">stake</a> <a id="4740" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="4741" class="Symbol">)</a>
             <a id="4756" href="Prelude.InferenceRules.html#13121" class="Function Operator">─────────────────────────────────────────────</a>
             <a id="4815" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4817" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="4819" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="4829" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="4831" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a>
</pre>### Uniform short-pipeline
<pre class="Agda"><a id="stage"></a><a id="4878" href="Leios.Short.html#4878" class="Function">stage</a> <a id="4884" class="Symbol">:</a> <a id="4886" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="4888" class="Symbol">→</a> <a id="4890" class="Symbol">⦃</a> <a id="4892" href="Leios.Short.html#4892" class="Bound">_</a> <a id="4894" class="Symbol">:</a> <a id="4896" href="Data.Nat.Base.html#3260" class="Record">NonZero</a> <a id="4904" href="Leios.Abstract.html#628" class="Function">L</a> <a id="4906" class="Symbol">⦄</a> <a id="4908" class="Symbol">→</a> <a id="4910" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a>
<a id="4912" href="Leios.Short.html#4878" class="Function">stage</a> <a id="4918" href="Leios.Short.html#4918" class="Bound">s</a> <a id="4920" class="Symbol">=</a> <a id="4922" href="Leios.Short.html#4918" class="Bound">s</a> <a id="4924" href="Data.Nat.Base.html#7096" class="Function Operator">/</a> <a id="4926" href="Leios.Abstract.html#628" class="Function">L</a>

<a id="beginningOfStage"></a><a id="4929" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="4946" class="Symbol">:</a> <a id="4948" href="Agda.Builtin.Nat.html#203" class="Datatype">ℕ</a> <a id="4950" class="Symbol">→</a> <a id="4952" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="4957" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="4974" href="Leios.Short.html#4974" class="Bound">s</a> <a id="4976" class="Symbol">=</a> <a id="4978" href="Leios.Short.html#4878" class="Function">stage</a> <a id="4984" href="Leios.Short.html#4974" class="Bound">s</a> <a id="4986" href="Agda.Builtin.Nat.html#539" class="Primitive Operator">*</a> <a id="4988" href="Leios.Abstract.html#628" class="Function">L</a> <a id="4990" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="4992" href="Leios.Short.html#4974" class="Bound">s</a>

<a id="allDone"></a><a id="4995" href="Leios.Short.html#4995" class="Function">allDone</a> <a id="5003" class="Symbol">:</a> <a id="5005" href="Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="5016" class="Symbol">→</a> <a id="5018" href="Agda.Primitive.html#388" class="Primitive">Type</a>
<a id="5023" href="Leios.Short.html#4995" class="Function">allDone</a> <a id="5031" href="Leios.Short.html#5031" class="Bound">s</a> <a id="5033" class="Symbol">=</a>
  <a id="5037" class="Keyword">let</a> <a id="5041" class="Keyword">open</a> <a id="5046" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="5057" href="Leios.Short.html#5031" class="Bound">s</a>
  <a id="5061" class="Keyword">in</a>   <a id="5066" class="Symbol">(</a><a id="5067" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="5084" href="Leios.Protocol.html#1260" class="Field">slot</a> <a id="5089" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5091" href="Leios.Protocol.html#1354" class="Field">Upkeep</a> <a id="5098" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="5101" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5110" class="Symbol">(</a><a id="5111" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a> <a id="5119" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5121" href="Leios.Short.html#1096" class="InductiveConstructor">EB-Role</a> <a id="5129" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5131" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a> <a id="5139" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5141" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a> <a id="5146" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5148" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5150" class="Symbol">))</a>
   <a id="5156" href="Data.Sum.Base.html#625" class="Datatype Operator">⊎</a> <a id="5158" class="Symbol">(</a><a id="5159" href="Relation.Nullary.Negation.Core.html#658" class="Function Operator">¬</a> <a id="5161" href="Leios.Short.html#4929" class="Function">beginningOfStage</a> <a id="5178" href="Leios.Protocol.html#1260" class="Field">slot</a> <a id="5183" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="5185" href="Leios.Protocol.html#1354" class="Field">Upkeep</a> <a id="5192" href="Axiom.Set.html#2587" class="Function Operator">≡ᵉ</a> <a id="5195" href="Axiom.Set.html#5718" class="Function">fromList</a> <a id="5204" class="Symbol">(</a><a id="5205" href="Leios.Short.html#1088" class="InductiveConstructor">IB-Role</a> <a id="5213" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5215" href="Leios.Short.html#1104" class="InductiveConstructor">VT-Role</a> <a id="5223" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5225" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a> <a id="5230" href="Agda.Builtin.List.html#199" class="InductiveConstructor Operator">∷</a> <a id="5232" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a><a id="5234" class="Symbol">))</a>

<a id="5238" class="Keyword">data</a> <a id="_-⟦_/_⟧⇀_"></a><a id="5243" href="Leios.Short.html#5243" class="Datatype Operator">_-⟦_/_⟧⇀_</a> <a id="5253" class="Symbol">:</a> <a id="5255" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="5261" href="Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="5272" class="Symbol">→</a> <a id="5274" href="Leios.Protocol.html#708" class="Datatype">LeiosInput</a> <a id="5285" class="Symbol">→</a> <a id="5287" href="Leios.Protocol.html#866" class="Datatype">LeiosOutput</a> <a id="5299" class="Symbol">→</a> <a id="5301" href="Leios.Protocol.html#959" class="Record">LeiosState</a> <a id="5312" class="Symbol">→</a> <a id="5314" href="Agda.Primitive.html#388" class="Primitive">Type</a> <a id="5319" class="Keyword">where</a>
</pre>#### Initialization
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Init"></a><a id="5359" href="Leios.Short.html#5359" class="InductiveConstructor">Init</a> <a id="5364" class="Symbol">:</a>
       <a id="5373" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5375" href="Leios.Short.html#1691" class="Generalizable">ks</a> <a id="5378" href="Leios.KeyRegistration.html#476" class="Function Operator">K.-⟦</a> <a id="5383" href="Leios.KeyRegistration.html#302" class="InductiveConstructor">K.INIT</a> <a id="5390" href="Leios.SpecStructure.html#766" class="Field">pk-IB</a> <a id="5396" href="Leios.SpecStructure.html#772" class="Field">pk-EB</a> <a id="5402" href="Leios.SpecStructure.html#778" class="Field">pk-VT</a> <a id="5408" href="Leios.KeyRegistration.html#476" class="Function Operator">/</a> <a id="5410" href="Leios.KeyRegistration.html#374" class="InductiveConstructor">K.PUBKEYS</a> <a id="5420" href="Leios.Short.html#2005" class="Generalizable">pks</a> <a id="5424" href="Leios.KeyRegistration.html#476" class="Function Operator">⟧⇀</a> <a id="5427" href="Leios.Short.html#1694" class="Generalizable">ks&#39;</a>
       <a id="5438" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5440" href="Leios.SpecStructure.html#904" class="Field">initBaseState</a> <a id="5454" href="Leios.Base.html#870" class="Function Operator">B.-⟦</a> <a id="5459" href="Leios.Base.html#576" class="InductiveConstructor">B.INIT</a> <a id="5466" class="Symbol">(</a><a id="5467" href="Leios.Base.html#490" class="Function">V-chkCerts</a> <a id="5478" href="Leios.Short.html#2005" class="Generalizable">pks</a><a id="5481" class="Symbol">)</a> <a id="5483" href="Leios.Base.html#870" class="Function Operator">/</a> <a id="5485" href="Leios.Base.html#710" class="InductiveConstructor">B.STAKE</a> <a id="5493" href="Leios.Short.html#1968" class="Generalizable">SD</a> <a id="5496" href="Leios.Base.html#870" class="Function Operator">⟧⇀</a> <a id="5499" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
       <a id="5510" href="Prelude.InferenceRules.html#11981" class="Function Operator">────────────────────────────────────────────────────────────────</a>
       <a id="5582" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5590" href="Leios.Short.html#5243" class="Datatype Operator">-⟦</a> <a id="5593" href="Leios.Protocol.html#734" class="InductiveConstructor">INIT</a> <a id="5598" href="Leios.Short.html#1938" class="Generalizable">V</a> <a id="5600" href="Leios.Short.html#5243" class="Datatype Operator">/</a> <a id="5602" href="Leios.Protocol.html#928" class="InductiveConstructor">EMPTY</a> <a id="5608" href="Leios.Short.html#5243" class="Datatype Operator">⟧⇀</a> <a id="5611" href="Leios.Protocol.html#2378" class="Function">initLeiosState</a> <a id="5626" href="Leios.Short.html#1938" class="Generalizable">V</a> <a id="5628" href="Leios.Short.html#1968" class="Generalizable">SD</a> <a id="5631" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a> <a id="5635" href="Leios.Short.html#2005" class="Generalizable">pks</a>
</pre>#### Network and Ledger
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Slot"></a><a id="5677" href="Leios.Short.html#5677" class="InductiveConstructor">Slot</a> <a id="5682" class="Symbol">:</a> <a id="5684" class="Keyword">let</a> <a id="5688" class="Keyword">open</a> <a id="5693" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="5704" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="5706" class="Keyword">renaming</a> <a id="5715" class="Symbol">(</a><a id="5716" href="Leios.Protocol.html#1050" class="Field">FFDState</a> <a id="5725" class="Symbol">to</a> <a id="5728" class="Field">ffds</a><a id="5732" class="Symbol">;</a> <a id="5734" href="Leios.Protocol.html#1389" class="Field">BaseState</a> <a id="5744" class="Symbol">to</a> <a id="5747" class="Field">bs</a><a id="5749" class="Symbol">)</a> <a id="5751" class="Keyword">in</a>
       <a id="5761" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="5763" href="Leios.Short.html#4995" class="Function">allDone</a> <a id="5771" href="Leios.Short.html#1552" class="Generalizable">s</a>
       <a id="5780" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5782" href="Leios.Short.html#5747" class="Function">bs</a> <a id="5785" href="Leios.Base.html#870" class="Function Operator">B.-⟦</a> <a id="5790" href="Leios.Base.html#661" class="InductiveConstructor">B.FTCH-LDG</a> <a id="5801" href="Leios.Base.html#870" class="Function Operator">/</a> <a id="5803" href="Leios.Base.html#761" class="InductiveConstructor">B.BASE-LDG</a> <a id="5814" href="Leios.Short.html#1860" class="Generalizable">rbs</a> <a id="5818" href="Leios.Base.html#870" class="Function Operator">⟧⇀</a> <a id="5821" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
       <a id="5832" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="5834" href="Leios.Short.html#5728" class="Function">ffds</a> <a id="5839" href="Leios.FFD.html#562" class="Function Operator">FFD.-⟦</a> <a id="5846" href="Leios.FFD.html#351" class="InductiveConstructor">Fetch</a> <a id="5852" href="Leios.FFD.html#562" class="Function Operator">/</a> <a id="5854" href="Leios.FFD.html#419" class="InductiveConstructor">FetchRes</a> <a id="5863" href="Leios.Short.html#1725" class="Generalizable">msgs</a> <a id="5868" href="Leios.FFD.html#562" class="Function Operator">⟧⇀</a> <a id="5871" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
       <a id="5884" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
       <a id="5963" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5968" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="5970" href="Leios.Short.html#5243" class="Datatype Operator">-⟦</a> <a id="5973" href="Leios.Protocol.html#814" class="InductiveConstructor">SLOT</a> <a id="5978" href="Leios.Short.html#5243" class="Datatype Operator">/</a> <a id="5980" href="Leios.Protocol.html#928" class="InductiveConstructor">EMPTY</a> <a id="5986" href="Leios.Short.html#5243" class="Datatype Operator">⟧⇀</a> <a id="5989" class="Keyword">record</a> <a id="5996" href="Leios.Short.html#1552" class="Generalizable">s</a>
           <a id="6009" class="Symbol">{</a> <a id="6011" href="Leios.Protocol.html#1050" class="Field">FFDState</a>  <a id="6021" class="Symbol">=</a> <a id="6023" href="Leios.Short.html#1589" class="Generalizable">ffds&#39;</a>
           <a id="6040" class="Symbol">;</a> <a id="6042" href="Leios.Protocol.html#1389" class="Field">BaseState</a> <a id="6052" class="Symbol">=</a> <a id="6054" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
           <a id="6069" class="Symbol">;</a> <a id="6071" href="Leios.Protocol.html#1082" class="Field">Ledger</a>    <a id="6081" class="Symbol">=</a> <a id="6083" href="Leios.Protocol.html#1896" class="Function">constructLedger</a> <a id="6099" href="Leios.Short.html#1860" class="Generalizable">rbs</a>
           <a id="6114" class="Symbol">;</a> <a id="6116" href="Leios.Protocol.html#1260" class="Field">slot</a>      <a id="6126" class="Symbol">=</a> <a id="6128" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a> <a id="6132" href="Leios.Protocol.html#1260" class="Function">slot</a>
           <a id="6148" class="Symbol">;</a> <a id="6150" href="Leios.Protocol.html#1354" class="Field">Upkeep</a>    <a id="6160" class="Symbol">=</a> <a id="6162" href="Class.HasEmptySet.html#287" class="Field">∅</a>
           <a id="6175" class="Symbol">}</a> <a id="6177" href="Leios.Protocol.html#7915" class="Function Operator">↑</a> <a id="6179" href="Data.List.Base.html#10687" class="Function">L.filter</a> <a id="6188" class="Symbol">(</a><a id="6189" href="Leios.Protocol.html#6253" class="Function">isValid?</a> <a id="6198" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="6199" class="Symbol">)</a> <a id="6201" href="Leios.Short.html#1725" class="Generalizable">msgs</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Ftch"></a><a id="6220" href="Leios.Short.html#6220" class="InductiveConstructor">Ftch</a> <a id="6225" class="Symbol">:</a>
       <a id="6234" href="Prelude.InferenceRules.html#42426" class="Function Operator">────────────────────────────────────────────────────────</a>
       <a id="6298" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6303" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6305" href="Leios.Short.html#5243" class="Datatype Operator">-⟦</a> <a id="6308" href="Leios.Protocol.html#838" class="InductiveConstructor">FTCH-LDG</a> <a id="6317" href="Leios.Short.html#5243" class="Datatype Operator">/</a> <a id="6319" href="Leios.Protocol.html#893" class="InductiveConstructor">FTCH-LDG</a> <a id="6328" class="Symbol">(</a><a id="6329" href="Leios.Protocol.html#1082" class="Field">LeiosState.Ledger</a> <a id="6347" href="Leios.Short.html#1552" class="Generalizable">s</a><a id="6348" class="Symbol">)</a> <a id="6350" href="Leios.Short.html#5243" class="Datatype Operator">⟧⇀</a> <a id="6353" href="Leios.Short.html#1552" class="Generalizable">s</a>
</pre>#### Base chain

Note: Submitted data to the base chain is only taken into account
      if the party submitting is the block producer on the base chain
      for the given slot
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₁"></a><a id="6547" href="Leios.Short.html#6547" class="InductiveConstructor">Base₁</a>   <a id="6555" class="Symbol">:</a>
          <a id="6567" href="Prelude.InferenceRules.html#41139" class="Function Operator">───────────────────────────────────────────────────────────────────</a>
          <a id="6645" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6650" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6652" href="Leios.Short.html#5243" class="Datatype Operator">-⟦</a> <a id="6655" href="Leios.Protocol.html#764" class="InductiveConstructor">SUBMIT</a> <a id="6662" class="Symbol">(</a><a id="6663" href="Data.Sum.Base.html#700" class="InductiveConstructor">inj₂</a> <a id="6668" href="Leios.Short.html#1904" class="Generalizable">txs</a><a id="6671" class="Symbol">)</a> <a id="6673" href="Leios.Short.html#5243" class="Datatype Operator">/</a> <a id="6675" href="Leios.Protocol.html#928" class="InductiveConstructor">EMPTY</a> <a id="6681" href="Leios.Short.html#5243" class="Datatype Operator">⟧⇀</a> <a id="6684" class="Keyword">record</a> <a id="6691" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6693" class="Symbol">{</a> <a id="6695" href="Leios.Protocol.html#1112" class="Field">ToPropose</a> <a id="6705" class="Symbol">=</a> <a id="6707" href="Leios.Short.html#1904" class="Generalizable">txs</a> <a id="6711" class="Symbol">}</a>
</pre><pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Base₂a"></a><a id="6727" href="Leios.Short.html#6727" class="InductiveConstructor">Base₂a</a>  <a id="6735" class="Symbol">:</a> <a id="6737" class="Keyword">let</a> <a id="6741" class="Keyword">open</a> <a id="6746" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="6757" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6759" class="Keyword">renaming</a> <a id="6768" class="Symbol">(</a><a id="6769" href="Leios.Protocol.html#1389" class="Field">BaseState</a> <a id="6779" class="Symbol">to</a> <a id="6782" class="Field">bs</a><a id="6784" class="Symbol">)</a> <a id="6786" class="Keyword">in</a>
          <a id="6799" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="6801" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="6813" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>
          <a id="6828" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="6830" href="Leios.Short.html#1820" class="Generalizable">eb</a> <a id="6833" href="Class.IsSet.html#458" class="Function Operator">∈</a> <a id="6835" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="6842" class="Symbol">(λ</a> <a id="6845" href="Leios.Short.html#6845" class="Bound">eb</a> <a id="6848" class="Symbol">→</a> <a id="6850" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="6866" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="6868" href="Leios.Short.html#6845" class="Bound">eb</a> <a id="6871" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="6873" href="Leios.Short.html#6845" class="Bound">eb</a> <a id="6876" href="Leios.Blocks.html#527" class="Function Operator">∈ᴮ</a> <a id="6879" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="6885" href="Leios.Abstract.html#628" class="Function">L</a> <a id="6887" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="6892" class="Number">2</a><a id="6893" class="Symbol">)</a> <a id="6895" href="Leios.Protocol.html#1180" class="Function">EBs</a>
          <a id="6909" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="6911" href="Leios.Short.html#6782" class="Function">bs</a> <a id="6914" href="Leios.Base.html#870" class="Function Operator">B.-⟦</a> <a id="6919" href="Leios.Base.html#627" class="InductiveConstructor">B.SUBMIT</a> <a id="6928" class="Symbol">(</a><a id="6929" href="Data.These.Base.html#595" class="InductiveConstructor">this</a> <a id="6934" href="Leios.Short.html#1820" class="Generalizable">eb</a><a id="6936" class="Symbol">)</a> <a id="6938" href="Leios.Base.html#870" class="Function Operator">/</a> <a id="6940" href="Leios.Base.html#742" class="InductiveConstructor">B.EMPTY</a> <a id="6948" href="Leios.Base.html#870" class="Function Operator">⟧⇀</a> <a id="6951" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
          <a id="6965" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="7047" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7052" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7054" href="Leios.Short.html#5243" class="Datatype Operator">-⟦</a> <a id="7057" href="Leios.Protocol.html#814" class="InductiveConstructor">SLOT</a> <a id="7062" href="Leios.Short.html#5243" class="Datatype Operator">/</a> <a id="7064" href="Leios.Protocol.html#928" class="InductiveConstructor">EMPTY</a> <a id="7070" href="Leios.Short.html#5243" class="Datatype Operator">⟧⇀</a> <a id="7073" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="7083" class="Keyword">record</a> <a id="7090" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7092" class="Symbol">{</a> <a id="7094" href="Leios.Protocol.html#1389" class="Field">BaseState</a> <a id="7104" class="Symbol">=</a> <a id="7106" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a> <a id="7110" class="Symbol">}</a> <a id="7112" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>

  <a id="_-⟦_/_⟧⇀_.Base₂b"></a><a id="7120" href="Leios.Short.html#7120" class="InductiveConstructor">Base₂b</a>  <a id="7128" class="Symbol">:</a> <a id="7130" class="Keyword">let</a> <a id="7134" class="Keyword">open</a> <a id="7139" href="Leios.Protocol.html#959" class="Module">LeiosState</a> <a id="7150" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7152" class="Keyword">renaming</a> <a id="7161" class="Symbol">(</a><a id="7162" href="Leios.Protocol.html#1389" class="Field">BaseState</a> <a id="7172" class="Symbol">to</a> <a id="7175" class="Field">bs</a><a id="7177" class="Symbol">)</a> <a id="7179" class="Keyword">in</a>
          <a id="7192" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="7194" href="Leios.Protocol.html#2023" class="Function">needsUpkeep</a> <a id="7206" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>
          <a id="7221" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7223" href="Agda.Builtin.List.html#184" class="InductiveConstructor">[]</a> <a id="7226" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">≡</a> <a id="7228" href="Leios.Prelude.html#1171" class="Function">filter</a> <a id="7235" class="Symbol">(λ</a> <a id="7238" href="Leios.Short.html#7238" class="Bound">eb</a> <a id="7241" class="Symbol">→</a> <a id="7243" href="Leios.Short.html#1394" class="Function">isVoteCertified</a> <a id="7259" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7261" href="Leios.Short.html#7238" class="Bound">eb</a> <a id="7264" href="Data.Product.Base.html#1618" class="Function Operator">×</a> <a id="7266" href="Leios.Short.html#7238" class="Bound">eb</a> <a id="7269" href="Leios.Blocks.html#527" class="Function Operator">∈ᴮ</a> <a id="7272" href="Leios.Prelude.html#1001" class="Function">slice</a> <a id="7278" href="Leios.Abstract.html#628" class="Function">L</a> <a id="7280" href="Leios.Protocol.html#1260" class="Function">slot</a> <a id="7285" class="Number">2</a><a id="7286" class="Symbol">)</a> <a id="7288" href="Leios.Protocol.html#1180" class="Function">EBs</a>
          <a id="7302" href="Prelude.InferenceRules.html#56005" class="Function Operator">∙</a> <a id="7304" href="Leios.Short.html#7175" class="Function">bs</a> <a id="7307" href="Leios.Base.html#870" class="Function Operator">B.-⟦</a> <a id="7312" href="Leios.Base.html#627" class="InductiveConstructor">B.SUBMIT</a> <a id="7321" class="Symbol">(</a><a id="7322" href="Data.These.Base.html#623" class="InductiveConstructor">that</a> <a id="7327" href="Leios.Protocol.html#1112" class="Function">ToPropose</a><a id="7336" class="Symbol">)</a> <a id="7338" href="Leios.Base.html#870" class="Function Operator">/</a> <a id="7340" href="Leios.Base.html#742" class="InductiveConstructor">B.EMPTY</a> <a id="7348" href="Leios.Base.html#870" class="Function Operator">⟧⇀</a> <a id="7351" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a>
          <a id="7365" href="Prelude.InferenceRules.html#11470" class="Function Operator">───────────────────────────────────────────────────────────────────────</a>
          <a id="7447" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7452" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7454" href="Leios.Short.html#5243" class="Datatype Operator">-⟦</a> <a id="7457" href="Leios.Protocol.html#814" class="InductiveConstructor">SLOT</a> <a id="7462" href="Leios.Short.html#5243" class="Datatype Operator">/</a> <a id="7464" href="Leios.Protocol.html#928" class="InductiveConstructor">EMPTY</a> <a id="7470" href="Leios.Short.html#5243" class="Datatype Operator">⟧⇀</a> <a id="7473" href="Leios.Protocol.html#2208" class="Function">addUpkeep</a> <a id="7483" class="Keyword">record</a> <a id="7490" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7492" class="Symbol">{</a> <a id="7494" href="Leios.Protocol.html#1389" class="Field">BaseState</a> <a id="7504" class="Symbol">=</a> <a id="7506" href="Leios.Short.html#1657" class="Generalizable">bs&#39;</a> <a id="7510" class="Symbol">}</a> <a id="7512" href="Leios.Short.html#1083" class="InductiveConstructor">Base</a>
</pre>#### Protocol rules
<pre class="Agda">  <a id="_-⟦_/_⟧⇀_.Roles"></a><a id="7551" href="Leios.Short.html#7551" class="InductiveConstructor">Roles</a> <a id="7557" class="Symbol">:</a>
        <a id="7567" href="Prelude.InferenceRules.html#56074" class="Function Operator">∙</a> <a id="7569" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7571" href="Leios.Short.html#2523" class="Datatype Operator">↝</a> <a id="7573" href="Leios.Short.html#1554" class="Generalizable">s&#39;</a>
        <a id="7584" href="Prelude.InferenceRules.html#13801" class="Function Operator">─────────────────────────────</a>
        <a id="7622" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="7627" href="Leios.Short.html#1552" class="Generalizable">s</a> <a id="7629" href="Leios.Short.html#5243" class="Datatype Operator">-⟦</a> <a id="7632" href="Leios.Protocol.html#814" class="InductiveConstructor">SLOT</a> <a id="7637" href="Leios.Short.html#5243" class="Datatype Operator">/</a> <a id="7639" href="Leios.Protocol.html#928" class="InductiveConstructor">EMPTY</a> <a id="7645" href="Leios.Short.html#5243" class="Datatype Operator">⟧⇀</a> <a id="7648" href="Leios.Short.html#1554" class="Generalizable">s&#39;</a>
</pre>